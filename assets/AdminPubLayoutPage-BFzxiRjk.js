import{ax as h,_ as G,i as H,j as e,B as o,A as v,D as y,b as C,C as S,k as N,S as g,c as A,x as P,l as J,F as R,n as D,q as F,r as L,t as w,v as E,I as U,y as W,J as n}from"./index-Dc-BS1W2.js";import{r as I}from"./emoji-mart-DRerY-OB.js";import{A as _}from"./AdminLayout-CibHDjhS.js";import{a as X,u as f}from"./useMutation-CApHjpg4.js";import{C as M,D as q,r as Y,s as Z,q as m}from"./pubLayoutAPI-DfYluJku.js";import{S as $,a as ee,b as se,c as re,d as te}from"./select-B3i9CjeT.js";import{D as ie,b as ae,d as ne,c as le,e as oe}from"./dialog-D1sIsNKu.js";import{P as ce}from"./plus-DTTTuzsk.js";import{S as ue}from"./square-pen-D72gPhkm.js";import{T as de}from"./trash-2-DHce8VXy.js";import"./index-DrCm3EO8.js";import"./arrow-up-BRrXiPPU.js";import"./database-BKbjrLJf.js";import"./user-DUzEMHwr.js";import"./circle-plus-gGTkOUJD.js";import"./clock-U9VSJiyP.js";import"./play-C68uu85c.js";import"./house-Qr62Kw0A.js";import"./shield-x-BsKCYJAg.js";import"./video-CY1c3mCS.js";import"./search-DlKIh_Ll.js";import"./triangle-alert-Btc8UJ8c.js";import"./index-BkNWx6m2.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./Combination-DuTqoeZY.js";import"./index-DqWbzM0E.js";import"./index-FHuIi1st.js";import"./index-DE01g13U.js";const me=h.object({icon:h.string().min(1,"Veuillez sélectionner une icône"),text:h.string().min(5,"Le texte doit contenir au moins 5 caractères").max(100,"Le texte ne doit pas dépasser 100 caractères")}),Be=()=>{const x=G(),[z,c]=I.useState(!1),[l,u]=I.useState(null),{data:d=[],isLoading:T,error:V}=X({queryKey:["pub-layout"],queryFn:m.getAll,refetchInterval:30*1e3,refetchOnWindowFocus:!0}),t=H({resolver:W(me),defaultValues:{icon:"",text:""}}),p=f({mutationFn:s=>m.add(s),onSuccess:()=>{n.success("Publicité ajoutée avec succès"),x.invalidateQueries({queryKey:["pub-layout"]}),c(!1),t.reset()},onError:s=>{var i,a;const r=((a=(i=s.response)==null?void 0:i.data)==null?void 0:a.message)||"Erreur lors de l'ajout de la publicité";n.error(r)}}),j=f({mutationFn:({id:s,data:r})=>m.update(s,r),onSuccess:()=>{n.success("Publicité mise à jour avec succès"),x.invalidateQueries({queryKey:["pub-layout"]}),u(null),t.reset()},onError:s=>{var i,a;const r=((a=(i=s.response)==null?void 0:i.data)==null?void 0:a.message)||"Erreur lors de la mise à jour de la publicité";n.error(r)}}),k=f({mutationFn:m.delete,onSuccess:()=>{n.success("Publicité supprimée avec succès"),x.invalidateQueries({queryKey:["pub-layout"]})},onError:s=>{var i,a;const r=((a=(i=s.response)==null?void 0:i.data)==null?void 0:a.message)||"Erreur lors de la suppression de la publicité";n.error(r)}}),Q=s=>{const r={icon:s.icon,text:s.text};l?j.mutate({id:l.id,data:r}):p.mutate(r)},K=s=>{u(s),t.reset({icon:s.icon,text:s.text})},O=s=>{if(d.length<=2){n.error("Il faut conserver au moins 2 publicités");return}confirm("Êtes-vous sûr de vouloir supprimer cette publicité ?")&&k.mutate(s)},B=()=>{if(d.length>=6){n.error("Le nombre maximum de publicités (6) est atteint");return}t.reset({icon:"",text:""}),u(null),c(!0)},b=()=>{u(null),c(!1),t.reset()};return e.jsx(_,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Gestion des Publicités"}),e.jsx("p",{className:"text-muted-foreground",children:"Gérez les annonces promotionnelles qui s'affichent dans la barre rotative en haut du site"})]}),e.jsxs(o,{onClick:B,disabled:d.length>=6,children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Ajouter une publicité"]})]}),e.jsxs(v,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(y,{children:"Limites"}),e.jsx(C,{children:"Vous devez avoir au minimum 2 publicités et vous pouvez en ajouter jusqu'à 6 maximum."})]}),T?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsxs(S,{children:[e.jsx(N,{children:e.jsx(g,{className:"h-5 w-20"})}),e.jsx(A,{children:e.jsx(g,{className:"h-4 w-full mb-2"})}),e.jsx(P,{children:e.jsx(g,{className:"h-9 w-full"})})]},s))}):V?e.jsxs(v,{variant:"destructive",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(y,{children:"Erreur"}),e.jsx(C,{children:"Une erreur est survenue lors du chargement des publicités. Veuillez réessayer plus tard."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:d.map(s=>e.jsxs(S,{children:[e.jsx(N,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(q,{name:s.icon,className:"mr-2 h-5 w-5"}),s.icon]})}),e.jsx(A,{children:e.jsx("p",{children:s.text})}),e.jsxs(P,{className:"flex justify-between",children:[e.jsxs(o,{variant:"outline",onClick:()=>K(s),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"})," Modifier"]}),e.jsxs(o,{variant:"destructive",onClick:()=>O(s.id),children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Supprimer"]})]})]},s.id))}),e.jsx(ie,{open:z||!!l,onOpenChange:s=>{s?l||c(s):b()},children:e.jsxs(ae,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:l?"Modifier une publicité":"Ajouter une nouvelle publicité"}),e.jsx(oe,{children:l?"Modifiez les détails de la publicité existante.":"Remplissez le formulaire pour ajouter une nouvelle publicité."})]}),e.jsx(R,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(Q),className:"space-y-4",children:[e.jsx(D,{control:t.control,name:"icon",render:({field:s})=>e.jsxs(F,{children:[e.jsx(L,{children:"Icône"}),e.jsxs($,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(w,{children:e.jsx(ee,{children:e.jsx(se,{placeholder:"Sélectionnez une icône"})})}),e.jsx(re,{children:Y.map(r=>e.jsx(te,{value:r,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{name:r,className:"mr-2"}),r]})},r))})]}),e.jsx(E,{})]})}),e.jsx(D,{control:t.control,name:"text",render:({field:s})=>e.jsxs(F,{children:[e.jsx(L,{children:"Texte de la publicité"}),e.jsx(w,{children:e.jsx(U,{placeholder:"Ex: Livraison gratuite à partir de 50€ d'achat",...s})}),e.jsx(E,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:b,children:"Annuler"}),e.jsxs(o,{type:"submit",disabled:p.isPending||j.isPending,children:[(p.isPending||j.isPending)&&e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),l?"Mettre à jour":"Ajouter"]})]})]})})]})})]})})};export{Be as default};
