import{j as e,a as C,u as B,A as O,b as H,B as R,C as E,c as D,L as S,g as L,p as A,d as F,e as $,E as V,f as _}from"./index-Dc-BS1W2.js";import{r as x,R as G}from"./emoji-mart-DRerY-OB.js";import{A as k,C as Q,a as W,b as X,c as J,d as K,m as b,e as Y,L as Z}from"./Layout-TSHxcvNT.js";import{P}from"./ProductGrid-JVyDvg9G.js";import{S as ee}from"./ProductCard-Cq7PI4fG.js";import{C as te,A as se,T as I,a as ae,b as re,M as ne}from"./pubLayoutAPI-DfYluJku.js";import{R as ie,S as T,U as oe}from"./index-DrCm3EO8.js";import{f as le}from"./flashSaleAPI-BHvs0iCz.js";import{F as ce}from"./play-C68uu85c.js";import{C as z}from"./clock-U9VSJiyP.js";import"./badge-taJbTjbb.js";import"./popover-CGZmNc4e.js";import"./Combination-DuTqoeZY.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./index-BkNWx6m2.js";import"./index-DE01g13U.js";import"./index--K3sZeIh.js";import"./user-DUzEMHwr.js";import"./index-FHuIi1st.js";import"./select-B3i9CjeT.js";import"./index-DqWbzM0E.js";import"./categoriesAPI-DvU_otkD.js";import"./search-DlKIh_Ll.js";import"./database-BKbjrLJf.js";import"./scroll-area-BfHT7kH_.js";import"./useMutation-CApHjpg4.js";import"./arrow-up-BRrXiPPU.js";import"./dialog-D1sIsNKu.js";import"./circle-plus-gGTkOUJD.js";import"./house-Qr62Kw0A.js";import"./shield-x-BsKCYJAg.js";import"./video-CY1c3mCS.js";import"./plus-DTTTuzsk.js";import"./square-pen-D72gPhkm.js";import"./trash-2-DHce8VXy.js";import"./triangle-alert-Btc8UJ8c.js";const de=()=>{const[o,c]=x.useState([]),[l,m]=x.useState(!0),r="https://riziky-boutic-server.onrender.com";x.useEffect(()=>{(async()=>{try{const u=await C.get(`${r}/api/reviews/best`);if(!u.data||!Array.isArray(u.data)||u.data.length===0){const d=await C.get(`${r}/api/reviews`);if(d.data&&Array.isArray(d.data)){const t=[...d.data].sort((s,h)=>{const p=(s.productRating+s.deliveryRating)/2,f=(h.productRating+h.deliveryRating)/2;return f!==p?f-p:new Date(h.createdAt).getTime()-new Date(s.createdAt).getTime()});c(t.slice(0,3))}}else c(u.data.slice(0,3))}catch(u){console.error("Erreur lors de la récupération des témoignages:",u);try{const d=await C.get(`${r}/api/reviews`);if(d.data&&Array.isArray(d.data)){const t=[...d.data].sort((s,h)=>{const p=(s.productRating+s.deliveryRating)/2,f=(h.productRating+h.deliveryRating)/2;return f!==p?f-p:new Date(h.createdAt).getTime()-new Date(s.createdAt).getTime()});c(t.slice(0,3))}}catch(d){console.error("Erreur lors de la récupération de tous les commentaires:",d)}}finally{m(!1)}})()},[r]);const n=i=>Math.round((i.productRating+i.deliveryRating)/2),a=i=>i.split(" ").map(u=>u[0]).join("").toUpperCase().substring(0,2);return e.jsxs("section",{className:"mb-16",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h2",{className:"font-cormorant text-3xl md:text-4xl font-bold mb-2 text-brand-charcoal text-red-800",children:"Ce Que Nos Clients Disent"}),e.jsx("p",{className:"text-gray-500 text-red-800",children:"Découvrez les expériences de notre communauté"}),e.jsx("div",{className:"h-px w-24 bg-brand-gold mx-auto mt-4"})]}),l?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[1,2,3].map(i=>e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm border border-gray-100 animate-pulse",children:[e.jsx("div",{className:"flex items-center mb-4 h-5 bg-gray-200 rounded"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded mb-4"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-4",children:e.jsx("div",{className:"w-12 h-12 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-2/3 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/3"})]})]})]},i))}):o.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:o.map(i=>e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-md",children:[e.jsx("div",{className:"flex items-center text-yellow-400 mb-4",children:e.jsx(ee,{rating:n(i),readOnly:!0,size:18})}),e.jsxs("p",{className:"text-gray-600 mb-4 line-clamp-4 min-h-[80px]",children:["« ",i.comment," »"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-4",children:i.photos&&i.photos[0]?e.jsx(k,{children:e.jsx("img",{src:`${r}${i.photos[0]}`,alt:i.userName,className:"w-12 h-12 object-cover rounded-full"})}):e.jsx(k,{className:"bg-brand-gold text-white",children:e.jsx("span",{children:a(i.userName)})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:i.userName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Client",i.userName.endsWith("e")?"e":""]})]})]})]},i.id))}):e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-500",children:"Aucun témoignage disponible pour le moment."})})]})};function me({fetchFunction:o,onSuccess:c,onMaxRetriesReached:l,maxRetries:m=6,retryInterval:r=5e3,loadingComponent:n,errorMessage:a="Erreur de chargement des données",children:i}){const[u,d]=x.useState(!0),[t,s]=x.useState(0),[h,p]=x.useState(!1),{toast:f}=B(),j=async()=>{try{d(!0),p(!1);const N=await o();c(N),d(!1),s(0)}catch(N){console.error(`Tentative ${t+1} échouée:`,N),t<m-1?(s(w=>w+1),setTimeout(j,r)):(d(!1),p(!0),f({variant:"destructive",title:a,description:`Impossible de charger les données après ${m} tentatives.`,action:e.jsx(R,{variant:"outline",size:"sm",onClick:()=>{s(0),p(!1),j()},children:"Réessayer"})}),l==null||l())}};x.useEffect(()=>{j()},[]);const v=()=>{s(0),p(!1),j()};return u?e.jsx("div",{className:"flex flex-col items-center justify-center p-8",children:n||e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mb-4"}),e.jsxs("p",{className:"text-gray-600",children:["Chargement des données... ",t>0&&`(Tentative ${t+1}/${m})`]})]})}):h?e.jsxs(O,{className:"border-red-200 bg-red-50",children:[e.jsx(te,{className:"h-4 w-4 text-red-600"}),e.jsxs(H,{className:"flex items-center justify-between",children:[e.jsx("span",{children:a}),e.jsxs(R,{variant:"outline",size:"sm",onClick:v,className:"ml-4",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Réessayer"]})]})]}):e.jsx(e.Fragment,{children:i})}const xe=()=>e.jsx("h1",{className:"text-4xl font-bold mb-8 text-red-800 flex items-center justify-center",children:"Bienvenue chez Riziky Boutique - Spécialiste Produits Capillaires Premium"}),ue=({products:o})=>{const c="https://riziky-boutic-server.onrender.com",l="/placeholder.svg",m=n=>n?n.startsWith("http")?n:`${c}${n}`:l,r=n=>`/${L(n,"product")}`;return o.length===0?null:e.jsxs("div",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-red-800",children:"Nos Produits Vedettes"}),e.jsxs(Q,{children:[e.jsx(W,{children:o.map(n=>e.jsx(X,{className:"md:basis-1/2 lg:basis-1/4",children:e.jsx("div",{className:"p-1",children:e.jsx(E,{children:e.jsx(D,{className:"flex aspect-square items-center justify-center p-0",children:e.jsx("div",{className:"w-full",children:e.jsxs(S,{to:r(n.id),className:"block",children:[e.jsx("img",{src:m(n.image),alt:`${n.name} - Produit capillaire premium`,className:"w-full h-48 object-contain",onError:a=>{const i=a.target;i.src=l}}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium",children:n.name}),n.promotion?e.jsxs("div",{className:"flex items-center gap-2 px-[19px]",children:[e.jsxs("p",{className:"mt-1 text-sm text-gray-500 line-through",children:[typeof n.originalPrice=="number"?n.originalPrice.toFixed(2):n.price.toFixed(2)," ","€"]}),e.jsxs("span",{className:"inline-block px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium",children:["-",n.promotion,"%"]}),e.jsxs("p",{className:"mt-1 font-bold",children:[n.price.toFixed(2)," €"]})]}):e.jsxs("p",{className:"mt-1 font-bold",children:[n.price.toFixed(2)," €"]})]})]})})})})})},n.id))}),e.jsx(J,{"data-carousel-previous":!0}),e.jsx(K,{"data-carousel-next":!0})]})]})},he=({products:o})=>{const c="https://riziky-boutic-server.onrender.com",l="/placeholder.svg",m=a=>a?a.startsWith("http")?a:`${c}${a}`:l,r=a=>`/${L(a,"product")}`,n=a=>{const i=new Date(a),u=new Date,d=i.getTime()-u.getTime();if(d<=0)return"Expirée";const t=Math.floor(d/(1e3*60*60)),s=Math.floor(d%(1e3*60*60)/(1e3*60));return`${t}h ${s}m`};return o.length===0?null:e.jsxs("div",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-red-800",children:"Offres Promotionnelles"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:o.map(a=>e.jsxs(E,{className:"overflow-hidden h-full flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx(S,{to:r(a.id),children:e.jsx("img",{src:m(a.image),alt:`${a.name} en promotion`,className:"h-48 w-full object-contain",onError:i=>{const u=i.target;u.src=l}})}),e.jsxs("div",{className:"absolute top-2 right-2 bg-red-600 text-white px-2 py-1 rounded-full text-xs font-bold",children:["-",a.promotion,"%"]}),a.promotionEnd&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/70 text-white px-2 py-1 rounded text-xs",children:["Expire dans: ",n(a.promotionEnd)]})]}),e.jsxs(D,{className:"p-4 flex-grow",children:[e.jsx(S,{to:r(a.id),children:e.jsx("h3",{className:"font-medium text-lg mb-1",children:a.name})}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-500 line-through",children:[typeof a.originalPrice=="number"?a.originalPrice.toFixed(2):a.price.toFixed(2)," ","€"]}),e.jsxs("p",{className:"font-bold text-red-600",children:[a.price.toFixed(2)," €"]})]})]})]},a.id))})]})},pe=()=>{const[o,c]=x.useState({days:0,hours:0,minutes:0,seconds:0}),[l,m]=x.useState(!1),[r,n]=x.useState(null),[a,i]=x.useState(!0);if(x.useEffect(()=>{const t=async()=>{try{i(!0),console.log("🔄 Récupération de la vente flash active via API...");const h=await le.getActive();h.data?(console.log("✅ Vente flash active trouvée:",h.data),n(h.data)):(console.log("ℹ️ Aucune vente flash active"),n(null))}catch(h){console.error("❌ Erreur lors du chargement de la vente flash:",h),n(null)}finally{i(!1)}};t();const s=setInterval(t,3e4);return()=>clearInterval(s)},[]),x.useEffect(()=>{if(!r)return;const t=()=>{const h=new Date(r.endDate).getTime(),p=new Date().getTime(),f=h-p;if(f>0){const j=Math.floor(f/864e5),v=Math.floor(f%(1e3*60*60*24)/(1e3*60*60)),N=Math.floor(f%(1e3*60*60)/(1e3*60)),w=Math.floor(f%(1e3*60)/1e3);c({days:j,hours:v,minutes:N,seconds:w}),m(!1)}else c({days:0,hours:0,minutes:0,seconds:0}),m(!0)};t();const s=setInterval(t,1e3);return()=>clearInterval(s)},[r]),a||!r||l)return null;const u=[{label:"Jours",value:o.days},{label:"Heures",value:o.hours},{label:"Min",value:o.minutes},{label:"Sec",value:o.seconds}],d=`/flash-sale/${r.id}`;return e.jsx(b.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"my-6",children:e.jsxs(E,{className:"bg-gradient-to-r from-red-600 via-pink-600 to-orange-600 text-white overflow-hidden relative",children:[e.jsx("div",{className:"p-6 relative z-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ce,{className:"h-6 w-6 text-yellow-300 animate-pulse"}),e.jsx("h2",{className:"text-2xl font-bold",children:r.title}),e.jsxs("span",{className:"bg-yellow-400 text-black px-3 py-1 rounded-full text-sm font-bold",children:["-",r.discount,"%"]})]}),e.jsx("p",{className:"text-lg mb-4 opacity-90",children:r.description}),e.jsx(R,{variant:"secondary",className:"bg-white text-red-600 hover:bg-gray-100 font-bold px-6 py-3 rounded-full",asChild:!0,children:e.jsxs(S,{to:d,children:["Voir les produits",e.jsx(se,{className:"ml-2 h-4 w-4"})]})})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Se termine dans :"})]}),e.jsx("div",{className:"flex space-x-2",children:u.map((t,s)=>e.jsxs(b.div,{initial:{scale:.8},animate:{scale:1},transition:{delay:s*.1},className:"text-center",children:[e.jsx(b.div,{initial:{rotateX:-90},animate:{rotateX:0},transition:{duration:.3},className:"bg-black/30 backdrop-blur rounded-lg px-3 py-2 min-w-[50px] mb-1",children:e.jsx("div",{className:"text-xl font-bold",children:t.value.toString().padStart(2,"0")})},t.value),e.jsx("div",{className:"text-xs opacity-80",children:t.label})]},t.label))})]})]})}),e.jsx(b.div,{animate:{background:["radial-gradient(circle at 20% 50%, rgba(255,255,255,0.3) 0%, transparent 50%)","radial-gradient(circle at 80% 50%, rgba(255,255,255,0.3) 0%, transparent 50%)","radial-gradient(circle at 40% 50%, rgba(255,255,255,0.3) 0%, transparent 50%)"]},transition:{duration:3,repeat:1/0,ease:"linear"},className:"absolute inset-0 pointer-events-none"})]})})},ge=()=>{const[o,c]=x.useState([]),[l,m]=x.useState([]),[r,n]=x.useState([]),[a,i]=x.useState([]),[u,d]=x.useState([]),[t,s]=x.useState(!1);return{featuredProductCatalog:o,newArrivalProducts:l,promotionalProducts:r,completeProductCatalog:a,filteredProductCatalog:u,dataLoadingComplete:t,setFilteredProductCatalog:d,loadEcommerceProductData:async()=>{const j=await A.getAll();if(!j.data||!Array.isArray(j.data))throw new Error("Format de données produit incorrect - Conformité UE requise");const v=j.data,N=[...v].sort((g,y)=>g.name.localeCompare(y.name));i(N),d(N);try{const g=await A.getMostFavorited(),y=Array.isArray(g.data)?g.data.slice(0,8):v.slice(0,8);c(y)}catch(g){console.error("Erreur chargement produits vedettes:",g),c(v.slice(0,8))}try{const g=await A.getNewArrivals(),y=Array.isArray(g.data)?g.data.slice(0,8):[];m(y)}catch(g){console.error("Erreur chargement nouveautés:",g);const y=[...v].sort((q,M)=>new Date(M.dateAjout||0).getTime()-new Date(q.dateAjout||0).getTime());m(y.slice(0,8))}const w=new Date,U=v.filter(g=>g.promotion&&g.promotionEnd&&new Date(g.promotionEnd)>w);return n(U.slice(0,8)),v},handleDataLoadingSuccess:()=>{s(!0)},handleMaxRetriesReached:()=>{c([]),m([]),n([]),i([]),d([]),s(!0)}}},fe=(o,c,l)=>{x.useEffect(()=>{if(!o||!c||l===0)return;const m=setInterval(()=>{const r=document.querySelector("[data-carousel-next]");r&&r.click()},3e3);return()=>clearInterval(m)},[o,c,l])},je=()=>{const{isAdmin:o}=F(),c=$(),[l,m]=x.useState(null),[r,n]=x.useState({today:0,week:0,month:0,year:0}),[a,i]=x.useState(new Date().toISOString());return x.useEffect(()=>{if(!o||c.pathname!=="/")return;const u=async()=>{try{const t=await fetch(`https://riziky-boutic-server.onrender.com/api/sales-notifications/latest?since=${a}`);if(t.ok){const s=await t.json();s.orderStats&&n(s.orderStats),s.notification&&(console.log("Nouvelle notification de vente reçue:",s.notification),m(s.notification),i(new Date().toISOString()),setTimeout(()=>{m(null)},5e3))}}catch(t){console.error("Erreur lors de la vérification des nouvelles ventes:",t)}},d=setInterval(u,1e3);return u(),()=>clearInterval(d)},[o,c.pathname,a]),!o||c.pathname!=="/"?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed right-4 z-40 bg-white dark:bg-neutral-900 rounded-xl shadow-lg border border-neutral-200 dark:border-neutral-800 p-3 max-w-xs lg:top-20",style:{marginTop:"100px"},children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-center",children:[e.jsx(I,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"Statistiques"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"h-3 w-3 text-green-600 mx-auto mb-1"}),e.jsx("div",{className:"font-bold text-green-600 text-sm",children:r.today}),e.jsx("div",{className:"text-neutral-600 dark:text-neutral-400 text-xs",children:"Aujourd'hui"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:"h-3 w-3 text-purple-600 mx-auto mb-1"}),e.jsx("div",{className:"font-bold text-purple-600 text-sm",children:r.week}),e.jsx("div",{className:"text-neutral-600 dark:text-neutral-400 text-xs",children:"Semaine"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(I,{className:"h-3 w-3 text-orange-600 mx-auto mb-1"}),e.jsx("div",{className:"font-bold text-orange-600 text-sm",children:r.month}),e.jsx("div",{className:"text-neutral-600 dark:text-neutral-400 text-xs",children:"Mois"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"h-3 w-3 text-red-600 mx-auto mb-1"}),e.jsx("div",{className:"font-bold text-red-600 text-sm",children:r.year}),e.jsx("div",{className:"text-neutral-600 dark:text-neutral-400 text-xs",children:"Année"})]})]})]})}),e.jsx(Y,{children:l&&e.jsxs(b.div,{initial:{opacity:0,x:-400},animate:{opacity:1,x:0},exit:{opacity:0,x:-400},transition:{type:"spring",stiffness:100,damping:20,duration:.6},className:"fixed mt-100px bottom-4  left-4 z-50 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl shadow-xl p-4 max-w-xs sm:max-w-sm border-2 border-green-300 mt-16 sm:mt-0",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-white/20 rounded-full p-2 animate-pulse flex-shrink-0",children:e.jsx(T,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-sm mb-1",children:"🎉 Nouvelle vente !"}),e.jsxs("p",{className:"text-xs opacity-95 mb-1 truncate",children:[e.jsx("span",{className:"font-semibold",children:l.customerName})," vient d'acheter"]}),e.jsx("p",{className:"text-xs font-bold bg-white/20 rounded px-2 py-1 mb-2 truncate",children:l.name}),e.jsxs("div",{className:"flex items-center justify-between text-xs opacity-90 mb-2 space-x-1",children:[e.jsxs("div",{className:"flex items-center space-x-1 flex-1 min-w-0",children:[e.jsx(ne,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:l.location})]}),e.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[e.jsx(z,{className:"h-3 w-3"}),e.jsx("span",{children:l.time})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/20 rounded px-2 py-1 text-center",children:[e.jsx("div",{className:"font-bold text-yellow-200 text-xs",children:"Quantité"}),e.jsxs("div",{className:"font-semibold",children:[l.quantity,"x"]})]}),e.jsxs("div",{className:"bg-white/20 rounded px-2 py-1 text-center",children:[e.jsx("div",{className:"font-bold text-yellow-200 text-xs",children:"Total"}),e.jsxs("div",{className:"font-semibold",children:[l.subtotal.toFixed(2),"€"]})]})]}),e.jsx("div",{className:"mt-2 text-xs bg-white/20 rounded px-2 py-1 text-center",children:e.jsxs("span",{className:"font-semibold",children:["Prix: ",l.price.toFixed(2),"€"]})})]})]}),e.jsx(b.div,{initial:{width:"100%"},animate:{width:"0%"},transition:{duration:5,ease:"linear"},className:"absolute bottom-0 left-0 h-1 bg-white/30 rounded-b-xl"})]})})]})},ve=()=>{const{isAdmin:o}=F(),c=$(),[l,m]=x.useState({today:0,week:0,month:0,year:0,currentViewing:0});return x.useEffect(()=>{if(!o||c.pathname!=="/")return;let r,n,a;const i=async()=>{try{const t=await fetch("https://riziky-boutic-server.onrender.com/api/visitors/record",{method:"POST",headers:{"Content-Type":"application/json"}});if(t.ok){const s=await t.json();m(s),console.log("Visite initiale enregistrée:",s)}}catch(t){console.error("Erreur lors de l'enregistrement de la visite initiale:",t)}},u=async()=>{try{const t=await fetch("https://riziky-boutic-server.onrender.com/api/visitors/stats");if(t.ok){const s=await t.json();m(s),console.log("Stats mises à jour:",s)}}catch(t){console.error("Erreur lors de la récupération des statistiques:",t)}},d=async()=>{try{const t=await fetch("https://riziky-boutic-server.onrender.com/api/visitors/heartbeat",{method:"POST",headers:{"Content-Type":"application/json"}});if(t.ok){const s=await t.json();console.log("Heartbeat envoyé, utilisateurs en ligne:",s.currentViewing)}}catch(t){console.error("Erreur lors de l'envoi du heartbeat:",t)}};return i(),r=setInterval(async()=>{try{await fetch("https://riziky-boutic-server.onrender.com/api/visitors/record",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(t){console.error("Erreur lors de l'enregistrement périodique:",t)}},5e3),n=setInterval(u,1e3),a=setInterval(d,1e4),d(),()=>{r&&clearInterval(r),n&&clearInterval(n),a&&clearInterval(a)}},[o,c.pathname]),!o||c.pathname!=="/"?null:e.jsx("div",{className:"fixed bottom-4 left-4 z-40 bg-white dark:bg-neutral-900 rounded-xl shadow-lg border border-neutral-200 dark:border-neutral-800 p-4 max-w-xs",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(b.div,{className:"flex items-center space-x-2",animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,repeatType:"reverse"},children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx(oe,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium",children:[e.jsx("span",{className:"font-bold text-green-600 text-lg",children:l.today.toLocaleString()})," visiteurs aujourd'hui"]})]}),e.jsxs(b.div,{className:"flex items-center space-x-2",animate:{scale:[1,1.02,1]},transition:{duration:1.5,repeat:1/0,repeatType:"reverse"},children:[e.jsx(V,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:[e.jsx("span",{className:"font-bold text-blue-600 text-lg",children:l.currentViewing})," personnes consultent actuellement"]})]}),e.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 space-y-1",children:[e.jsxs("div",{children:["Semaine: ",e.jsx("span",{className:"font-bold text-purple-600 text-sm",children:l.week.toLocaleString()})]}),e.jsxs("div",{children:["Mois: ",e.jsx("span",{className:"font-bold text-orange-600 text-sm",children:l.month.toLocaleString()})]}),e.jsxs("div",{children:["Année: ",e.jsx("span",{className:"font-bold text-red-600 text-sm",children:l.year.toLocaleString()})]})]})]})})},at=()=>{const[o]=_(),{featuredProductCatalog:c,newArrivalProducts:l,promotionalProducts:m,completeProductCatalog:r,filteredProductCatalog:n,dataLoadingComplete:a,setFilteredProductCatalog:i,loadEcommerceProductData:u,handleDataLoadingSuccess:d,handleMaxRetriesReached:t}=ge();return fe(!o.get("q"),a,c.length),G.useEffect(()=>{const s=o.get("q");if(s&&s.length>=3){const h=r.filter(p=>p.name.toLowerCase().includes(s.toLowerCase())||p.description.toLowerCase().includes(s.toLowerCase())||p.category.toLowerCase().includes(s.toLowerCase()));i(h)}else i(r)},[o,r,i]),e.jsxs(Z,{children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(xe,{}),e.jsxs(me,{fetchFunction:u,onSuccess:d,onMaxRetriesReached:t,maxRetries:6,retryInterval:5e3,errorMessage:"Erreur de chargement des produits",loadingComponent:e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-red-600 mx-auto mb-6"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Chargement de votre boutique..."}),e.jsx("p",{className:"text-gray-600",children:"Connexion au serveur en cours..."})]}),children:[o.get("q")&&e.jsx("div",{className:"mb-12",children:e.jsx(P,{products:n,title:`Résultats de recherche : "${o.get("q")}"`})}),!o.get("q")&&e.jsx(pe,{}),!o.get("q")&&e.jsx(ue,{products:c}),!o.get("q")&&e.jsx("div",{className:"mb-12","data-section":"promotional",children:e.jsx(he,{products:m})}),e.jsx("div",{className:"mb-12","data-section":"new-arrivals",children:e.jsx(P,{products:l,title:"Dernières Nouveautés"})}),e.jsx("div",{className:"mb-12","data-section":"complete-catalog",children:e.jsx(P,{products:r,title:"Notre Catalogue Complet",showViewAllButton:!0})}),e.jsx(de,{})]})]}),e.jsx(je,{}),e.jsx(ve,{})]})};export{at as default};
