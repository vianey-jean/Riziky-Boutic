import{_ as V,j as e,C as k,k as B,l as F,c as H,U as I,X as P,B as u,E as $,G as x,J as n}from"./index-Dc-BS1W2.js";import{r as h}from"./emoji-mart-DRerY-OB.js";import{B as g}from"./badge-taJbTjbb.js";import{T as q}from"./textarea-C2Rhkt_I.js";import{S as v,a as N,b as y,c as C,d as c}from"./select-B3i9CjeT.js";import{D as z,b as G,d as L,c as O}from"./dialog-D1sIsNKu.js";import{r as w}from"./remboursementsAPI-7B_PZ2Po.js";import{a as Q,u as _}from"./useMutation-CApHjpg4.js";import{A as b}from"./AdminLayout-CibHDjhS.js";import{T as J}from"./triangle-alert-Btc8UJ8c.js";import{M as K}from"./index-DrCm3EO8.js";import{f as W}from"./format-BqfI4fP3.js";import{f as X}from"./fr-Bao31GFJ.js";import"./index-BkNWx6m2.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./Combination-DuTqoeZY.js";import"./index-DqWbzM0E.js";import"./index-FHuIi1st.js";import"./index-DE01g13U.js";const ge=()=>{const S=V(),A="https://riziky-boutic-server.onrender.com",[t,j]=h.useState(null),[D,l]=h.useState(!1),[a,r]=h.useState({status:"",comment:"",decision:""}),{data:p=[],isLoading:R}=Q({queryKey:["admin-remboursements"],queryFn:async()=>(await w.getAll()).data}),o=_({mutationFn:async({id:s,status:i,comment:d,decision:U})=>await w.updateStatus(s,i,d,U),onSuccess:()=>{S.invalidateQueries({queryKey:["admin-remboursements"]}),n.success("Statut mis à jour avec succès"),l(!1),j(null),r({status:"",comment:"",decision:""})},onError:s=>{var i,d;n.error(((d=(i=s.response)==null?void 0:i.data)==null?void 0:d.message)||"Erreur lors de la mise à jour")}}),m=s=>W(new Date(s),"dd MMMM yyyy à HH:mm",{locale:X}),M=(s,i)=>{switch(s){case"vérification":return"bg-yellow-100 text-yellow-800";case"en étude":return"bg-blue-100 text-blue-800";case"traité":return i==="accepté"?"bg-green-100 text-green-800":"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},f=s=>s?s.startsWith("http")?s:`${A}${s}`:"",E=s=>{j(s),r({status:s.status,comment:"",decision:s.decision||""}),l(!0)},T=()=>{if(t){if(!a.status){n.error("Veuillez sélectionner un statut");return}if(a.status==="traité"&&!a.comment){n.error("Un commentaire est obligatoire pour le statut traité");return}if(a.status==="traité"&&!a.decision){n.error("Veuillez choisir accepter ou refuser");return}o.mutate({id:t.id,status:a.status,comment:a.comment||void 0,decision:a.decision||void 0})}};return R?e.jsx(b,{children:e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Chargement des demandes de remboursement..."})}):e.jsx(b,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Gestion des Remboursements"}),p.length===0?e.jsx("div",{className:"text-center py-10 border rounded-md",children:e.jsx("p",{children:"Aucune demande de remboursement trouvée."})}):e.jsx("div",{className:"grid gap-6",children:p.map(s=>e.jsxs(k,{children:[e.jsx(B,{className:"pb-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsxs(F,{children:["Remboursement #",s.id.split("-")[1]]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Commande #",s.orderId.split("-")[1]," - ",s.userName," (",s.userEmail,")"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Demandé le ",m(s.createdAt)]})]}),e.jsx("div",{className:"mt-2 sm:mt-0",children:e.jsx(g,{className:M(s.status,s.decision),children:s.status==="traité"&&s.decision?`${s.status} - ${s.decision}`:s.status})})]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Raison:"}),e.jsx("p",{className:"text-sm",children:s.reason}),s.customReason&&e.jsxs("p",{className:"text-sm mt-1 text-muted-foreground",children:['"',s.customReason,'"']})]}),s.photo&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Photo justificative:"}),e.jsx("img",{src:f(s.photo),alt:"Photo justificative",className:"w-20 h-20 object-cover rounded border"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="vérification"&&e.jsx(J,{className:"h-4 w-4 text-yellow-500"}),s.status==="en étude"&&e.jsx(K,{className:"h-4 w-4 text-blue-500"}),s.status==="traité"&&s.decision==="accepté"&&e.jsx(I,{className:"h-4 w-4 text-green-500"}),s.status==="traité"&&s.decision==="refusé"&&e.jsx(P,{className:"h-4 w-4 text-red-500"}),e.jsxs("span",{className:"text-sm",children:["Statut: ",s.status,s.decision&&` - ${s.decision}`]})]}),e.jsxs(u,{size:"sm",onClick:()=>E(s),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Gérer"]})]})]})]},s.id))}),e.jsx(z,{open:D,onOpenChange:l,children:e.jsxs(G,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(L,{children:e.jsxs(O,{children:["Gestion du remboursement #",t==null?void 0:t.id.split("-")[1]]})}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Détails de la demande"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Client:"})," ",t.userName," (",t.userEmail,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Commande:"})," #",t.orderId.split("-")[1]]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Raison:"})," ",t.reason]}),t.customReason&&e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",t.customReason]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date de demande:"})," ",m(t.createdAt)]})]})]}),t.photo&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Photo justificative"}),e.jsx("img",{src:f(t.photo),alt:"Photo justificative",className:"w-full max-w-md h-60 object-cover rounded-lg border"})]}),t.adminComments&&t.adminComments.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Commentaires précédents"}),e.jsx("div",{className:"space-y-2",children:t.adminComments.map(s=>e.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:s.adminName}),e.jsx("span",{className:"text-muted-foreground",children:m(s.createdAt)})]}),e.jsx("p",{className:"text-sm mt-1",children:s.comment}),e.jsx(g,{variant:"secondary",className:"mt-1 text-xs",children:s.status})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-4",children:"Mettre à jour le statut"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"status",children:"Nouveau statut"}),e.jsxs(v,{value:a.status,onValueChange:s=>r(i=>({...i,status:s,decision:s!=="traité"?"":i.decision})),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Sélectionner un statut"})}),e.jsxs(C,{children:[e.jsx(c,{value:"vérification",children:"Vérification"}),e.jsx(c,{value:"en étude",children:"En étude"}),e.jsx(c,{value:"traité",children:"Traité"})]})]})]}),a.status==="traité"&&e.jsxs("div",{children:[e.jsx(x,{htmlFor:"decision",children:"Décision"}),e.jsxs(v,{value:a.decision,onValueChange:s=>r(i=>({...i,decision:s})),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Accepter ou refuser"})}),e.jsxs(C,{children:[e.jsx(c,{value:"accepté",children:"Accepter le remboursement"}),e.jsx(c,{value:"refusé",children:"Refuser le remboursement"})]})]})]}),e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"comment",children:["Commentaire ",a.status==="traité"&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(q,{id:"comment",placeholder:"Ajouter un commentaire...",value:a.comment,onChange:s=>r(i=>({...i,comment:s.target.value})),rows:3}),a.status==="traité"&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Un commentaire est obligatoire pour le statut traité"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>l(!1),className:"flex-1",children:"Annuler"}),e.jsx(u,{onClick:T,disabled:o.isPending,className:"flex-1",children:o.isPending?"Mise à jour...":"Mettre à jour"})]})]})]})]})]})})]})})};export{ge as default};
