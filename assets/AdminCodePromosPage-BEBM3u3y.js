import{d as Y,j as e,B as a,C as Z,k as ee,l as se,m as re,c as te,G as p,I as j,J as o}from"./index-Dc-BS1W2.js";import{r}from"./emoji-mart-DRerY-OB.js";import{c as i}from"./codePromosAPI-CIelwPMP.js";import{A as ae}from"./AdminLayout-CibHDjhS.js";import{T as oe,a as ne,b as F,c as u,d as ce,e as m}from"./table-D7tHapga.js";import{D as y,b as S,d as w,c as E,e as P,f as D,g as T}from"./dialog-D1sIsNKu.js";import{B as de}from"./badge-taJbTjbb.js";import{C as le}from"./circle-plus-gGTkOUJD.js";import{S as ie}from"./square-pen-D72gPhkm.js";import{T as ue}from"./trash-2-DHce8VXy.js";import{S as me}from"./search-DlKIh_Ll.js";import"./index-DrCm3EO8.js";import"./index-FHuIi1st.js";import"./Combination-DuTqoeZY.js";import"./index-DE01g13U.js";const g="https://ton-backend.com",De=()=>{Y();const[A,$]=r.useState([]),[H,I]=r.useState(!0),[L,v]=r.useState(!1),[U,f]=r.useState(!1),[G,C]=r.useState(!1),[t,M]=r.useState(null),[Q,k]=r.useState(10),[q,O]=r.useState(1),[h,N]=r.useState(""),[R,c]=r.useState([]),[n,z]=r.useState(null),[B,b]=r.useState(0),x=async()=>{I(!0);try{const s=await i.getAll();$(s.data)}catch(s){console.error("Erreur lors du chargement des codes promos:",s),o.error("Erreur lors du chargement des codes promos")}finally{I(!1)}};r.useEffect(()=>{x()},[]),r.useEffect(()=>{const d=setTimeout(async()=>{if(h.length>=3)try{const l=await i.searchProducts(h);c(l.data)}catch(l){console.error("Erreur lors de la recherche de produits:",l),c([])}else c([])},300);return()=>clearTimeout(d)},[h]);const J=async()=>{if(!n){o.error("Veuillez sélectionner un produit");return}try{await i.create({pourcentage:Q,quantite:q,productId:n.id}),o.success("Code promo créé avec succès"),v(!1),K(),x()}catch(s){console.error("Erreur lors de la création du code promo:",s),o.error("Erreur lors de la création du code promo")}},_=async()=>{if(t)try{await i.update(t.id,B),o.success("Code promo mis à jour avec succès"),f(!1),x()}catch(s){console.error("Erreur lors de la mise à jour du code promo:",s),o.error("Erreur lors de la mise à jour du code promo")}},V=async()=>{if(t)try{await i.delete(t.id),o.success("Code promo supprimé avec succès"),C(!1),x()}catch(s){console.error("Erreur lors de la suppression du code promo:",s),o.error("Erreur lors de la suppression du code promo")}},K=()=>{k(10),O(1),N(""),c([]),z(null),b(0)},W=s=>{M(s),b(s.quantite),f(!0)},X=s=>{M(s),C(!0)};return e.jsx(ae,{children:e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gestion des Codes Promo"}),e.jsxs(a,{onClick:()=>v(!0),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Créer un code promo"]})]}),e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Codes Promo"}),e.jsx(re,{children:"Liste des codes promo disponibles"})]}),e.jsx(te,{children:H?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-800"})}):A.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Aucun code promo disponible"})}):e.jsxs(oe,{children:[e.jsx(ne,{children:e.jsxs(F,{children:[e.jsx(u,{className:"text-center text-red-600 font-bold",children:"Code"}),e.jsx(u,{className:"text-center text-red-600 font-bold",children:"Pourcentage"}),e.jsx(u,{className:"text-center text-red-600 font-bold",children:"Quantité"}),e.jsx(u,{className:"text-center text-red-600 font-bold",children:"Produit"}),e.jsx(u,{className:"text-center text-red-600 font-bold",children:"Actions"})]})}),e.jsx(ce,{children:A.map(s=>e.jsxs(F,{children:[e.jsx(m,{className:"font-medium",children:s.code}),e.jsxs(m,{children:[s.pourcentage,"%"]}),e.jsx(m,{children:e.jsx(de,{variant:s.quantite>0?"outline":"destructive",children:s.quantite})}),e.jsx(m,{children:s.productName||s.productId}),e.jsx(m,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{size:"sm",variant:"outline",onClick:()=>W(s),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(a,{size:"sm",variant:"destructive",onClick:()=>X(s),children:e.jsx(ue,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsx(y,{open:L,onOpenChange:v,children:e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsx(E,{children:"Créer un nouveau code promo"}),e.jsx(P,{children:"Remplissez le formulaire pour créer un nouveau code promo"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(p,{htmlFor:"pourcentage",children:"Pourcentage de réduction"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{id:"pourcentage",type:"number",min:"1",max:"99",value:Q,onChange:s=>k(parseInt(s.target.value)),className:"mr-2"}),e.jsx("span",{children:"%"})]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx(p,{htmlFor:"quantite",children:"Nombre de codes disponibles"}),e.jsx(j,{id:"quantite",type:"number",min:"1",value:q,onChange:s=>O(parseInt(s.target.value))})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx(p,{htmlFor:"produit",children:"Produit applicable"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx(j,{id:"produit",placeholder:"Rechercher un produit (min. 3 caractères)",value:h,onChange:s=>N(s.target.value),className:"pl-8"})]}),R.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-auto",children:R.map(s=>e.jsxs("div",{className:"flex items-center p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{z(s),N(s.name),c([])},children:[e.jsx("img",{src:`${g}${s.image}`,alt:s.name,className:"w-10 h-10 object-cover rounded mr-2",onError:d=>{const l=d.target;l.src=`${g}/uploads/placeholder.jpg`}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.price," €"]})]})]},s.id))})]}),n&&e.jsx("div",{className:"mt-2 p-2 border rounded-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:`${g}${n.image}`,alt:n.name,className:"w-12 h-12 object-cover rounded mr-3",onError:s=>{const d=s.target;d.src=`${g}/uploads/placeholder.jpg`}}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:n.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[n.price," €"]})]})]})})]})]}),e.jsxs(D,{children:[e.jsx(T,{asChild:!0,children:e.jsx(a,{variant:"outline",children:"Annuler"})}),e.jsx(a,{onClick:J,children:"Créer"})]})]})}),e.jsx(y,{open:U,onOpenChange:f,children:e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsx(E,{children:"Modifier le code promo"}),e.jsx(P,{children:"Modifiez la quantité disponible pour ce code promo"})]}),t&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsxs("div",{className:"font-medium",children:["Code: ",t.code]}),e.jsxs("div",{children:["Réduction: ",t.pourcentage,"%"]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx(p,{htmlFor:"newQuantity",children:"Quantité disponible"}),e.jsx(j,{id:"newQuantity",type:"number",min:"0",value:B,onChange:s=>b(parseInt(s.target.value))})]})]}),e.jsxs(D,{children:[e.jsx(T,{asChild:!0,children:e.jsx(a,{variant:"outline",children:"Annuler"})}),e.jsx(a,{onClick:_,children:"Enregistrer"})]})]})}),e.jsx(y,{open:G,onOpenChange:C,children:e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsx(E,{children:"Supprimer le code promo"}),e.jsx(P,{children:"Êtes-vous sûr de vouloir supprimer ce code promo ? Cette action est irréversible."})]}),t&&e.jsxs("div",{className:"p-3 bg-muted rounded-md my-4",children:[e.jsxs("div",{className:"font-medium",children:["Code: ",t.code]}),e.jsxs("div",{children:["Réduction: ",t.pourcentage,"%"]}),e.jsxs("div",{children:["Quantité: ",t.quantite]})]}),e.jsxs(D,{children:[e.jsx(T,{asChild:!0,children:e.jsx(a,{variant:"outline",children:"Annuler"})}),e.jsx(a,{variant:"destructive",onClick:V,children:"Supprimer"})]})]})})]})})};export{De as default};
