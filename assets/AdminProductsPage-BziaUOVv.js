import{j as e,G as V,_ as B,Z as D,J as p,B as d,I as E,X as he}from"./index-Dc-BS1W2.js";import{r as j}from"./emoji-mart-DRerY-OB.js";import{A as ge}from"./AdminLayout-CibHDjhS.js";import{T as xe}from"./textarea-C2Rhkt_I.js";import{D as O,b as M,d as T,c as $,e as q,f as L}from"./dialog-D1sIsNKu.js";import{T as je,a as fe,b as J,c as S,d as ve,e as P}from"./table-D7tHapga.js";import{S as Ne}from"./switch-CHW0mfJ1.js";import{u as A,a as be}from"./useMutation-CApHjpg4.js";import{S as ye,a as we,b as Ce,c as Se,d as Pe}from"./select-B3i9CjeT.js";import{c as De}from"./categoriesAPI-DvU_otkD.js";import{C as Ee}from"./clock-U9VSJiyP.js";import{S as _}from"./square-pen-D72gPhkm.js";import{T as G}from"./trash-2-DHce8VXy.js";import{P as Fe}from"./plus-DTTTuzsk.js";import{P as ke}from"./index-DrCm3EO8.js";import{A as Ae,a as Ie}from"./arrow-up-BRrXiPPU.js";import"./index-FHuIi1st.js";import"./Combination-DuTqoeZY.js";import"./index-DE01g13U.js";import"./index-DqWbzM0E.js";import"./index-C_ZzNLza.js";import"./index-BkNWx6m2.js";import"./index-CE35kS-Q.js";const ze=()=>{const[o,v]=j.useState([]),[w,h]=j.useState(!0);return j.useEffect(()=>{(async()=>{h(!0);try{const m=await De.getActive();v(m.data||[])}catch(m){console.error("Erreur lors du chargement des catégories:",m),v([{id:"1",name:"perruques",description:"",order:1,isActive:!0,createdAt:""},{id:"2",name:"tissages",description:"",order:2,isActive:!0,createdAt:""},{id:"3",name:"queue de cheval",description:"",order:3,isActive:!0,createdAt:""},{id:"4",name:"peigne chauffante",description:"",order:4,isActive:!0,createdAt:""},{id:"5",name:"colle - dissolvant",description:"",order:5,isActive:!0,createdAt:""}])}finally{h(!1)}})()},[]),{categories:o,loading:w}},Oe=({value:o,onChange:v,required:w=!1})=>{const{categories:h,loading:g}=ze();return g?e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(V,{htmlFor:"category",children:["Catégorie ",w&&"*"]}),e.jsx("div",{className:"h-10 bg-gray-100 rounded-md animate-pulse"})]}):e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(V,{htmlFor:"category",children:["Catégorie ",w&&"*"]}),e.jsxs(ye,{value:o,onValueChange:v,required:w,children:[e.jsx(we,{children:e.jsx(Ce,{placeholder:"Sélectionner une catégorie"})}),e.jsx(Se,{children:h.map(m=>e.jsx(Pe,{value:m.name,children:m.name.charAt(0).toUpperCase()+m.name.slice(1)},m.id))})]})]})},Me=({product:o})=>{const v=B(),[w,h]=j.useState(!1),[g,m]=j.useState({promotion:o.promotion||0,hours:24}),R=A({mutationFn:async({id:i,data:u})=>{const c=new FormData;return Object.keys(u).forEach(N=>{c.append(N,u[N].toString())}),D.put(`/products/${i}`,c)},onSuccess:()=>{p.success("Promotion modifiée avec succès"),h(!1),v.invalidateQueries({queryKey:["products"]})},onError:i=>{console.error("Erreur lors de la modification de la promotion:",i),p.error("Erreur lors de la modification de la promotion")}}),F=A({mutationFn:async i=>{const u=new FormData;return u.append("price",(o.originalPrice||o.price).toString()),u.append("originalPrice",""),u.append("promotion",""),u.append("promotionEnd",""),D.put(`/products/${i}`,u)},onSuccess:()=>{p.success("Promotion supprimée avec succès"),v.invalidateQueries({queryKey:["products"]})},onError:i=>{console.error("Erreur lors de la suppression de la promotion:",i),p.error("Erreur lors de la suppression de la promotion")}}),a=()=>!!(o.promotion&&o.promotionEnd&&new Date(o.promotionEnd)>new Date),k=()=>{if(!o.promotionEnd)return"Expirée";const i=new Date(o.promotionEnd).getTime()-new Date().getTime();if(i<=0)return"Expirée";const u=Math.floor(i/(1e3*60*60)),c=Math.floor(i%(1e3*60*60)/(1e3*60));return`${u}h ${c}m`},l=()=>{if(g.promotion<=0){p.error("Veuillez entrer un pourcentage de promotion valide");return}const i=o.originalPrice||o.price,u=1-g.promotion/100,c=parseFloat((i*u).toFixed(2)),N=new Date;N.setHours(N.getHours()+g.hours);const x={price:c,originalPrice:i,promotion:g.promotion,promotionEnd:N.toISOString()};R.mutate({id:o.id,data:x})},C=()=>{F.mutate(o.id)},f=()=>{m({promotion:o.promotion||0,hours:24}),h(!0)};return a()?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"inline-block px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium",children:["-",o.promotion,"%"]}),e.jsxs("p",{className:"text-xs mt-1 flex items-center",children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),k()]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:f,className:"h-6 px-2 text-xs",children:e.jsx(_,{className:"h-3 w-3"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:C,className:"h-6 px-2 text-xs text-red-600 hover:text-red-800",children:e.jsx(G,{className:"h-3 w-3"})})]})]}),e.jsx(O,{open:w,onOpenChange:h,children:e.jsxs(M,{className:"sm:max-w-[425px]",children:[e.jsxs(T,{children:[e.jsx($,{children:"Modifier la promotion"}),e.jsx(q,{children:"Modifiez le pourcentage de réduction et la durée de la promotion."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"promotion",className:"text-right",children:"Réduction (%)"}),e.jsx(E,{id:"promotion",type:"number",min:"1",max:"99",value:g.promotion,onChange:i=>m({...g,promotion:parseInt(i.target.value)||0}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"duration",className:"text-right",children:"Durée (heures)"}),e.jsx(E,{id:"duration",type:"number",min:"1",value:g.hours,onChange:i=>m({...g,hours:parseInt(i.target.value)||24}),className:"col-span-3"})]}),g.promotion>0&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Prix actuel: ",e.jsxs("span",{className:"font-medium",children:[o.price.toFixed(2)," €"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nouveau prix: ",e.jsxs("span",{className:"font-medium",children:[((o.originalPrice||o.price)*(1-g.promotion/100)).toFixed(2)," €"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["La promotion expirera dans ",g.hours," heures."]})]})]}),e.jsxs(L,{children:[e.jsx(d,{variant:"outline",onClick:()=>h(!1),children:"Annuler"}),e.jsx(d,{onClick:l,className:"bg-red-800 hover:bg-red-700",children:"Modifier"})]})]})})]}):null},is=()=>{const o="https://riziky-boutic-server.onrender.com",v=B(),[w,h]=j.useState(!1),[g,m]=j.useState(!1),[R,F]=j.useState(!1),[a,k]=j.useState(null),[l,C]=j.useState({name:"",description:"",price:0,category:"",isSold:!0,stock:0,image:"/placeholder.svg",images:["/placeholder.svg"]}),[f,i]=j.useState({promotion:0,hours:24}),u=j.useRef(null),[c,N]=j.useState([]),[x,I]=j.useState([]),{data:X=[]}=be({queryKey:["products"],queryFn:async()=>(await D.get("/products")).data}),Z=A({mutationFn:async s=>D.post("/products",s),onSuccess:()=>{p.success("Produit ajouté avec succès"),h(!1),v.invalidateQueries({queryKey:["products"]})},onError:s=>{console.error("Erreur lors de l'ajout du produit:",s),p.error("Erreur lors de l'ajout du produit")}}),W=A({mutationFn:async({id:s,formData:r})=>D.put(`/products/${s}`,r),onSuccess:()=>{p.success("Produit mis à jour avec succès"),h(!1),v.invalidateQueries({queryKey:["products"]})},onError:s=>{console.error("Erreur lors de la mise à jour du produit:",s),p.error("Erreur lors de la mise à jour du produit")}}),Y=A({mutationFn:async s=>D.delete(`/products/${s}`),onSuccess:()=>{p.success("Produit supprimé avec succès"),m(!1),v.invalidateQueries({queryKey:["products"]})},onError:s=>{console.error("Erreur lors de la suppression du produit:",s),p.error("Erreur lors de la suppression du produit")}}),ee=A({mutationFn:async({id:s,data:r})=>D.put(`/products/${s}`,r),onSuccess:()=>{p.success("Promotion appliquée avec succès"),F(!1),v.invalidateQueries({queryKey:["products"]})},onError:s=>{console.error("Erreur lors de l'application de la promotion:",s),p.error("Erreur lors de l'application de la promotion")}}),z=s=>{const{name:r,value:t}=s.target;C(n=>({...n,[r]:t}))},se=(s,r)=>{C(t=>({...t,[s]:r}))},re=s=>{C(r=>({...r,isSold:s}))},te=s=>{if(s.target.files&&s.target.files.length>0){const r=Array.from(s.target.files);if(x.length+r.length>4){p.warning("Vous ne pouvez télécharger que 4 images maximum");return}N(y=>[...y,...r]);const b=r.map(y=>URL.createObjectURL(y));I(y=>[...y,...b]),u.current&&(u.current.value="")}},oe=s=>{const r=[...c],t=[...x];s>=c.length||r.splice(s,1),t.splice(s,1),N(r),I(t)},Q=(s,r)=>{if(r==="up"&&s===0||r==="down"&&s===x.length-1)return;const t=[...x],n=[...c];r==="up"?([t[s],t[s-1]]=[t[s-1],t[s]],s<c.length&&s-1<c.length&&([n[s],n[s-1]]=[n[s-1],n[s]])):([t[s],t[s+1]]=[t[s+1],t[s]],s<c.length&&s+1<c.length&&([n[s],n[s+1]]=[n[s+1],n[s]])),N(n),I(t)},ie=()=>{k(null),C({name:"",description:"",price:0,category:"",isSold:!0,stock:0,image:"/placeholder.svg",images:["/placeholder.svg"]}),N([]),I([]),h(!0)},ne=s=>{k(s),C({name:s.name,description:s.description,price:s.price,category:s.category,isSold:s.isSold,stock:s.stock||0,image:s.image,images:s.images||[s.image]});const r=s.images||[s.image];I(r.map(t=>`${o}${t}`)),N([]),h(!0)},ae=s=>{k(s),i({promotion:s.promotion||0,hours:24}),F(!0)},le=s=>{k(s),m(!0)},ce=()=>{if(!l.name||!l.description||l.price===void 0||!l.category){p.error("Veuillez remplir tous les champs obligatoires");return}if(x.length===0){p.error("Veuillez ajouter au moins une image pour le produit");return}const s=new FormData;if(s.append("name",l.name),s.append("description",l.description),s.append("price",l.price.toString()),s.append("category",l.category),s.append("isSold",l.isSold?"true":"false"),s.append("stock",(l.stock||0).toString()),c.length>0){if(c.forEach(t=>{s.append("images",t)}),x.length-c.length>0&&a){const t=[],n=a.images||[a.image];for(let y=c.length;y<x.length;y++){const ue=x[y],K=n.findIndex(pe=>ue===`${o}${pe}`);K!==-1&&t.push(n[K])}const b=[...t];s.append("imagesJson",JSON.stringify(b))}}else if(a){const r=a.images||[a.image],t=[];for(const n of x){const b=r.find(y=>n===`${o}${y}`);b&&t.push(b)}t.length>0&&s.append("imagesJson",JSON.stringify(t))}a?W.mutate({id:a.id,formData:s}):Z.mutate(s)},de=()=>{a&&Y.mutate(a.id)},me=()=>{if(!a||f.promotion<=0){p.error("Veuillez entrer un pourcentage de promotion valide");return}const s=a.price,r=1-f.promotion/100,t=parseFloat((s*r).toFixed(2)),n=new Date;n.setHours(n.getHours()+f.hours);const b=new FormData;b.append("price",t.toString()),b.append("originalPrice",s.toString()),b.append("promotion",f.promotion.toString()),b.append("promotionEnd",n.toISOString()),ee.mutate({id:a.id,data:b})},H=s=>!!(s.promotion&&s.promotionEnd&&new Date(s.promotionEnd)>new Date),U=s=>s.images?s.images.length:1;return e.jsxs(ge,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Gestion des Produits"}),e.jsxs(d,{onClick:ie,className:"bg-red-800 hover:bg-red-700",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Ajouter un produit"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs(J,{children:[e.jsx(S,{children:"Produit"}),e.jsx(S,{children:"Catégorie"}),e.jsx(S,{children:"Prix"}),e.jsx(S,{children:"Stock"}),e.jsx(S,{children:"Promotion"}),e.jsx(S,{children:"Disponible"}),e.jsx(S,{className:"text-right",children:"Actions"})]})}),e.jsx(ve,{children:X.map(s=>e.jsxs(J,{children:[e.jsxs(P,{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative w-[50px]",children:[e.jsx("img",{src:`${o}${s.image}`,alt:s.name,className:"w-10 h-10 object-cover rounded"}),U(s)>1&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:U(s)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-xs",children:s.description})]})]}),e.jsx(P,{children:s.category}),e.jsx(P,{children:H(s)?e.jsxs("div",{children:[e.jsxs("span",{className:"text-xs line-through text-gray-500",children:[typeof s.originalPrice=="number"?s.originalPrice.toFixed(2):s.price.toFixed(2)," €"]}),e.jsxs("span",{className:"block font-semibold",children:[s.price.toFixed(2)," €"]})]}):e.jsxs("span",{children:[s.price.toFixed(2)," €"]})}),e.jsx(P,{children:e.jsx("span",{className:"font-medium",children:s.stock||0})}),e.jsx(P,{children:H(s)?e.jsx(Me,{product:s}):e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>ae(s),className:"text-xs",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Ajouter"]})}),e.jsx(P,{children:e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs ${s.isSold&&(s.stock===void 0||s.stock>0)?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.isSold&&(s.stock===void 0||s.stock>0)?"En stock":"Rupture"})}),e.jsxs(P,{className:"text-right",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>ne(s),children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>le(s),children:e.jsx(G,{className:"h-4 w-4 text-red-500"})})]})]},s.id))})]})}),e.jsx(O,{open:w,onOpenChange:h,children:e.jsxs(M,{className:"sm:max-w-[600px]",children:[e.jsxs(T,{children:[e.jsx($,{children:a?"Modifier le produit":"Ajouter un produit"}),e.jsx(q,{children:a?"Modifier les détails du produit ci-dessous.":"Remplissez les informations pour ajouter un nouveau produit."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Images du produit (maximum 4)"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[x.length>0?x.map((s,r)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 border rounded overflow-hidden",children:e.jsx("img",{src:s,alt:`Aperçu ${r+1}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute -top-2 -right-2 bg-white rounded-full shadow",children:e.jsx(d,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6 p-1 text-red-500",onClick:()=>oe(r),children:e.jsx(he,{size:14})})}),e.jsxs("div",{className:"absolute bottom-0 right-0 flex flex-col bg-white/80 rounded",children:[r>0&&e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>Q(r,"up"),children:e.jsx(Ae,{size:14})}),r<x.length-1&&e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>Q(r,"down"),children:e.jsx(Ie,{size:14})})]}),r===0&&e.jsx("span",{className:"absolute top-0 left-0 bg-blue-500 text-white text-xs px-1 rounded",children:"Principale"})]},r)):e.jsx("div",{className:"w-24 h-24 border rounded flex items-center justify-center text-gray-400",children:"Aucune image"}),x.length<4&&e.jsx("div",{className:"w-24 h-24 border rounded flex items-center justify-center",children:e.jsx(d,{type:"button",variant:"ghost",onClick:()=>{var s;return(s=u.current)==null?void 0:s.click()},children:"+ Ajouter"})})]}),e.jsx("input",{ref:u,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:te}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"La première image sera utilisée comme image principale"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"name",className:"text-right",children:"Nom"}),e.jsx(E,{id:"name",name:"name",value:l.name,onChange:z,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"description",className:"text-right",children:"Description"}),e.jsx(xe,{id:"description",name:"description",value:l.description,onChange:z,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"price",className:"text-right",children:"Prix (€)"}),e.jsx(E,{id:"price",name:"price",type:"number",step:"0.01",value:l.price,onChange:z,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"stock",className:"text-right",children:"Quantité en stock"}),e.jsx(E,{id:"stock",name:"stock",type:"number",min:"0",value:l.stock,onChange:z,className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"category",className:"text-right",children:"Catégorie"}),e.jsx("div",{className:"col-span-3",children:e.jsx(Oe,{value:l.category||"",onChange:s=>se("category",s),required:!0})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"isSold",className:"text-right",children:"En stock"}),e.jsx("div",{className:"col-span-3",children:e.jsx(Ne,{checked:l.isSold,onCheckedChange:re})})]})]}),e.jsxs(L,{children:[e.jsx(d,{variant:"outline",onClick:()=>h(!1),children:"Annuler"}),e.jsx(d,{onClick:ce,className:"bg-red-800 hover:bg-red-700",children:a?"Enregistrer":"Ajouter"})]})]})}),e.jsx(O,{open:g,onOpenChange:m,children:e.jsxs(M,{className:"sm:max-w-[425px]",children:[e.jsxs(T,{children:[e.jsx($,{children:"Confirmer la suppression"}),e.jsx(q,{children:"Êtes-vous sûr de vouloir supprimer ce produit? Cette action est irréversible."})]}),e.jsxs("div",{className:"flex justify-end space-x-2 py-4",children:[e.jsx(d,{variant:"outline",onClick:()=>m(!1),children:"Annuler"}),e.jsx(d,{variant:"destructive",onClick:de,children:"Supprimer"})]})]})}),e.jsx(O,{open:R,onOpenChange:F,children:e.jsxs(M,{className:"sm:max-w-[425px]",children:[e.jsxs(T,{children:[e.jsx($,{children:"Appliquer une promotion"}),e.jsx(q,{children:"Définissez le pourcentage de réduction et la durée de la promotion."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"promotion",className:"text-right",children:"Réduction (%)"}),e.jsx(E,{id:"promotion",type:"number",min:"1",max:"99",value:f.promotion,onChange:s=>i({...f,promotion:parseInt(s.target.value)||0}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"duration",className:"text-right",children:"Durée (heures)"}),e.jsx(E,{id:"duration",type:"number",min:"1",value:f.hours,onChange:s=>i({...f,hours:parseInt(s.target.value)||24}),className:"col-span-3"})]}),a&&f.promotion>0&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Prix actuel: ",e.jsxs("span",{className:"font-medium",children:[a.price.toFixed(2)," €"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nouveau prix: ",e.jsxs("span",{className:"font-medium",children:[(a.price*(1-f.promotion/100)).toFixed(2)," €"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["La promotion expirera dans ",f.hours," heures."]})]})]}),e.jsxs(L,{children:[e.jsx(d,{variant:"outline",onClick:()=>F(!1),children:"Annuler"}),e.jsx(d,{onClick:me,className:"bg-red-800 hover:bg-red-700",children:"Appliquer"})]})]})})]})};export{is as default};
