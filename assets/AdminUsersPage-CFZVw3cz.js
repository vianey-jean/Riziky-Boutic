import{d as $,u as k,j as e,T as F,B as n,I as L,Z as p}from"./index-Dc-BS1W2.js";import{r as u}from"./emoji-mart-DRerY-OB.js";import{A as M}from"./AdminLayout-CibHDjhS.js";import{T as O,a as z,b as f,c as a,d as K,e as t}from"./table-D7tHapga.js";import{D as g,b as v,d as w,c as b,e as C,f as y}from"./dialog-D1sIsNKu.js";import{a as B,u as N}from"./useMutation-CApHjpg4.js";import{S as H,L as G,K as Q}from"./shield-x-BsKCYJAg.js";import{S as V}from"./square-pen-D72gPhkm.js";import"./index-DrCm3EO8.js";import"./index-FHuIi1st.js";import"./Combination-DuTqoeZY.js";import"./index-DE01g13U.js";const te=()=>{const[D,d]=u.useState(!1),[S,c]=u.useState(!1),[i,x]=u.useState(null),[m,h]=u.useState(""),{user:o}=$(),{toast:r}=k(),{data:T=[],refetch:j}=B({queryKey:["users"],queryFn:async()=>(await p.get("/users")).data}),A=N({mutationFn:async({userId:s,role:l})=>p.put(`/users/${s}`,{role:l}),onSuccess:()=>{r({title:"Rôle mis à jour",description:"Le statut de l'utilisateur a été mis à jour avec succès"}),d(!1),j()},onError:s=>{r({title:"Erreur",description:"Impossible de mettre à jour le rôle",variant:"destructive"})}}),P=N({mutationFn:async({userId:s,passwordUnique:l})=>p.put(`/users/${s}/temp-password`,{passwordUnique:l}),onSuccess:()=>{r({title:"Mot de passe temporaire défini",description:"Un mot de passe à usage unique a été défini pour l'utilisateur"}),c(!1),h(""),j()},onError:s=>{r({title:"Erreur",description:"Impossible de définir le mot de passe temporaire",variant:"destructive"})}}),R=s=>{if((o==null?void 0:o.role)!=="admin"){r({title:"Accès refusé",description:"Seuls les administrateurs peuvent modifier les rôles",variant:"destructive"});return}if(s.id==="1"){r({title:"Action non autorisée",description:"L'administrateur principal ne peut pas être rétrogradé",variant:"destructive"});return}x(s),d(!0)},q=()=>{if(i){const s=i.role==="admin"?"client":"admin";A.mutate({userId:i.id,role:s})}},E=s=>{x(s),c(!0)},I=()=>{i&&m?P.mutate({userId:i.id,passwordUnique:m}):r({title:"Erreur",description:"Veuillez saisir un mot de passe temporaire",variant:"destructive"})};return e.jsxs(M,{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Gestion des Utilisateurs"})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs(O,{children:[e.jsx(z,{children:e.jsxs(f,{children:[e.jsx(a,{children:"Nom"}),e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Date d'inscription"}),e.jsx(a,{children:"Rôle"}),e.jsx(a,{children:"Mot de passe"}),e.jsx(a,{children:"Changer le mot de passe"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(K,{children:T.map((s,l)=>e.jsxs(f,{children:[e.jsx(t,{className:"font-medium",children:s.nom}),e.jsx(t,{children:s.email}),e.jsx(t,{children:new Date(s.dateCreation).toLocaleDateString("fr-FR")}),e.jsx(t,{children:e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs ${s.role==="admin"?"bg-red-700 text-white":"bg-gray-100 text-gray-800"}`,children:s.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-3 w-3"})," Administrateur"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-3 w-3"})," Client"]})})}),e.jsxs(t,{children:[s.password&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-mono",children:s.password})]}),s.passwordUnique&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Q,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-mono text-amber-600",children:s.passwordUnique})]})]}),e.jsx(t,{children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>E(s),className:"flex gap-1 items-center",children:[e.jsx(V,{className:"h-4 w-4"})," Modifier"]})}),e.jsx(t,{children:s.id!=="1"&&e.jsx(n,{variant:s.role==="admin"?"destructive":"default",size:"sm",onClick:()=>R(s),disabled:!o||o.role!=="admin",children:s.role==="admin"?"Rétrograder":"Promouvoir"})})]},`user-${s.id}-${l}`))})]})}),e.jsx(g,{open:D,onOpenChange:d,children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(b,{children:"Confirmer le changement de rôle"}),e.jsx(C,{children:(i==null?void 0:i.role)==="admin"?`Êtes-vous sûr de vouloir rétrograder ${i==null?void 0:i.nom} au rôle de client ?`:`Êtes-vous sûr de vouloir promouvoir ${i==null?void 0:i.nom} au rôle d'administrateur ?`})]}),e.jsxs(y,{children:[e.jsx(n,{variant:"outline",onClick:()=>d(!1),children:"Annuler"}),e.jsx(n,{onClick:q,variant:(i==null?void 0:i.role)==="admin"?"destructive":"default",children:"Confirmer"})]})]})}),e.jsx(g,{open:S,onOpenChange:c,children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(b,{children:"Définir un mot de passe temporaire"}),e.jsx(C,{children:`Créez un mot de passe à usage unique pour ${i==null?void 0:i.nom}. L'utilisateur pourra l'utiliser pour réinitialiser son mot de passe.`})]}),e.jsx("div",{className:"py-4",children:e.jsx(L,{type:"text",value:m,onChange:s=>h(s.target.value),placeholder:"Mot de passe à usage unique",className:"w-full"})}),e.jsxs(y,{children:[e.jsx(n,{variant:"outline",onClick:()=>c(!1),children:"Annuler"}),e.jsx(n,{onClick:I,disabled:!m,children:"Enregistrer"})]})]})})]})};export{te as default};
