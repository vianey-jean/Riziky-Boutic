import{o as T,s as j,h as B,i as k,j as e,C as J,k as H,l as Z,m as _,c as G,F as A,n as d,q as u,r as p,t as h,I as x,v as w,B as c,A as K,M as Q,D as W,b as X,w as F,E as U,P as Y,x as ee,L as se,y as z,z as re,J as t}from"./index-Dc-BS1W2.js";import{r as n}from"./emoji-mart-DRerY-OB.js";import{L as oe}from"./Layout-TSHxcvNT.js";import{c as te}from"./pubLayoutAPI-DfYluJku.js";import"./badge-taJbTjbb.js";import"./popover-CGZmNc4e.js";import"./index-DrCm3EO8.js";import"./Combination-DuTqoeZY.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./index-BkNWx6m2.js";import"./index-DE01g13U.js";import"./index--K3sZeIh.js";import"./user-DUzEMHwr.js";import"./index-FHuIi1st.js";import"./select-B3i9CjeT.js";import"./index-DqWbzM0E.js";import"./categoriesAPI-DvU_otkD.js";import"./search-DlKIh_Ll.js";import"./clock-U9VSJiyP.js";import"./database-BKbjrLJf.js";import"./scroll-area-BfHT7kH_.js";import"./useMutation-CApHjpg4.js";import"./arrow-up-BRrXiPPU.js";import"./circle-plus-gGTkOUJD.js";import"./play-C68uu85c.js";import"./house-Qr62Kw0A.js";import"./shield-x-BsKCYJAg.js";import"./video-CY1c3mCS.js";import"./plus-DTTTuzsk.js";import"./square-pen-D72gPhkm.js";import"./trash-2-DHce8VXy.js";import"./triangle-alert-Btc8UJ8c.js";const b="https://riziky-boutic-server.onrender.com",ae=T({email:j().email("Email invalide")}),ie=T({email:j().email("Email invalide"),passwordUnique:j().min(1,"Le code temporaire est requis"),newPassword:j().min(8,"Le mot de passe doit contenir au moins 8 caractères").refine(o=>/[A-Z]/.test(o),"Au moins une majuscule").refine(o=>/[a-z]/.test(o),"Au moins une minuscule").refine(o=>/[0-9]/.test(o),"Au moins un chiffre").refine(o=>/[^A-Za-z0-9]/.test(o),"Au moins un caractère spécial"),confirmPassword:j()}).refine(o=>o.newPassword===o.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}),Me=()=>{const[o,V]=n.useState(!1),[v,L]=n.useState(!1),I=B(),[m,l]=n.useState(!1),[f,N]=n.useState(null),[g,C]=n.useState(!1),[P,S]=n.useState(!1),[E,q]=n.useState(""),y=k({resolver:z(ae),defaultValues:{email:""}}),a=k({resolver:z(ie),defaultValues:{email:"",passwordUnique:"",newPassword:"",confirmPassword:""},mode:"onChange"}),R=async s=>{try{l(!0);const r=await re.checkEmail(s.email);if(!r.data.exists){t.error(`Aucun compte trouvé avec l'email ${s.email}`,{style:{backgroundColor:"red",color:"white"}});return}q(s.email),N(r.data.userId);const i=await fetch(`${b}/api/auth/user-temp-password?email=${encodeURIComponent(s.email)}`);if(!i.ok)throw new Error(`Erreur serveur: ${i.status}`);(await i.json()).passwordUnique?(a.setValue("email",s.email),t.success("Veuillez saisir le code temporaire transmis.",{style:{backgroundColor:"green",color:"white"}})):(S(!0),t.error("Aucun code temporaire n'a été défini pour ce compte.",{style:{backgroundColor:"red",color:"white"}}))}catch(r){console.error("Erreur dans la vérification email:",r),t.error("Une erreur est survenue. Veuillez réessayer plus tard.")}finally{l(!1)}},D=async()=>{const s=a.getValues("passwordUnique");if(!(!f||!E||!s))try{l(!0);const r=await fetch(`${b}/api/auth/verify-temp-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:E,tempPassword:s})}),i=await r.json();r.ok&&i.valid?(C(!0),t.success("Code temporaire valide.",{style:{backgroundColor:"green",color:"white"}})):(C(!1),t.error("Code temporaire invalide.",{style:{backgroundColor:"red",color:"white"}}))}catch(r){console.error("Erreur de vérification du code temporaire:",r),t.error("Une erreur est survenue.",{style:{backgroundColor:"red",color:"white"}})}finally{l(!1)}},$=async s=>{if(f)try{l(!0);const r=await fetch(`${b}/api/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email,passwordUnique:s.passwordUnique,newPassword:s.newPassword})});if(!r.ok){const i=await r.json();throw new Error(i.message||"Erreur inconnue")}t.success("Mot de passe réinitialisé avec succès.",{style:{backgroundColor:"green",color:"white"}}),I("/login")}catch(r){console.error("Erreur de réinitialisation:",r),t.error(r.message||"Une erreur est survenue.",{style:{backgroundColor:"red",color:"white"}})}finally{l(!1)}},M=()=>V(!o),O=()=>L(!v);return e.jsx(oe,{children:e.jsx("div",{className:"flex justify-center items-center min-h-[70vh]",children:e.jsxs(J,{className:"w-[400px]",children:[e.jsxs(H,{children:[e.jsx(Z,{children:"Mot de passe oublié"}),e.jsx(_,{children:f&&!P?"Entrez le code temporaire et créez un nouveau mot de passe":"Entrez votre adresse email pour commencer"})]}),e.jsx(G,{children:f?P?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(K,{variant:"destructive",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(W,{children:"Code temporaire non trouvé"}),e.jsx(X,{children:"Aucun code temporaire n'a été défini pour votre compte. Contactez l'administrateur :"})]}),e.jsx("div",{className:"flex items-center justify-center p-4 bg-muted rounded-md",children:e.jsx("a",{href:"mailto:vianey.jean@ymail.com",className:"text-blue-600 font-medium hover:underline",children:"vianey.jean@ymail.com"})}),e.jsx(c,{variant:"outline",className:"w-full",onClick:()=>{N(null),S(!1),y.reset()},children:"Retour"})]}):e.jsx(A,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit($),className:"space-y-4",children:[e.jsx(d,{control:a.control,name:"email",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Email"}),e.jsx(h,{children:e.jsx(x,{placeholder:"email@example.com",disabled:!0,...s})}),e.jsx(w,{})]})}),e.jsx(d,{control:a.control,name:"passwordUnique",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Code temporaire"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{children:e.jsx(x,{placeholder:"Code temporaire",...s,disabled:g,onChange:r=>{s.onChange(r),C(!1)}})}),g?e.jsx(te,{className:"h-10 w-10 text-green-500"}):e.jsx(c,{type:"button",onClick:D,disabled:!s.value||m,children:"Vérifier"})]}),e.jsx(w,{})]})}),e.jsx(d,{control:a.control,name:"newPassword",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nouveau mot de passe"}),e.jsx(h,{children:e.jsxs("div",{className:"relative",children:[e.jsx(x,{...s,type:o?"text":"password",placeholder:"********"}),e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0",onClick:M,children:o?e.jsx(F,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(U,{className:"h-5 w-5 text-muted-foreground"})})]})}),e.jsx(w,{}),e.jsx(Y,{password:s.value})]})}),e.jsx(d,{control:a.control,name:"confirmPassword",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Confirmer le mot de passe"}),e.jsx(h,{children:e.jsxs("div",{className:"relative",children:[e.jsx(x,{...s,type:v?"text":"password",placeholder:"********"}),e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0",onClick:O,children:v?e.jsx(F,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(U,{className:"h-5 w-5 text-muted-foreground"})})]})}),e.jsx(w,{})]})}),e.jsx(c,{type:"submit",className:"w-full",disabled:m||!g,children:m?"Réinitialisation...":"Réinitialiser"})]})}):e.jsx(A,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(R),className:"space-y-4",children:[e.jsx(d,{control:y.control,name:"email",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Email"}),e.jsx(h,{children:e.jsx(x,{placeholder:"email@example.com",...s})}),e.jsx(w,{})]})}),e.jsx(c,{type:"submit",className:"w-full",disabled:m,children:m?"Vérification...":"Continuer"})]})})}),e.jsx(ee,{children:e.jsx("div",{className:"text-sm text-muted-foreground w-full text-center",children:e.jsx(se,{to:"/login",className:"text-blue-600 hover:underline",children:"Retour à la connexion"})})})]})})})};export{Me as default};
