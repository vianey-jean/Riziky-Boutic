import{o as N,s as S,d as U,h as q,i as x,j as e,C as B,k as T,l as V,m as A,c as J,F as h,n as j,q as g,r as w,t as f,I as b,M as D,v as y,B as l,w as H,E as O,P as R,x as $,L as v,y as C,z as G,J as d}from"./index-Dc-BS1W2.js";import{r as o}from"./emoji-mart-DRerY-OB.js";import{L as K}from"./Layout-TSHxcvNT.js";import"./badge-taJbTjbb.js";import"./popover-CGZmNc4e.js";import"./index-DrCm3EO8.js";import"./Combination-DuTqoeZY.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./index-BkNWx6m2.js";import"./index-DE01g13U.js";import"./index--K3sZeIh.js";import"./user-DUzEMHwr.js";import"./index-FHuIi1st.js";import"./select-B3i9CjeT.js";import"./index-DqWbzM0E.js";import"./categoriesAPI-DvU_otkD.js";import"./pubLayoutAPI-DfYluJku.js";import"./arrow-up-BRrXiPPU.js";import"./database-BKbjrLJf.js";import"./circle-plus-gGTkOUJD.js";import"./clock-U9VSJiyP.js";import"./play-C68uu85c.js";import"./house-Qr62Kw0A.js";import"./shield-x-BsKCYJAg.js";import"./video-CY1c3mCS.js";import"./plus-DTTTuzsk.js";import"./search-DlKIh_Ll.js";import"./square-pen-D72gPhkm.js";import"./trash-2-DHce8VXy.js";import"./triangle-alert-Btc8UJ8c.js";import"./scroll-area-BfHT7kH_.js";import"./useMutation-CApHjpg4.js";const Q=N({email:S().email("Email invalide")}),W=N({password:S().min(1,"Mot de passe requis")}),Pe=()=>{const{login:E}=U();q();const[n,F]=o.useState(!1),[L,p]=o.useState("email"),[u,k]=o.useState(""),[X,P]=o.useState(""),[t,i]=o.useState(!1),m=x({resolver:C(Q),defaultValues:{email:""}}),c=x({resolver:C(W),defaultValues:{password:""}}),M=async s=>{const r=s.email.trim().toLowerCase();try{i(!0);const a=await G.checkEmail(r);a.data.exists?(k(r),P(a.data.user.nom||"Utilisateur"),p("password"),d.success(`Bienvenue ${a.data.user.nom||"Utilisateur"}`,{style:{backgroundColor:"green",color:"white"}})):d.error("Cet email n'existe pas",{style:{backgroundColor:"red",color:"white"}})}catch(a){console.error("Erreur lors de la vérification de l'email:",a),d.error("Erreur lors de la vérification de l'email",{style:{backgroundColor:"red",color:"white"}})}finally{i(!1)}},I=async s=>{try{i(!0),await E(u,s.password)}catch(r){console.error("Erreur de connexion:",r)}finally{i(!1)}},z=()=>F(!n);return e.jsx(K,{children:e.jsx("div",{className:"flex justify-center items-center min-h-[70vh]",children:e.jsxs(B,{className:"w-[400px]",children:[e.jsxs(T,{children:[e.jsx(V,{children:"Connexion"}),e.jsx(A,{children:"Accédez à votre compte"})]}),e.jsx(J,{children:L==="email"?e.jsx(h,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(M),className:"space-y-4",children:[e.jsx(j,{control:m.control,name:"email",render:({field:s})=>e.jsxs(g,{children:[e.jsx(w,{children:"Email"}),e.jsx(f,{children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{...s,placeholder:"email@example.com",onChange:r=>s.onChange(r.target.value.trim())}),e.jsx(D,{className:"absolute right-3 top-2.5 h-5 w-5 text-muted-foreground"})]})}),e.jsx(y,{})]})}),e.jsx(l,{type:"submit",className:"w-full",disabled:t,children:t?"Chargement...":"Continuer"})]})}):e.jsx(h,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(I),className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-green-600 mb-4",children:["Connecté en tant que : ",e.jsx("strong",{children:u})]}),e.jsx(j,{control:c.control,name:"password",render:({field:s})=>e.jsxs(g,{children:[e.jsx(w,{children:"Mot de passe"}),e.jsx(f,{children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{...s,type:n?"text":"password",placeholder:"********"}),e.jsx(l,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0",onClick:z,children:n?e.jsx(H,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(O,{className:"h-5 w-5 text-muted-foreground"})})]})}),e.jsx(y,{}),e.jsx(R,{password:s.value})]})}),e.jsx(l,{type:"submit",className:"w-full",disabled:t,children:t?"Connexion...":"Se connecter"}),e.jsx(l,{type:"button",variant:"outline",className:"w-full mt-2",onClick:()=>p("email"),disabled:t,children:"Modifier l'email"})]})})}),e.jsxs($,{className:"flex flex-col gap-2",children:[e.jsx(v,{to:"/forgot-password",className:"text-sm text-blue-600 hover:underline",children:"Mot de passe oublié ?"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Pas encore de compte ?"," ",e.jsx(v,{to:"/register",className:"text-blue-600 hover:underline",children:"S'inscrire"})]})]})]})})})};export{Pe as default};
