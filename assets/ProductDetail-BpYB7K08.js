import{j as e,B as y,A as _,b as H,G as F,X as fe,J as R,d as ae,D as ee,H as ge,h as je,K as ve,N as Ne,O as be,Q as we,S as E,R as ye,T as ke,U as se}from"./index-Dc-BS1W2.js";import{r as n}from"./emoji-mart-DRerY-OB.js";import{m as ne,L as O,e as Se}from"./Layout-TSHxcvNT.js";import{P as Re,r as W,S as A}from"./ProductCard-Cq7PI4fG.js";import{d as B,G as Ce,e as Pe,S as Ae,H as Ee,f as Le}from"./pubLayoutAPI-DfYluJku.js";import{C as G}from"./user-DUzEMHwr.js";import{S as le}from"./separator-6a6jIHNF.js";import{D as ie,a as De,b as oe,c as ce,d as Te,e as Ie}from"./dialog-D1sIsNKu.js";import{T as de}from"./triangle-alert-Btc8UJ8c.js";import{f as me}from"./formatDistanceToNow-ysryFQKv.js";import{f as ue}from"./fr-Bao31GFJ.js";import{T as $e}from"./textarea-C2Rhkt_I.js";import{B as te}from"./badge-taJbTjbb.js";import{T as ze,a as Fe,b as M,c as U}from"./tabs-B2Ic9XCE.js";import{C as Ve}from"./clock-U9VSJiyP.js";import{T as Oe}from"./index-DrCm3EO8.js";import"./popover-CGZmNc4e.js";import"./Combination-DuTqoeZY.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./index-BkNWx6m2.js";import"./index-DE01g13U.js";import"./index--K3sZeIh.js";import"./index-FHuIi1st.js";import"./select-B3i9CjeT.js";import"./index-DqWbzM0E.js";import"./categoriesAPI-DvU_otkD.js";import"./search-DlKIh_Ll.js";import"./database-BKbjrLJf.js";import"./scroll-area-BfHT7kH_.js";import"./useMutation-CApHjpg4.js";import"./arrow-up-BRrXiPPU.js";import"./circle-plus-gGTkOUJD.js";import"./play-C68uu85c.js";import"./house-Qr62Kw0A.js";import"./shield-x-BsKCYJAg.js";import"./video-CY1c3mCS.js";import"./plus-DTTTuzsk.js";import"./square-pen-D72gPhkm.js";import"./trash-2-DHce8VXy.js";const Me=({products:t,title:a,description:l,seeAllLink:r="",slidesToShow:i=4})=>{const[d,j]=n.useState(0),[N,o]=n.useState(window.innerWidth<768),m=n.useRef(null);n.useEffect(()=>{const g=()=>{const w=window.innerWidth<768;o(w)};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]);const s=N?1:Math.min(i,4),v=Math.max(0,t.length-s),b=()=>{j(g=>Math.min(g+1,v))},P=()=>{j(g=>Math.max(g-1,0))};return e.jsx("div",{className:"my-12 py-8 px-4 bg-gradient-to-r from-white via-gray-50 to-white dark:from-neutral-900 dark:via-black dark:to-neutral-900 rounded-xl shadow-sm",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8",children:[e.jsxs("div",{className:"mb-4 md:mb-0",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100",children:a}),l&&e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:l})]}),r&&e.jsx(y,{asChild:!0,variant:"outline",className:"self-end md:self-auto",children:e.jsx("a",{href:r,children:"Voir tout"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"overflow-hidden",ref:m,children:e.jsx(ne.div,{className:"flex",animate:{x:`calc(-${d*100}% / ${s})`},transition:{type:"spring",stiffness:300,damping:30},style:{width:`calc(${t.length*100}% / ${s})`},children:t.map(g=>e.jsx("div",{className:"px-2",style:{width:`calc(100% / ${t.length})`},children:e.jsx(Re,{product:g})},g.id))})}),d>0&&e.jsx(y,{variant:"outline",size:"icon",className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-4 bg-white dark:bg-black rounded-full shadow-lg z-10",onClick:P,"aria-label":"Produits précédents",children:e.jsx(B,{className:"h-5 w-5"})}),d<v&&e.jsx(y,{variant:"outline",size:"icon",className:"absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-4 bg-white dark:bg-black rounded-full shadow-lg z-10",onClick:b,"aria-label":"Produits suivants",children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex justify-center mt-6 space-x-2",children:Array.from({length:v+1}).map((g,w)=>e.jsx("button",{className:`w-2 h-2 rounded-full ${d===w?"bg-red-600":"bg-gray-300 dark:bg-gray-700"}`,onClick:()=>j(w),"aria-label":`Aller à la page ${w+1}`},w))})]})})};function re(t,a){if(typeof t=="function")return t(a);t!=null&&(t.current=a)}function Ue(...t){return a=>{let l=!1;const r=t.map(i=>{const d=re(i,a);return!l&&typeof d=="function"&&(l=!0),d});if(l)return()=>{for(let i=0;i<r.length;i++){const d=r[i];typeof d=="function"?d():re(t[i],null)}}}}function _e(...t){return n.useCallback(Ue(...t),t)}function He(t){const a=We(t),l=n.forwardRef((r,i)=>{const{children:d,...j}=r,N=n.Children.toArray(d),o=N.find(Ge);if(o){const m=o.props.children,s=N.map(v=>v===o?n.Children.count(m)>1?n.Children.only(null):n.isValidElement(m)?m.props.children:null:v);return e.jsx(a,{...j,ref:i,children:n.isValidElement(m)?n.cloneElement(m,void 0,s):null})}return e.jsx(a,{...j,ref:i,children:d})});return l.displayName=`${t}.Slot`,l}function We(t){const a=n.forwardRef((l,r)=>{const{children:i,...d}=l,j=n.isValidElement(i)?Je(i):void 0,N=_e(j,r);if(n.isValidElement(i)){const o=qe(d,i.props);return i.type!==n.Fragment&&(o.ref=N),n.cloneElement(i,o)}return n.Children.count(i)>1?n.Children.only(null):null});return a.displayName=`${t}.SlotClone`,a}var Be=Symbol("radix.slottable");function Ge(t){return n.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Be}function qe(t,a){const l={...a};for(const r in a){const i=t[r],d=a[r];/^on[A-Z]/.test(r)?i&&d?l[r]=(...N)=>{const o=d(...N);return i(...N),o}:i&&(l[r]=i):r==="style"?l[r]={...i,...d}:r==="className"&&(l[r]=[i,d].filter(Boolean).join(" "))}return{...t,...l}}function Je(t){var r,i;let a=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,l=a&&"isReactWarning"in a&&a.isReactWarning;return l?t.ref:(a=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,l=a&&"isReactWarning"in a&&a.isReactWarning,l?t.props.ref:t.props.ref||t.ref)}var Ke=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Qe=Ke.reduce((t,a)=>{const l=He(`Primitive.${a}`),r=n.forwardRef((i,d)=>{const{asChild:j,...N}=i,o=j?l:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(o,{...N,ref:d})});return r.displayName=`Primitive.${a}`,{...t,[a]:r}},{}),Ye=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Xe="VisuallyHidden",he=n.forwardRef((t,a)=>e.jsx(Qe.span,{...t,ref:a,style:{...Ye,...t.style}}));he.displayName=Xe;const Ze=({photos:t,reviewId:a})=>{const l="https://riziky-boutic-server.onrender.com",r=n.useRef(null),[i,d]=n.useState(!1),[j,N]=n.useState(!1),[o,m]=n.useState(0),[s,v]=n.useState(!1),b=()=>{const x=r.current;if(x){const{scrollLeft:h,scrollWidth:u,clientWidth:p}=x;d(h>5),N(h+p<u-5)}};n.useEffect(()=>{b();const x=r.current;return x==null||x.addEventListener("scroll",b),window.addEventListener("resize",b),()=>{x==null||x.removeEventListener("scroll",b),window.removeEventListener("resize",b)}},[t]),n.useEffect(()=>{const x=h=>{s&&(h.key==="ArrowLeft"?g("prev"):h.key==="ArrowRight"&&g("next"))};return window.addEventListener("keydown",x),()=>{window.removeEventListener("keydown",x)}},[s,o]);const P=x=>{const h=r.current;if(h){const u=h.clientWidth/1.5,p=x==="left"?h.scrollLeft-u:h.scrollLeft+u;h.scrollTo({left:p,behavior:"smooth"}),setTimeout(b,350)}},g=x=>{x==="prev"&&o>0?m(h=>h-1):x==="next"&&o<t.length-1&&m(h=>h+1)},w=x=>{m(x),v(!0)};return!t||t.length===0?null:e.jsx("div",{className:"mt-3 relative",children:e.jsxs("div",{className:"flex items-center",children:[t.length>3&&e.jsxs(y,{variant:"outline",size:"icon",className:`absolute left-0 z-10 rounded-full h-8 w-8 bg-white shadow-md border transition-opacity ${i?"":"opacity-0 pointer-events-none"}`,onClick:()=>P("left"),children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Photos précédentes"})]}),e.jsx("div",{ref:r,className:"flex overflow-x-auto gap-2 py-1 px-2 scrollbar-hide scroll-smooth",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:t.map((x,h)=>e.jsxs(ie,{open:s&&o===h,onOpenChange:u=>{u?w(h):v(!1)},children:[e.jsx(De,{asChild:!0,children:e.jsx("div",{className:"w-16 h-16 rounded overflow-hidden cursor-pointer hover:opacity-90 transition-opacity flex-shrink-0",children:e.jsx("img",{src:`${l}${x}`,alt:`Photo du commentaire ${h+1}`,className:"w-full h-full object-cover"})})}),e.jsxs(oe,{className:"max-w-3xl p-1 bg-background",children:[e.jsx(ce,{children:e.jsxs(he,{children:["Photo ",h+1]})}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:`${l}${t[o]}`,alt:`Photo du commentaire ${o+1}`,className:"w-full h-auto max-h-[80vh] object-contain"}),o>0&&e.jsxs(y,{variant:"outline",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 rounded-full h-10 w-10 bg-white/80 shadow-md border hover:bg-white",onClick:u=>{u.preventDefault(),u.stopPropagation(),g("prev")},children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Photo précédente"})]}),o<t.length-1&&e.jsxs(y,{variant:"outline",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 rounded-full h-10 w-10 bg-white/80 shadow-md border hover:bg-white",onClick:u=>{u.preventDefault(),u.stopPropagation(),g("next")},children:[e.jsx(G,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Photo suivante"})]})]})]})]},h))}),t.length>3&&e.jsxs(y,{variant:"outline",size:"icon",className:`absolute right-0 z-10 rounded-full h-8 w-8 bg-white shadow-md border transition-opacity ${j?"":"opacity-0 pointer-events-none"}`,onClick:()=>P("right"),children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Photos suivantes"})]})]})})},es=({reviewId:t,onClose:a,isOpen:l})=>{const[r,i]=n.useState(null),[d,j]=n.useState(!0),[N,o]=n.useState(null),m="https://riziky-boutic-server.onrender.com";n.useEffect(()=>{l&&t&&s()},[t,l]);const s=async()=>{j(!0),o(null);try{const v=await W.getReviewDetail(t);i(v.data)}catch(v){console.error("Erreur lors du chargement des détails du commentaire:",v),o("Impossible de charger les détails du commentaire")}finally{j(!1)}};return e.jsx(ie,{open:l,onOpenChange:v=>!v&&a(),children:e.jsxs(oe,{className:"max-w-3xl",children:[e.jsxs(Te,{children:[e.jsx(ce,{children:"Détails du commentaire"}),e.jsx(Ie,{children:"Informations détaillées sur l'avis client"})]}),d?e.jsx("div",{className:"flex justify-center py-8",children:"Chargement..."}):N?e.jsxs(_,{variant:"destructive",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(H,{children:N})]}):r?e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-medium",children:r.userName}),e.jsx("span",{className:"text-sm text-muted-foreground",children:me(new Date(r.createdAt),{addSuffix:!0,locale:ue})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Produit"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{rating:r.productRating,readOnly:!0}),e.jsx("span",{className:"ml-2 font-semibold",children:r.productRating})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Livraison"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{rating:r.deliveryRating,readOnly:!0}),e.jsx("span",{className:"ml-2 font-semibold",children:r.deliveryRating})]})]})]}),r.comment&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Commentaire"}),e.jsx("p",{className:"text-sm",children:r.comment})]}),r.photos&&r.photos.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx(le,{className:"mb-4"}),e.jsxs("h4",{className:"font-medium mb-3",children:["Photos publiées (",r.photos.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:r.photos.map((v,b)=>e.jsx("img",{src:`${m}${v}`,alt:`Photo ${b+1}`,className:"w-full h-auto rounded-md object-contain"},b))})]})]}):e.jsx("div",{className:"text-center py-4",children:"Commentaire non trouvé"})]})})},ss=({reviews:t})=>{const[a,l]=n.useState(null);return t.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted-foreground",children:"Aucun commentaire pour ce produit."})}):e.jsxs("section",{className:"reviews-section",children:[e.jsx("h2",{className:"sr-only",children:"Commentaires des clients"}),e.jsx("ul",{className:"space-y-6",children:t.map(r=>e.jsx("li",{className:"border-b pb-4",children:e.jsxs("article",{className:"review-item",children:[e.jsxs("header",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-medium",children:r.userName}),e.jsx("time",{className:"text-sm text-muted-foreground",dateTime:r.createdAt,children:me(new Date(r.createdAt),{addSuffix:!0,locale:ue})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Produit"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(A,{rating:r.productRating,readOnly:!0})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1 text-center",children:"Livraison"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(A,{rating:r.deliveryRating,readOnly:!0})})]})]}),r.comment&&e.jsx("p",{className:"mt-2 text-sm",children:r.comment}),r.photos&&r.photos.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"flex justify-center w-full",children:e.jsx(Ze,{photos:r.photos,reviewId:r.id})}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>l(r.id),children:[e.jsx(Ce,{className:"mr-1 h-4 w-4"}),"Voir toutes les photos et détails"]})})]})]})},r.id))}),a&&e.jsx(es,{reviewId:a,isOpen:!!a,onClose:()=>l(null)})]})},ts=({productId:t,onSubmit:a})=>{const[l,r]=n.useState(0),[i,d]=n.useState(0),[j,N]=n.useState(""),[o,m]=n.useState([]),[s,v]=n.useState([]),[b,P]=n.useState(!1),g=n.useRef(null),w=()=>{var p;(p=g.current)==null||p.click()},x=p=>{const c=p.target.files;if(c){if(o.length+c.length>4){R.error("Vous ne pouvez pas ajouter plus de 4 photos.");return}const k=[...o],L=[...s];Array.from(c).forEach(S=>{if(!S.type.startsWith("image/")){R.error(`Le fichier ${S.name} n'est pas une image.`);return}if(S.size>2*1024*1024){R.error(`L'image ${S.name} est trop volumineuse. La taille maximale est de 2MB.`);return}k.push(S),L.push(URL.createObjectURL(S))}),m(k),v(L),g.current&&(g.current.value="")}},h=p=>{const c=[...o],k=[...s];URL.revokeObjectURL(k[p]),c.splice(p,1),k.splice(p,1),m(c),v(k)},u=async p=>{if(p.preventDefault(),l===0){R.error("Veuillez noter le produit.");return}if(i===0){R.error("Veuillez noter la livraison.");return}if(!j.trim()){R.error("Veuillez ajouter un commentaire.");return}P(!0);try{const c=new FormData;c.append("productId",t),c.append("productRating",l.toString()),c.append("deliveryRating",i.toString()),c.append("comment",j),o.forEach(k=>{c.append("photos",k)}),await a(c),r(0),d(0),N(""),s.forEach(k=>URL.revokeObjectURL(k)),m([]),v([])}catch(c){console.error("Error submitting review:",c),R.error("Une erreur est survenue lors de la soumission de votre avis.")}finally{P(!1)}};return e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"product-rating",children:"Note du produit"}),e.jsx("div",{className:"mt-1",children:e.jsx(A,{rating:l,value:l,onChange:r,id:"product-rating",readOnly:!1})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"delivery-rating",children:"Note de la livraison"}),e.jsx("div",{className:"mt-1",children:e.jsx(A,{rating:i,value:i,onChange:d,id:"delivery-rating",readOnly:!1})})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"comment",children:"Commentaire"}),e.jsx($e,{id:"comment",placeholder:"Partagez votre expérience avec ce produit...",value:j,onChange:p=>N(p.target.value),className:"h-24"})]}),e.jsxs("div",{children:[e.jsx(F,{children:"Photos (optionnel)"}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2",children:[s.map((p,c)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:p,alt:`Aperçu ${c+1}`,className:"w-20 h-20 object-cover rounded-md"}),e.jsx("button",{type:"button",className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1",onClick:()=>h(c),children:e.jsx(fe,{className:"h-3 w-3"})})]},c)),o.length<4&&e.jsx("button",{type:"button",onClick:w,className:"w-20 h-20 border-2 border-dashed border-gray-300 rounded-md flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-50",children:e.jsx(Pe,{className:"h-6 w-6"})}),e.jsx("input",{type:"file",ref:g,onChange:x,accept:"image/*",multiple:!0,className:"hidden"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Vous pouvez ajouter jusqu'à 4 photos (max 2MB chacune)"})]}),e.jsx(y,{type:"submit",disabled:b,className:"bg-red-800 hover:bg-red-700 text-white",children:b?"Envoi en cours...":"Soumettre l'avis"})]})},rs=({productId:t})=>{const[a,l]=n.useState([]),[r,i]=n.useState(!0),[d,j]=n.useState(null),[N,o]=n.useState(!1),{isAuthenticated:m}=ae(),s=async()=>{i(!0),j(null);try{console.log("Fetching reviews for product:",t);const u=await W.getProductReviews(t);console.log("Reviews response:",u.data),l(u.data)}catch(u){console.error("Erreur lors du chargement des commentaires:",u),j("Impossible de charger les commentaires")}finally{i(!1)}};n.useEffect(()=>{s()},[t]);const v=async u=>{try{await W.addReview(u),s(),o(!1)}catch(p){throw console.error("Erreur lors de l'ajout du commentaire:",p),p}},b=()=>{if(!a||a.length===0)return{productAvg:0,deliveryAvg:0,totalAvg:0};const u=a.reduce((S,D)=>S+D.productRating,0),p=a.reduce((S,D)=>S+D.deliveryRating,0),c=u/a.length,k=p/a.length,L=(c+k)/2;return{productAvg:c,deliveryAvg:k,totalAvg:L}},P=()=>a.reduce((u,p)=>{var c;return u+(((c=p.photos)==null?void 0:c.length)||0)},0),{productAvg:g,deliveryAvg:w,totalAvg:x}=b(),h=P();return r?e.jsx("div",{className:"py-4 text-center",children:"Chargement des commentaires..."}):d?e.jsxs(_,{variant:"destructive",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(ee,{children:"Erreur"}),e.jsx(H,{children:d})]}):e.jsxs("div",{className:"my-8",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6",children:"Avis clients"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-4xl font-bold mb-2",children:x.toFixed(1)}),e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(A,{rating:x})}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[a.length," avis ",h>0?`· ${h} photos`:""]})]}),e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Produit"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{rating:g}),e.jsx("span",{className:"ml-2 font-semibold",children:g.toFixed(1)})]})})]}),e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Livraison"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{rating:w}),e.jsx("span",{className:"ml-2 font-semibold",children:w.toFixed(1)})]})})]})]}),m&&!N&&e.jsx("div",{className:"mb-8",children:e.jsx(y,{variant:"outline",onClick:()=>o(!0),className:"w-full md:w-auto text-red-800",children:"Donnez votre avis"})}),m&&N&&e.jsxs("div",{className:"mb-8",children:[e.jsx(ts,{productId:t,onSubmit:u=>v({productId:t,productRating:u.productRating,deliveryRating:u.deliveryRating,comment:u.comment,photos:u.photos})}),e.jsx("div",{className:"mt-2 text-right",children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>o(!1),children:"Annuler"})})]}),!m&&e.jsxs(_,{className:"mb-8",children:[e.jsx(ee,{children:"Connectez-vous pour laisser un avis"}),e.jsx(H,{children:"Vous devez être connecté pour pouvoir partager votre expérience avec ce produit."})]}),e.jsx(le,{className:"mb-6"}),e.jsx(ss,{reviews:a})]})},Ws=()=>{const{productId:t}=ge(),a=je(),{products:l,addToCart:r,toggleFavorite:i,isFavorite:d}=ve(),{isAuthenticated:j}=ae(),N="https://riziky-boutic-server.onrender.com",o="/placeholder.svg";console.log("ProductDetail - Secure ID:",t);const m=t?Ne(t):void 0;console.log("ProductDetail - Real ID:",m);const[s,v]=n.useState(l.find(f=>f.id===m)),[b,P]=n.useState(0),[g,w]=n.useState(""),[x,h]=n.useState(!0),[u,p]=n.useState(!0),[c,k]=n.useState(1),[L,S]=n.useState(!1);n.useEffect(()=>{if(p(!0),!t){h(!1),R.error("Produit non trouvé"),a("/page/notfound",{replace:!0});return}const f=be(t),C=we(t);if(console.log("ProductDetail - Validation:",{isValid:f,entityType:C,productId:m}),!f)h(!1),R.error("Ce lien n'est plus valide"),a("/page/notfound",{replace:!0});else{const T=l.find(I=>I.id===m);T?(v(T),h(!0)):(console.log("ProductDetail - Produit non trouvé:",m),h(!1),R.error("Produit introuvable"),a("/page/notfound",{replace:!0}))}p(!1)},[t,m,l,a]),n.useEffect(()=>{if(s&&s.promotion&&s.promotionEnd){const f=()=>{const T=new Date(s.promotionEnd),I=new Date,$=T.getTime()-I.getTime();if($<=0){w("Promotion expirée");return}const Q=Math.floor($/(1e3*60*60*24)),Y=Math.floor($%(1e3*60*60*24)/(1e3*60*60)),X=Math.floor($%(1e3*60)/(1e3*60)),Z=Math.floor($%(1e3*60)/1e3);Q>0?w(`${Q}j ${Y}h ${X}m ${Z}s`):w(`${Y}h ${X}m ${Z}s`)};f();const C=setInterval(f,1e3);return()=>clearInterval(C)}},[s]);const D=f=>{f>0&&((s==null?void 0:s.stock)===void 0||f<=s.stock)&&k(f)},xe=()=>{if(!j){R.error("Vous devez être connecté pour ajouter un produit au panier",{style:{backgroundColor:"#EF4444",color:"white",fontWeight:"bold"},duration:4e3,position:"top-center"});return}if(s){for(let f=0;f<c;f++)r(s);S(!0),R.success(`${c} ${c>1?"exemplaires":"exemplaire"} ajouté${c>1?"s":""} au panier`),setTimeout(()=>{S(!1)},2e3)}};if(u)return e.jsx(O,{children:e.jsx("div",{className:"container mx-auto px-4 py-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(E,{className:"w-full h-[400px] rounded-xl mb-4"}),e.jsx("div",{className:"flex justify-center space-x-2",children:[...Array(4)].map((f,C)=>e.jsx(E,{className:"w-20 h-20 rounded-md"},C))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(E,{className:"w-3/4 h-8 mb-3"}),e.jsx(E,{className:"w-1/2 h-6 mb-6"}),e.jsx(E,{className:"w-1/4 h-5 mb-8"}),e.jsx(E,{className:"w-full h-32 mb-6"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(E,{className:"w-1/3 h-10"}),e.jsx(E,{className:"w-1/3 h-10"})]})]})]})})});if(!x||!s)return e.jsx(O,{children:e.jsxs("div",{className:"container mx-auto px-4 py-20 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Produit non trouvé"}),e.jsx("p",{className:"mb-8 text-gray-600 max-w-md mx-auto",children:"Le produit que vous recherchez n'existe pas ou a été supprimé."}),e.jsx(y,{asChild:!0,children:e.jsx("a",{href:"/",children:"Retour à l'accueil"})})]})});const q=l.filter(f=>f.category===(s==null?void 0:s.category)&&f.id!==(s==null?void 0:s.id)).slice(0,8),pe=m?d(m):!1,J=s.promotion&&s.promotionEnd&&new Date(s.promotionEnd)>new Date,z=s.isSold&&(s.stock===void 0||s.stock>0),V=s.images&&s.images.length>0?s.images:s.image?[s.image]:[],K=f=>f?f.startsWith("http")?f:`${N}${f}`:o;return e.jsx(O,{children:e.jsxs("div",{className:"container mx-auto px-4 py-10",children:[e.jsxs(y,{variant:"ghost",className:"mb-6 flex items-center text-neutral-600 hover:text-neutral-900 dark:text-neutral-400 dark:hover:text-neutral-100",onClick:()=>a(-1),children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Retour"]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-10",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-4 relative bg-neutral-50 dark:bg-neutral-900 rounded-xl overflow-hidden",children:[e.jsx(Se,{mode:"wait",children:e.jsx(ne.img,{src:K(V[b]),alt:s.name,className:"w-full h-[500px] object-contain rounded-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onError:f=>{console.log("Erreur de chargement d'image détaillée, utilisation du placeholder");const C=f.target;C.src=o}},b)}),J&&e.jsxs("div",{className:"absolute top-4 right-4 bg-red-600 text-white px-3 py-1.5 rounded-full text-sm font-bold",children:["-",s.promotion,"%"]})]}),V.length>1&&e.jsx("div",{className:"flex justify-center flex-wrap gap-3 mt-4",children:V.map((f,C)=>e.jsx("div",{className:`w-20 h-20 overflow-hidden rounded-md cursor-pointer border-2 transition-all ${C===b?"border-red-500 shadow-md":"border-transparent hover:border-red-300"}`,onClick:()=>P(C),children:e.jsx("img",{src:K(f),alt:`${s.name} - image ${C+1}`,className:"w-full h-full object-cover",onError:T=>{const I=T.target;I.src=o}})},C))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{variant:"outline",className:"px-2 py-1 text-xs bg-neutral-100 dark:bg-neutral-800",children:s.category}),s.dateAjout&&new Date().getTime()-new Date(s.dateAjout).getTime()<7*24*60*60*1e3&&e.jsx(te,{className:"bg-blue-600 text-white",children:"Nouveau"})]}),e.jsx("h1",{className:"text-3xl font-bold mb-4 text-neutral-900 dark:text-neutral-100",children:s.name}),J?e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900 rounded-lg border border-red-100 dark:border-red-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("p",{className:"text-xl text-gray-500 line-through",children:[typeof s.originalPrice=="number"?s.originalPrice.toFixed(2):s.price.toFixed(2)," ","€"]}),e.jsxs("span",{className:"bg-red-600 text-white px-2 py-0.5 text-sm font-bold rounded",children:["-",s.promotion,"%"]})]}),e.jsxs("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:[s.price.toFixed(2)," €"]}),g&&e.jsxs("div",{className:"mt-3 flex items-center text-sm",children:[e.jsx(Ve,{className:"h-4 w-4 mr-1.5 text-red-600 dark:text-red-400"}),e.jsxs("span",{className:"font-medium",children:["La promotion se termine dans: ",e.jsx("span",{className:"font-bold",children:g})]})]})]}):e.jsxs("p",{className:"text-2xl font-bold mb-6 text-neutral-900 dark:text-neutral-100",children:[s.price.toFixed(2)," €"]}),e.jsxs(ze,{defaultValue:"description",className:"mt-6 mb-8",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-3",children:[e.jsx(M,{value:"description",children:"Description"}),e.jsx(M,{value:"details",children:"Détails"}),e.jsx(M,{value:"delivery",children:"Livraison"})]}),e.jsx(U,{value:"description",className:"p-4 bg-neutral-50 dark:bg-neutral-900 rounded-lg mt-2",children:e.jsx("p",{className:"text-neutral-700 dark:text-neutral-300 whitespace-pre-line",children:s.description})}),e.jsx(U,{value:"details",className:"p-4 bg-neutral-50 dark:bg-neutral-900 rounded-lg mt-2",children:e.jsxs("ul",{className:"space-y-2 text-neutral-700 dark:text-neutral-300",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium w-32",children:"Catégorie:"}),e.jsx("span",{children:s.category})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium w-32",children:"Disponibilité:"}),e.jsx("span",{className:z?"text-green-600":"text-red-600",children:z?"En stock":"Rupture de stock"})]}),s.stock!==void 0&&e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium w-32",children:"Stock:"}),e.jsxs("span",{children:[s.stock," unité",s.stock>1?"s":""]})]}),s.dateAjout&&e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"font-medium w-32",children:"Date d'ajout:"}),e.jsx("span",{children:new Date(s.dateAjout).toLocaleDateString("fr-FR")})]})]})}),e.jsx(U,{value:"delivery",className:"p-4 bg-neutral-50 dark:bg-neutral-900 rounded-lg mt-2",children:e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2 text-green-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Livraison standard"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"3-5 jours ouvrés"})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx(ke,{className:"h-5 w-5 mr-2 text-green-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Retours"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Retours gratuits sous 30 jours"})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx(se,{className:"h-5 w-5 mr-2 text-green-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Livraison gratuite"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Pour les commandes supérieures à 50€"})]})]})]})})]}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-4 text-neutral-700 dark:text-neutral-300",children:"Quantité:"}),e.jsxs("div",{className:"flex items-center border border-neutral-300 dark:border-neutral-700 rounded-md",children:[e.jsx("button",{onClick:()=>D(c-1),disabled:c<=1,className:"px-3 py-2 text-neutral-500 disabled:text-neutral-300 disabled:cursor-not-allowed",children:"-"}),e.jsx("span",{className:"px-4 py-2 border-l border-r border-neutral-300 dark:border-neutral-700 min-w-[40px] text-center",children:c}),e.jsx("button",{onClick:()=>D(c+1),disabled:s.stock!==void 0&&c>=s.stock,className:"px-3 py-2 text-neutral-500 disabled:text-neutral-300 disabled:cursor-not-allowed",children:"+"})]}),s.stock!==void 0&&s.stock>0&&s.stock<=10&&e.jsxs("span",{className:"ml-3 text-sm text-orange-600",children:["(",s.stock," disponible",s.stock>1?"s":"",")"]})]}),e.jsxs("div",{className:"flex space-x-4 mt-4",children:[e.jsx(y,{size:"lg",onClick:xe,disabled:!z,className:`flex-1 transition-all ${L?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:L?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mr-2 h-5 w-5"}),"Ajouté"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"mr-2 h-5 w-5"}),"Ajouter au panier"]})}),e.jsx(y,{variant:"outline",size:"icon",className:"h-12 w-12 border-neutral-300 dark:border-neutral-700",onClick:()=>i(s),children:e.jsx(Ee,{className:`h-5 w-5 ${pe?"fill-red-500 text-red-500":""}`})}),e.jsx(y,{variant:"outline",size:"icon",className:"h-12 w-12 border-neutral-300 dark:border-neutral-700",onClick:()=>{navigator.clipboard.writeText(window.location.href),R.success("Lien copié dans le presse-papier")},children:e.jsx(Le,{className:"h-5 w-5"})})]})]}),!z&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900/30 rounded-md text-red-700 dark:text-red-400",children:"Ce produit est actuellement en rupture de stock."})]})]}),e.jsxs("div",{className:"mt-16",children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-800 mb-8",children:e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Avis clients"})}),m&&e.jsx(rs,{productId:m})]}),q.length>0&&e.jsx(Me,{products:q,title:"Produits similaires",description:"Vous pourriez également aimer ces produits dans la même catégorie",seeAllLink:`/categorie/${s.category}`,slidesToShow:4})]})})};export{Ws as default};
