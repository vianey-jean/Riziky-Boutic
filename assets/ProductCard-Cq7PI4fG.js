import{a3 as P,j as t,K as V,d as B,X as G,B as h,g as H,J as x,L as z,E as Q,a4 as K,C as X,c as Y}from"./index-Dc-BS1W2.js";import{r as c}from"./emoji-mart-DRerY-OB.js";import{B as I}from"./badge-taJbTjbb.js";import{g as Z,S as F,H as U,f as ee}from"./pubLayoutAPI-DfYluJku.js";import{D as te,b as se,d as ae,c as ie}from"./dialog-D1sIsNKu.js";import{m as D,e as re}from"./Layout-TSHxcvNT.js";import{C as ne}from"./clock-U9VSJiyP.js";const oe={getProductReviews:e=>P.get(`/reviews/product/${e}`),getReviewDetail:e=>P.get(`/reviews/${e}`),addReview:e=>{const n=new FormData;return n.append("productId",e.productId),n.append("productRating",e.productRating.toString()),n.append("deliveryRating",e.deliveryRating.toString()),e.comment&&n.append("comment",e.comment),e.photos&&e.photos.length>0&&e.photos.forEach(l=>{n.append("photos",l)}),P.post("/reviews",n,{headers:{"Content-Type":"multipart/form-data"}})},deleteReview:e=>P.delete(`/reviews/${e}`)},le=({rating:e,maxRating:n=5,size:l=20,color:d="gold",onClick:j,readOnly:r=!0,value:g,onChange:u,id:p})=>{const f=g!==void 0?g:e,b=a=>{r||(u&&u(a),j&&j(a))},N=[];for(let a=1;a<=n;a++)N.push(t.jsx(Z,{size:l,fill:a<=f?d:"transparent",stroke:a<=f?d:"#ccc",className:r?"":"cursor-pointer transition-transform hover:scale-110",onClick:()=>b(a),id:p?`${p}-star-${a}`:void 0},a));return t.jsx("div",{className:"flex gap-1",children:N})},ce=({product:e,isOpen:n,onClose:l})=>{const[d,j]=c.useState(0),[r,g]=c.useState(1),{addToCart:u,toggleFavorite:p,isFavorite:f}=V(),{isAuthenticated:b}=B(),N="https://riziky-boutic-server.onrender.com";if(!e)return null;const a=e.images&&e.images.length>0?e.images:e.image?[e.image]:[],y=i=>i?i.startsWith("http")?i:`${N}${i}`:"/placeholder.svg",E=()=>{if(!b){x.error("Vous devez être connecté pour ajouter un produit au panier");return}for(let i=0;i<r;i++)u(e);x.success(`${r} ${r>1?"exemplaires ajoutés":"exemplaire ajouté"} au panier`)},$=()=>{if(!b){x.error("Vous devez être connecté pour ajouter aux favoris");return}p(e),x.success(f(e.id)?"Retiré des favoris":"Ajouté aux favoris")},R=e.promotion&&e.promotionEnd&&new Date(e.promotionEnd)>new Date,w=e.isSold&&(e.stock===void 0||e.stock>0);return t.jsx(te,{open:n,onOpenChange:l,children:t.jsx(se,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0",children:t.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"grid grid-cols-1 md:grid-cols-2 gap-0",children:[t.jsxs("div",{className:"relative bg-gray-50 p-6",children:[t.jsx("button",{onClick:l,className:"absolute top-4 mr-6 right-4 z-10 p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow md:hidden",children:t.jsx(G,{className:"h-4 w-4"})}),t.jsxs("div",{className:"relative mb-4",children:[t.jsx(re,{mode:"wait",children:t.jsx(D.img,{src:y(a[d]),alt:e.name,className:"w-full h-80 object-contain rounded-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onError:i=>{const o=i.target;o.src="/placeholder.svg"}},d)}),R&&t.jsxs("div",{className:"absolute top-4 left-4 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-bold",children:["-",e.promotion,"%"]})]}),a.length>1&&t.jsx("div",{className:"flex gap-2 justify-center",children:a.slice(0,4).map((i,o)=>t.jsx("button",{onClick:()=>j(o),className:`w-16 h-16 rounded-md overflow-hidden border-2 transition-all ${o===d?"border-red-500":"border-transparent"}`,children:t.jsx("img",{src:y(i),alt:`${e.name} - ${o+1}`,className:"w-full h-full object-cover",onError:T=>{const S=T.target;S.src="/placeholder.svg"}})},o))})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs(ae,{className:"mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(I,{variant:"outline",className:"text-xs",children:e.category}),e.dateAjout&&new Date().getTime()-new Date(e.dateAjout).getTime()<7*24*60*60*1e3&&t.jsx(I,{className:"bg-blue-600 text-white text-xs",children:"Nouveau"})]}),t.jsx(ie,{className:"text-2xl font-bold",children:e.name})]}),R?t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("p",{className:"text-lg text-gray-500 line-through",children:[typeof e.originalPrice=="number"?e.originalPrice.toFixed(2):e.price.toFixed(2)," ","€"]}),t.jsxs("span",{className:"bg-red-600 text-white px-2 py-0.5 text-xs font-bold rounded",children:["-",e.promotion,"%"]})]}),t.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[e.price.toFixed(2)," €"]})]}):t.jsxs("p",{className:"text-2xl font-bold mb-4",children:[e.price.toFixed(2)," €"]}),t.jsx("div",{className:"mb-4 max-h-24 overflow-y-auto text-sm text-gray-700",children:e.description}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("p",{className:"font-medium text-sm",children:"Disponibilité:"}),t.jsx("span",{className:w?"text-green-600 text-sm":"text-red-600 text-sm",children:w?"En stock":"Rupture de stock"})]}),e.stock!==void 0&&t.jsxs("p",{className:"text-sm text-gray-600",children:[e.stock," unité",e.stock!==1?"s":""," disponible",e.stock!==1?"s":""]})]}),t.jsx("div",{className:"flex items-center space-x-4 mb-6",children:t.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md",children:[t.jsx("button",{onClick:()=>g(Math.max(1,r-1)),disabled:r<=1,className:"px-3 py-1 text-gray-600 disabled:text-gray-300",children:"-"}),t.jsx("span",{className:"px-4 py-1 border-x border-gray-300 min-w-[40px] text-center",children:r}),t.jsx("button",{onClick:()=>g(r+1),disabled:e.stock!==void 0&&r>=e.stock,className:"px-3 py-1 text-gray-600 disabled:text-gray-300",children:"+"})]})}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsxs(h,{onClick:E,disabled:!w,className:"flex-1 bg-red-600 hover:bg-red-700",children:[t.jsx(F,{className:"mr-2 h-4 w-4"}),"Ajouter au panier"]}),t.jsx(h,{variant:"outline",size:"icon",onClick:$,className:"rounded-full",children:t.jsx(U,{className:`h-4 w-4 ${f(e.id)?"fill-red-500 text-red-500":""}`})}),t.jsx(h,{variant:"outline",size:"icon",onClick:()=>{const i=window.location.origin+`/${H(e.id,"product")}`;navigator.clipboard.writeText(i),x.success("Lien copié!")},className:"rounded-full",children:t.jsx(ee,{className:"h-4 w-4"})})]}),t.jsx("div",{className:"mt-6 text-center",children:t.jsx(h,{variant:"link",asChild:!0,children:t.jsxs(z,{to:`/${H(e.id,"product")}`,children:[t.jsx(Q,{className:"mr-2 h-4 w-4"}),"Voir la page produit"]})})})]})]})})})},de="https://riziky-boutic-server.onrender.com",L="/placeholder.svg",je=({product:e,size:n="medium",featured:l=!1})=>{const{addToCart:d,toggleFavorite:j,isFavorite:r}=V(),{isAuthenticated:g}=B(),u=r(e.id),[p,f]=c.useState(0),[b,N]=c.useState(0),[a,y]=c.useState(!1),[E,$]=c.useState(0),[R,w]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const v=(await oe.getProductReviews(e.id)).data;if(v&&v.length>0){const k=v.reduce((A,C)=>A+(C.productRating+C.deliveryRating)/2,0);f(k/v.length),N(v.length)}}catch(m){console.error("Error fetching reviews for product:",e.id,m)}})()},[e.id]);const i=K(e.id,"product"),o=e.images&&e.images.length>0?e.images:e.image?[e.image]:[],T=s=>{if(!s)return"";const m=new Date(s),v=new Date,k=m.getTime()-v.getTime();if(k<=0)return"Expirée";const A=Math.floor(k/(1e3*60*60*24)),C=Math.floor(k%(1e3*60*60*24)/(1e3*60*60));if(A>0)return`${A}j ${C}h`;{const J=Math.floor(k%36e5/6e4);return`${C}h ${J}m`}},S=e.promotion&&e.promotionEnd&&new Date(e.promotionEnd)>new Date,_=s=>s?s.startsWith("http")?s:`${de}${s}`:L,M=s=>{if(s.preventDefault(),s.stopPropagation(),!g){x.error("Vous devez être connecté pour ajouter un produit au panier",{style:{backgroundColor:"#EF4444",color:"white",fontWeight:"bold"},duration:4e3,position:"top-center"});return}if(!e.isSold||e.stock!==void 0&&e.stock<=0){x.error("Ce produit est en rupture de stock");return}d(e),x.success("Produit ajouté au panier")},O=s=>{s.preventDefault(),s.stopPropagation(),j(e)},q=s=>{s.preventDefault(),s.stopPropagation(),w(!0)};c.useEffect(()=>{if(a&&o.length>1){const s=setInterval(()=>{$(m=>(m+1)%o.length)},2e3);return()=>clearInterval(s)}},[a,o.length]);const W={small:"h-[300px]",medium:"h-[380px]",large:"h-[450px]"};return t.jsxs(t.Fragment,{children:[t.jsx(D.div,{whileHover:{y:-5},transition:{duration:.2},onMouseEnter:()=>y(!0),onMouseLeave:()=>{y(!1),$(0)},className:l?"z-10 scale-105":"",children:t.jsxs(X,{className:`overflow-hidden ${W[n]} flex flex-col border border-neutral-200 hover:border-neutral-300 dark:border-neutral-800 dark:hover:border-neutral-700 rounded-xl hover:shadow-lg transition-all duration-300 ${l?"shadow-md ring-1 ring-red-200 dark:ring-red-900":""}`,children:[t.jsxs("div",{className:"relative h-[60%] bg-neutral-50 dark:bg-neutral-900 overflow-hidden",children:[t.jsx(z,{to:`/${i}`,className:"block h-full",children:o.length>0?t.jsx(D.img,{src:_(o[E]),alt:`Photo de ${e.name}`,className:"w-full h-full object-contain transition-opacity duration-300",loading:"lazy",onError:s=>{console.log("Erreur de chargement d'image, utilisation du placeholder");const m=s.target;m.src=L},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},E):t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-800",children:t.jsx(F,{className:"h-12 w-12 text-neutral-400"})})}),S&&t.jsxs("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-between",children:[t.jsxs(I,{className:"m-2 bg-red-600 text-white px-2 py-1 text-xs font-bold",children:["-",e.promotion,"%"]}),e.promotionEnd&&t.jsxs("div",{className:"m-2 bg-black/70 text-white px-2 py-1 rounded-full text-xs flex items-center",children:[t.jsx(ne,{className:"h-3 w-3 mr-1"})," ",T(e.promotionEnd)]})]}),e.dateAjout&&new Date().getTime()-new Date(e.dateAjout).getTime()<7*24*60*60*1e3&&t.jsx(I,{className:"absolute top-2 left-2 bg-blue-600 text-white",children:"Nouveau"}),l&&t.jsx(I,{className:"absolute top-2 right-2 bg-amber-500 text-white",children:"Recommandé"}),t.jsxs("div",{className:`absolute bottom-0 left-0 right-0 p-2 flex justify-between bg-gradient-to-t from-black/70 to-transparent transition-opacity duration-300 ${a?"opacity-100":"opacity-0"}`,children:[t.jsx(h,{variant:"ghost",size:"icon",onClick:O,className:"rounded-full bg-white/90 hover:bg-white text-neutral-700 hover:text-red-600 backdrop-blur-sm",title:u?"Retirer des favoris":"Ajouter aux favoris",children:t.jsx(U,{className:`h-4 w-4 ${u?"fill-red-500 text-red-500":""}`})}),t.jsx(h,{variant:"ghost",size:"icon",onClick:q,className:"rounded-full bg-white/90 hover:bg-white text-neutral-700 hover:text-blue-600 backdrop-blur-sm",title:"Vue rapide",children:t.jsx(Q,{className:"h-4 w-4"})}),t.jsx(h,{variant:"ghost",size:"icon",onClick:M,disabled:!e.isSold||e.stock!==void 0&&e.stock<=0,className:"rounded-full bg-white/90 hover:bg-white text-neutral-700 hover:text-green-600 backdrop-blur-sm",title:"Ajouter au panier",children:t.jsx(F,{className:"h-4 w-4"})})]})]}),t.jsxs(Y,{className:"p-4 flex flex-col flex-grow",children:[t.jsx(z,{to:`/${i}`,className:"block",children:t.jsx("h3",{className:"font-medium text-lg mb-1 hover:text-red-600 transition-colors line-clamp-2 text-left",children:e.name})}),t.jsxs("div",{className:"flex items-center mt-1 mb-2",children:[t.jsx(le,{rating:p,size:14}),t.jsxs("span",{className:"text-xs text-neutral-500 ml-1",children:["(",b,")"]})]}),t.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-sm mb-3 line-clamp-2 text-left",children:e.description}),t.jsx("div",{className:"flex-grow"}),t.jsxs("div",{className:"flex justify-between items-end mt-2 text-left",children:[t.jsxs("div",{children:[S?t.jsx("div",{className:"flex flex-col",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("p",{className:"text-sm text-gray-500 line-through",children:[typeof e.originalPrice=="number"?e.originalPrice.toFixed(2):e.price.toFixed(2)," ","€"]}),t.jsxs("p",{className:"font-bold text-red-600",children:[e.price.toFixed(2)," €"]})]})}):t.jsxs("p",{className:"font-bold",children:[e.price.toFixed(2)," €"]}),e.stock!==void 0&&t.jsx("div",{className:"mt-1",children:e.stock===0||!e.isSold?t.jsx("p",{className:"text-red-500 text-xs",children:"En rupture de stock"}):e.stock<=5?t.jsxs("p",{className:"text-orange-500 text-xs",children:["Plus que ",e.stock," en stock"]}):t.jsxs("p",{className:"text-orange-500 text-xs",children:["Plus que ",e.stock," en stock"]})})]}),t.jsxs(h,{size:"sm",variant:"outline",className:"h-8 bg-red-50 text-red-700 hover:bg-red-100 border-red-200 hover:border-red-300 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30 dark:border-red-900/50",onClick:M,disabled:!e.isSold||e.stock!==void 0&&e.stock<=0,children:[t.jsx(F,{className:"h-3.5 w-3.5 mr-1"}),t.jsx("span",{children:"Ajouter"})]})]})]})]})}),t.jsx(ce,{product:e,isOpen:R,onClose:()=>w(!1)})]})};export{je as P,le as S,oe as r};
