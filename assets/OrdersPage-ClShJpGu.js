import{j as e,C as $,k as O,l as U,c as F,G as k,X as ee,B as j,J as c,K as se,U as te,E as ae,L as B,a1 as re}from"./index-Dc-BS1W2.js";import{r as o}from"./emoji-mart-DRerY-OB.js";import{L as le}from"./Layout-TSHxcvNT.js";import{S as R}from"./separator-6a6jIHNF.js";import{A as ie,a as ne,b as ce,c as oe,d as de,e as me,f as xe,g as ue,h as he}from"./alert-dialog-BUmLs06s.js";import{D as L,b as I,d as M,c as P}from"./dialog-D1sIsNKu.js";import{r as G}from"./remboursementsAPI-7B_PZ2Po.js";import{T as pe}from"./textarea-C2Rhkt_I.js";import{S as je,a as fe,b as ge,c as ve,d as Ne}from"./select-B3i9CjeT.js";import{U as be,c as z,C as q}from"./pubLayoutAPI-DfYluJku.js";import{B as H}from"./badge-taJbTjbb.js";import{C as E}from"./clock-U9VSJiyP.js";import{M as _,S as T,b as ye,T as we,R as Ce}from"./index-DrCm3EO8.js";import{f as Se}from"./format-BqfI4fP3.js";import{f as Re}from"./fr-Bao31GFJ.js";import{T as De}from"./trash-2-DHce8VXy.js";import"./popover-CGZmNc4e.js";import"./Combination-DuTqoeZY.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./index-BkNWx6m2.js";import"./index-DE01g13U.js";import"./index--K3sZeIh.js";import"./user-DUzEMHwr.js";import"./index-FHuIi1st.js";import"./categoriesAPI-DvU_otkD.js";import"./search-DlKIh_Ll.js";import"./database-BKbjrLJf.js";import"./scroll-area-BfHT7kH_.js";import"./useMutation-CApHjpg4.js";import"./arrow-up-BRrXiPPU.js";import"./index-DqWbzM0E.js";import"./circle-plus-gGTkOUJD.js";import"./play-C68uu85c.js";import"./house-Qr62Kw0A.js";import"./shield-x-BsKCYJAg.js";import"./video-CY1c3mCS.js";import"./plus-DTTTuzsk.js";import"./square-pen-D72gPhkm.js";import"./triangle-alert-Btc8UJ8c.js";const Ae=({orderId:t,onSuccess:m,onCancel:f})=>{const[n,d]=o.useState({orderId:t,reason:"",customReason:"",photo:void 0}),[x,g]=o.useState(!1),[a,b]=o.useState(null),y=["mauvaise qualité","trompé produit","trompé taille","manque produit"],w=r=>{d(l=>({...l,reason:r}))},C=r=>{d(l=>({...l,customReason:r.target.value}))},D=r=>{var u;const l=(u=r.target.files)==null?void 0:u[0];if(l){if(l.size>5*1024*1024){c.error("Le fichier ne doit pas dépasser 5MB");return}if(!l.type.startsWith("image/")){c.error("Seules les images sont autorisées");return}d(N=>({...N,photo:l}));const h=new FileReader;h.onload=N=>{var S;b((S=N.target)==null?void 0:S.result)},h.readAsDataURL(l)}},A=()=>{d(r=>({...r,photo:void 0})),b(null)},v=async r=>{var l,u;if(r.preventDefault(),!n.reason){c.error("Veuillez sélectionner une raison de remboursement");return}if(!n.customReason.trim()){c.error("Veuillez préciser la raison de votre demande");return}if(!n.photo){c.error("Veuillez ajouter une photo justificative");return}g(!0);try{await G.create(n),c.success("Votre demande de remboursement a été envoyée avec succès"),m()}catch(h){console.error("Erreur lors de la création de la demande:",h),c.error(((u=(l=h.response)==null?void 0:l.data)==null?void 0:u.message)||"Erreur lors de l'envoi de la demande")}finally{g(!1)}};return e.jsxs($,{className:"w-full max-w-md mx-auto",children:[e.jsx(O,{children:e.jsx(U,{children:"Demande de remboursement"})}),e.jsx(F,{children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"reason",children:"Raison du remboursement"}),e.jsxs(je,{value:n.reason,onValueChange:w,children:[e.jsx(fe,{children:e.jsx(ge,{placeholder:"Sélectionnez une raison"})}),e.jsx(ve,{children:y.map(r=>e.jsx(Ne,{value:r,children:r.charAt(0).toUpperCase()+r.slice(1)},r))})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"customReason",children:"Précisez votre demande"}),e.jsx(pe,{id:"customReason",placeholder:"Décrivez le problème en détail...",value:n.customReason,onChange:C,rows:3})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"photo",children:"Photo justificative"}),a?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a,alt:"Aperçu",className:"w-full h-40 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:A,className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(ee,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(be,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("div",{className:"mt-2",children:e.jsxs("label",{htmlFor:"photo",className:"cursor-pointer",children:[e.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"Cliquez pour ajouter une photo"}),e.jsx("input",{id:"photo",type:"file",accept:"image/*",onChange:D,className:"hidden"})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG jusqu'à 5MB"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:f,className:"flex-1",children:"Annuler"}),e.jsx(j,{type:"submit",disabled:x,className:"flex-1",children:x?"Envoi en cours...":"Envoyer la demande"})]})]})})]})},ke=({remboursement:t,order:m})=>{const f="https://riziky-boutic-server.onrender.com",n=a=>{switch(a){case"vérification":return e.jsx(E,{className:"h-4 w-4"});case"en étude":return e.jsx(_,{className:"h-4 w-4"});case"traité":return t.decision==="accepté"?e.jsx(z,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"});default:return e.jsx(E,{className:"h-4 w-4"})}},d=a=>{switch(a){case"vérification":return"bg-yellow-100 text-yellow-800";case"en étude":return"bg-blue-100 text-blue-800";case"traité":return t.decision==="accepté"?"bg-green-100 text-green-800":"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},x=a=>Se(new Date(a),"dd MMMM yyyy à HH:mm",{locale:Re}),g=a=>a?a.startsWith("http")?a:`${f}${a}`:"";return e.jsx("div",{className:"space-y-6",children:e.jsxs($,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(U,{children:["Suivi de remboursement #",t.id.split("-")[1]]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Commande #",m.id.split("-")[1]]})]}),e.jsx(H,{className:d(t.status),children:e.jsxs("div",{className:"flex items-center gap-1",children:[n(t.status),t.status==="traité"&&t.decision?`${t.status} - ${t.decision}`:t.status]})})]})}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Raison du remboursement"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.reason.charAt(0).toUpperCase()+t.reason.slice(1)}),t.customReason&&e.jsx("p",{className:"text-sm mt-2",children:t.customReason})]}),t.photo&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Photo justificative"}),e.jsx("img",{src:g(t.photo),alt:"Photo justificative",className:"w-full max-w-sm h-40 object-cover rounded-lg border"})]}),e.jsx(R,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-4",children:"Progression"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${t.status==="vérification"||t.status==="en étude"||t.status==="traité"?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:e.jsx(E,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Vérification"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre demande est en cours de vérification"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${t.status==="en étude"||t.status==="traité"?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}`,children:e.jsx(_,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"En étude"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre demande est à l'étude par notre équipe"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${t.status==="traité"?t.decision==="accepté"?"bg-green-500 text-white":"bg-red-500 text-white":"bg-gray-200 text-gray-500"}`,children:t.status==="traité"?t.decision==="accepté"?e.jsx(z,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"}):e.jsx(z,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.status==="traité"&&t.decision?t.decision==="accepté"?"Accepté":"Refusé":"Traité"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.status==="traité"&&t.decision?t.decision==="accepté"?"Votre remboursement a été accepté":"Votre demande de remboursement a été refusée":"Décision finale sur votre demande"})]})]})]})]}),t.adminComments&&t.adminComments.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-4",children:"Commentaires de l'équipe"}),e.jsx("div",{className:"space-y-3",children:t.adminComments.map(a=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"font-medium text-sm",children:a.adminName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x(a.createdAt)})]}),e.jsx("p",{className:"text-sm",children:a.comment}),e.jsx(H,{variant:"secondary",className:"mt-2 text-xs",children:a.status})]},a.id))})]})]}),e.jsx(R,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Détails de la commande"}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Commande du ",x(m.createdAt)]}),e.jsxs("p",{children:["Montant: ",m.totalAmount.toFixed(2)," €"]}),e.jsxs("p",{children:["Statut: ",m.status]})]})]})]})]})})},js=()=>{const{orders:t,loadingOrders:m,fetchOrders:f}=se(),n="https://riziky-boutic-server.onrender.com",[d,x]=o.useState(null),[g,a]=o.useState(!1),[b,y]=o.useState(!1),[w,C]=o.useState(""),[D,A]=o.useState([]),[v,r]=o.useState(null);o.useEffect(()=>{f(),l(),console.log("Chargement des commandes depuis la page des commandes")},[]);const l=async()=>{try{const s=await G.getUserRemboursements();A(s.data)}catch(s){console.error("Erreur lors du chargement des remboursements:",s)}},u=s=>new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}),h=s=>{switch(s){case"confirmée":return"bg-blue-100 text-blue-800";case"en préparation":return"bg-yellow-100 text-yellow-800";case"en livraison":return"bg-orange-100 text-orange-800";case"livrée":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},N=s=>s?s.startsWith("http")?s:`${n}${s}`:"",S=async s=>{try{x(s),console.log("Suppression complète de la commande:",s);const i=await re.cancelOrder(s,[]);c.success("Commande supprimée avec succès"),await f()}catch(i){console.error("Erreur lors de la suppression:",i),c.error("Erreur lors de la suppression de la commande")}finally{x(null)}},J=s=>s.status==="confirmée",W=s=>["en préparation","en livraison","livrée"].includes(s.status),V=s=>D.find(i=>i.orderId===s),K=s=>{C(s),a(!0)},X=()=>{a(!1),C(""),l(),c.success("Demande de remboursement envoyée avec succès")},Q=s=>{const i=V(s);i&&(r(i),y(!0))};return e.jsx(le,{children:e.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Mes commandes"}),m?e.jsx("div",{className:"text-center py-10",children:"Chargement des commandes..."}):t.length>0?e.jsx("div",{className:"space-y-6",children:t.map(s=>{const i=V(s.id);return e.jsxs($,{children:[e.jsxs(O,{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsxs(U,{children:["Commande #",s.id.split("-")[1]]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u(s.createdAt)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.items.length," produit",s.items.length>1?"s":""]})]}),e.jsxs("div",{className:"mt-2 sm:mt-0 flex flex-col items-end gap-2",children:[e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${h(s.status)}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),i&&e.jsxs("span",{className:"inline-block px-2 py-1 rounded-full text-xs bg-purple-100 text-purple-800",children:["Remboursement: ",i.status]})]})]}),e.jsxs(F,{children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-4",children:[s.items.slice(0,3).map(p=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 rounded overflow-hidden",children:p.image?e.jsx("img",{src:N(p.image),alt:p.name,className:"w-full h-full object-cover",onError:Y=>{const Z=Y.target;Z.src=`${n}/uploads/placeholder.jpg`}}):e.jsx("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:e.jsx(T,{className:"h-6 w-6 text-gray-500"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium",children:p.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.quantity," × ",p.price.toFixed(2)," €"]})]})]},p.productId)),s.items.length>3&&e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"w-12 h-12 rounded bg-gray-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-medium",children:["+",s.items.length-3]})})})]}),e.jsx("div",{className:"bg-white border rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-brand-blue text-white z-10",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs text-center mt-2 max-w-[70px]",children:"Confirmée"})]}),e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("div",{className:`absolute h-1 top-4 transform -translate-x-1/2 -left-1/2 w-full ${s.status!=="confirmée"?"bg-brand-blue":"bg-gray-200"}`}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center z-10 ${s.status!=="confirmée"?"bg-brand-blue text-white":"bg-gray-200 text-gray-400"}`,children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs text-center mt-2 max-w-[70px]",children:"En préparation"})]}),e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("div",{className:`absolute h-1 top-4 transform -translate-x-1/2 -left-1/2 w-full ${s.status==="en livraison"||s.status==="livrée"?"bg-brand-blue":"bg-gray-200"}`}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center z-10 ${s.status==="en livraison"||s.status==="livrée"?"bg-brand-blue text-white":"bg-gray-200 text-gray-400"}`,children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs text-center mt-2 max-w-[70px]",children:"En livraison"})]}),e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("div",{className:`absolute h-1 top-4 transform -translate-x-1/2 -left-1/2 w-full ${s.status==="livrée"?"bg-brand-blue":"bg-gray-200"}`}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center z-10 ${s.status==="livrée"?"bg-brand-blue text-white":"bg-gray-200 text-gray-400"}`,children:e.jsx(T,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs text-center mt-2 max-w-[70px]",children:"Livrée"})]})]})}),e.jsx(R,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold",children:[s.totalAmount.toFixed(2)," €"]})]}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[J(s)&&e.jsxs(ie,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(j,{variant:"destructive",size:"sm",disabled:d===s.id,children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Supprimer"]})}),e.jsxs(ce,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Supprimer la commande"}),e.jsx(me,{children:"Êtes-vous sûr de vouloir supprimer complètement cette commande ? Tous les produits seront remis en stock et la commande sera définitivement supprimée. Cette action est irréversible."})]}),e.jsxs(xe,{children:[e.jsx(ue,{children:"Annuler"}),e.jsx(he,{onClick:()=>S(s.id),className:"bg-red-600 hover:bg-red-700",children:d===s.id?"Suppression...":"Confirmer la suppression"})]})]})]}),W(s)&&!i&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>K(s.id),children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Remboursement"]}),i&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>Q(s.id),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Suivre remboursement"]}),e.jsx(j,{asChild:!0,children:e.jsx(B,{to:`/commande/${s.id}`,children:"Voir les détails"})})]})]})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-gray-50",children:[e.jsx("div",{className:"mb-4",children:e.jsx(T,{className:"h-12 w-12 mx-auto text-muted-foreground"})}),e.jsx("h2",{className:"text-xl font-medium mb-2",children:"Vous n'avez pas encore de commandes"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Commencez vos achats pour créer votre première commande"}),e.jsx(j,{asChild:!0,children:e.jsx(B,{to:"/",children:"Explorer nos produits"})})]}),e.jsx(L,{open:g,onOpenChange:a,children:e.jsxs(I,{className:"max-w-lg",children:[e.jsx(M,{children:e.jsx(P,{children:"Demande de remboursement"})}),w&&e.jsx(Ae,{orderId:w,onSuccess:X,onCancel:()=>a(!1)})]})}),e.jsx(L,{open:b,onOpenChange:y,children:e.jsxs(I,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(M,{children:e.jsx(P,{children:"Suivi de remboursement"})}),v&&e.jsx(ke,{remboursement:v,order:t.find(s=>s.id===v.orderId)})]})})]})})};export{js as default};
