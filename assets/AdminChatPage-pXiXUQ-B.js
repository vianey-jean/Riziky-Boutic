import{J as Y,j as A,B as fe,d as un,_ as hn,C as Zt,I as er}from"./index-Dc-BS1W2.js";import{c as xe,b as fn,g as dn,r as X,$ as tr,d as rr}from"./emoji-mart-DRerY-OB.js";import{A as pn}from"./AdminLayout-CibHDjhS.js";import{S as nr}from"./scroll-area-BfHT7kH_.js";import{S as gn}from"./separator-6a6jIHNF.js";import{i as Re,P as ir,a as sr,b as or,D as yn,d as mn,e as _n,f as ar,g as Vn}from"./popover-CGZmNc4e.js";import{a as ht,u as ft}from"./useMutation-CApHjpg4.js";import{U as wn,S as lr,a as bn}from"./user-DUzEMHwr.js";import{V as Wt,P as Bt,b as Fr,M as En,a as An,c as vn}from"./video-CY1c3mCS.js";import{D as Rn,b as xn,c as Cn,e as Sn}from"./dialog-D1sIsNKu.js";import{S as cr}from"./square-pen-D72gPhkm.js";import{T as Tn}from"./trash-2-DHce8VXy.js";import"./index-DrCm3EO8.js";import"./index-DE01g13U.js";import"./index-BkNWx6m2.js";import"./Combination-DuTqoeZY.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./index--K3sZeIh.js";import"./index-FHuIi1st.js";var kt={exports:{}},dt,ur;function Nn(){if(ur)return dt;ur=1;var r=1e3,e=r*60,t=e*60,i=t*24,a=i*7,f=i*365.25;dt=function(p,w){w=w||{};var I=typeof p;if(I==="string"&&p.length>0)return d(p);if(I==="number"&&isFinite(p))return w.long?m(p):c(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function d(p){if(p=String(p),!(p.length>100)){var w=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(w){var I=parseFloat(w[1]),j=(w[2]||"ms").toLowerCase();switch(j){case"years":case"year":case"yrs":case"yr":case"y":return I*f;case"weeks":case"week":case"w":return I*a;case"days":case"day":case"d":return I*i;case"hours":case"hour":case"hrs":case"hr":case"h":return I*t;case"minutes":case"minute":case"mins":case"min":case"m":return I*e;case"seconds":case"second":case"secs":case"sec":case"s":return I*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return I;default:return}}}}function c(p){var w=Math.abs(p);return w>=i?Math.round(p/i)+"d":w>=t?Math.round(p/t)+"h":w>=e?Math.round(p/e)+"m":w>=r?Math.round(p/r)+"s":p+"ms"}function m(p){var w=Math.abs(p);return w>=i?_(p,w,i,"day"):w>=t?_(p,w,t,"hour"):w>=e?_(p,w,e,"minute"):w>=r?_(p,w,r,"second"):p+" ms"}function _(p,w,I,j){var O=w>=I*1.5;return Math.round(p/I)+" "+j+(O?"s":"")}return dt}function Bn(r){t.debug=t,t.default=t,t.coerce=m,t.disable=f,t.enable=a,t.enabled=d,t.humanize=Nn(),t.destroy=_,Object.keys(r).forEach(p=>{t[p]=r[p]}),t.names=[],t.skips=[],t.formatters={};function e(p){let w=0;for(let I=0;I<p.length;I++)w=(w<<5)-w+p.charCodeAt(I),w|=0;return t.colors[Math.abs(w)%t.colors.length]}t.selectColor=e;function t(p){let w,I=null,j,O;function T(...k){if(!T.enabled)return;const y=T,v=Number(new Date),x=v-(w||v);y.diff=x,y.prev=w,y.curr=v,w=v,k[0]=t.coerce(k[0]),typeof k[0]!="string"&&k.unshift("%O");let C=0;k[0]=k[0].replace(/%([a-zA-Z%])/g,(L,q)=>{if(L==="%%")return"%";C++;const M=t.formatters[q];if(typeof M=="function"){const P=k[C];L=M.call(y,P),k.splice(C,1),C--}return L}),t.formatArgs.call(y,k),(y.log||t.log).apply(y,k)}return T.namespace=p,T.useColors=t.useColors(),T.color=t.selectColor(p),T.extend=i,T.destroy=t.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>I!==null?I:(j!==t.namespaces&&(j=t.namespaces,O=t.enabled(p)),O),set:k=>{I=k}}),typeof t.init=="function"&&t.init(T),T}function i(p,w){const I=t(this.namespace+(typeof w>"u"?":":w)+p);return I.log=this.log,I}function a(p){t.save(p),t.namespaces=p,t.names=[],t.skips=[];let w;const I=(typeof p=="string"?p:"").split(/[\s,]+/),j=I.length;for(w=0;w<j;w++)I[w]&&(p=I[w].replace(/\*/g,".*?"),p[0]==="-"?t.skips.push(new RegExp("^"+p.slice(1)+"$")):t.names.push(new RegExp("^"+p+"$")))}function f(){const p=[...t.names.map(c),...t.skips.map(c).map(w=>"-"+w)].join(",");return t.enable(""),p}function d(p){if(p[p.length-1]==="*")return!0;let w,I;for(w=0,I=t.skips.length;w<I;w++)if(t.skips[w].test(p))return!1;for(w=0,I=t.names.length;w<I;w++)if(t.names[w].test(p))return!0;return!1}function c(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}function m(p){return p instanceof Error?p.stack||p.message:p}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var kn=Bn;(function(r,e){var t={};e.formatArgs=a,e.save=f,e.load=d,e.useColors=i,e.storage=c(),e.destroy=(()=>{let _=!1;return()=>{_||(_=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let _;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(_=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(_[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(_){if(_[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;_.splice(1,0,p,"color: inherit");let w=0,I=0;_[0].replace(/%[a-zA-Z%]/g,j=>{j!=="%%"&&(w++,j==="%c"&&(I=w))}),_.splice(I,0,p)}e.log=console.debug||console.log||(()=>{});function f(_){try{_?e.storage.setItem("debug",_):e.storage.removeItem("debug")}catch{}}function d(){let _;try{_=e.storage.getItem("debug")}catch{}return!_&&typeof process<"u"&&"env"in process&&(_=t.DEBUG),_}function c(){try{return localStorage}catch{}}r.exports=kn(e);const{formatters:m}=r.exports;m.j=function(_){try{return JSON.stringify(_)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}})(kt,kt.exports);var In=kt.exports,On=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},It={exports:{}},Ot={exports:{}},qe={},ot={};ot.byteLength=Dn;ot.toByteArray=Pn;ot.fromByteArray=qn;var we=[],pe=[],Fn=typeof Uint8Array<"u"?Uint8Array:Array,pt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var je=0,Ln=pt.length;je<Ln;++je)we[je]=pt[je],pe[pt.charCodeAt(je)]=je;pe[45]=62;pe[95]=63;function Lr(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function Dn(r){var e=Lr(r),t=e[0],i=e[1];return(t+i)*3/4-i}function Mn(r,e,t){return(e+t)*3/4-t}function Pn(r){var e,t=Lr(r),i=t[0],a=t[1],f=new Fn(Mn(r,i,a)),d=0,c=a>0?i-4:i,m;for(m=0;m<c;m+=4)e=pe[r.charCodeAt(m)]<<18|pe[r.charCodeAt(m+1)]<<12|pe[r.charCodeAt(m+2)]<<6|pe[r.charCodeAt(m+3)],f[d++]=e>>16&255,f[d++]=e>>8&255,f[d++]=e&255;return a===2&&(e=pe[r.charCodeAt(m)]<<2|pe[r.charCodeAt(m+1)]>>4,f[d++]=e&255),a===1&&(e=pe[r.charCodeAt(m)]<<10|pe[r.charCodeAt(m+1)]<<4|pe[r.charCodeAt(m+2)]>>2,f[d++]=e>>8&255,f[d++]=e&255),f}function jn(r){return we[r>>18&63]+we[r>>12&63]+we[r>>6&63]+we[r&63]}function Un(r,e,t){for(var i,a=[],f=e;f<t;f+=3)i=(r[f]<<16&16711680)+(r[f+1]<<8&65280)+(r[f+2]&255),a.push(jn(i));return a.join("")}function qn(r){for(var e,t=r.length,i=t%3,a=[],f=16383,d=0,c=t-i;d<c;d+=f)a.push(Un(r,d,d+f>c?c:d+f));return i===1?(e=r[t-1],a.push(we[e>>2]+we[e<<4&63]+"==")):i===2&&(e=(r[t-2]<<8)+r[t-1],a.push(we[e>>10]+we[e>>4&63]+we[e<<2&63]+"=")),a.join("")}var Ht={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ht.read=function(r,e,t,i,a){var f,d,c=a*8-i-1,m=(1<<c)-1,_=m>>1,p=-7,w=t?a-1:0,I=t?-1:1,j=r[e+w];for(w+=I,f=j&(1<<-p)-1,j>>=-p,p+=c;p>0;f=f*256+r[e+w],w+=I,p-=8);for(d=f&(1<<-p)-1,f>>=-p,p+=i;p>0;d=d*256+r[e+w],w+=I,p-=8);if(f===0)f=1-_;else{if(f===m)return d?NaN:(j?-1:1)*(1/0);d=d+Math.pow(2,i),f=f-_}return(j?-1:1)*d*Math.pow(2,f-i)};Ht.write=function(r,e,t,i,a,f){var d,c,m,_=f*8-a-1,p=(1<<_)-1,w=p>>1,I=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=i?0:f-1,O=i?1:-1,T=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,d=p):(d=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-d))<1&&(d--,m*=2),d+w>=1?e+=I/m:e+=I*Math.pow(2,1-w),e*m>=2&&(d++,m/=2),d+w>=p?(c=0,d=p):d+w>=1?(c=(e*m-1)*Math.pow(2,a),d=d+w):(c=e*Math.pow(2,w-1)*Math.pow(2,a),d=0));a>=8;r[t+j]=c&255,j+=O,c/=256,a-=8);for(d=d<<a|c,_+=a;_>0;r[t+j]=d&255,j+=O,d/=256,_-=8);r[t+j-O]|=T*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(r){const e=ot,t=Ht,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=c,r.SlowBuffer=v,r.INSPECT_MAX_BYTES=50;const a=2147483647;r.kMaxLength=a,c.TYPED_ARRAY_SUPPORT=f(),!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function f(){try{const o=new Uint8Array(1),n={foo:function(){return 42}};return Object.setPrototypeOf(n,Uint8Array.prototype),Object.setPrototypeOf(o,n),o.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}});function d(o){if(o>a)throw new RangeError('The value "'+o+'" is invalid for option "size"');const n=new Uint8Array(o);return Object.setPrototypeOf(n,c.prototype),n}function c(o,n,s){if(typeof o=="number"){if(typeof n=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return w(o)}return m(o,n,s)}c.poolSize=8192;function m(o,n,s){if(typeof o=="string")return I(o,n);if(ArrayBuffer.isView(o))return O(o);if(o==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o);if(he(o,ArrayBuffer)||o&&he(o.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(he(o,SharedArrayBuffer)||o&&he(o.buffer,SharedArrayBuffer)))return T(o,n,s);if(typeof o=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const l=o.valueOf&&o.valueOf();if(l!=null&&l!==o)return c.from(l,n,s);const g=k(o);if(g)return g;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof o[Symbol.toPrimitive]=="function")return c.from(o[Symbol.toPrimitive]("string"),n,s);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o)}c.from=function(o,n,s){return m(o,n,s)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array);function _(o){if(typeof o!="number")throw new TypeError('"size" argument must be of type number');if(o<0)throw new RangeError('The value "'+o+'" is invalid for option "size"')}function p(o,n,s){return _(o),o<=0?d(o):n!==void 0?typeof s=="string"?d(o).fill(n,s):d(o).fill(n):d(o)}c.alloc=function(o,n,s){return p(o,n,s)};function w(o){return _(o),d(o<0?0:y(o)|0)}c.allocUnsafe=function(o){return w(o)},c.allocUnsafeSlow=function(o){return w(o)};function I(o,n){if((typeof n!="string"||n==="")&&(n="utf8"),!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);const s=x(o,n)|0;let l=d(s);const g=l.write(o,n);return g!==s&&(l=l.slice(0,g)),l}function j(o){const n=o.length<0?0:y(o.length)|0,s=d(n);for(let l=0;l<n;l+=1)s[l]=o[l]&255;return s}function O(o){if(he(o,Uint8Array)){const n=new Uint8Array(o);return T(n.buffer,n.byteOffset,n.byteLength)}return j(o)}function T(o,n,s){if(n<0||o.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(o.byteLength<n+(s||0))throw new RangeError('"length" is outside of buffer bounds');let l;return n===void 0&&s===void 0?l=new Uint8Array(o):s===void 0?l=new Uint8Array(o,n):l=new Uint8Array(o,n,s),Object.setPrototypeOf(l,c.prototype),l}function k(o){if(c.isBuffer(o)){const n=y(o.length)|0,s=d(n);return s.length===0||o.copy(s,0,0,n),s}if(o.length!==void 0)return typeof o.length!="number"||ke(o.length)?d(0):j(o);if(o.type==="Buffer"&&Array.isArray(o.data))return j(o.data)}function y(o){if(o>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return o|0}function v(o){return+o!=o&&(o=0),c.alloc(+o)}c.isBuffer=function(n){return n!=null&&n._isBuffer===!0&&n!==c.prototype},c.compare=function(n,s){if(he(n,Uint8Array)&&(n=c.from(n,n.offset,n.byteLength)),he(s,Uint8Array)&&(s=c.from(s,s.offset,s.byteLength)),!c.isBuffer(n)||!c.isBuffer(s))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===s)return 0;let l=n.length,g=s.length;for(let b=0,R=Math.min(l,g);b<R;++b)if(n[b]!==s[b]){l=n[b],g=s[b];break}return l<g?-1:g<l?1:0},c.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(n,s){if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return c.alloc(0);let l;if(s===void 0)for(s=0,l=0;l<n.length;++l)s+=n[l].length;const g=c.allocUnsafe(s);let b=0;for(l=0;l<n.length;++l){let R=n[l];if(he(R,Uint8Array))b+R.length>g.length?(c.isBuffer(R)||(R=c.from(R)),R.copy(g,b)):Uint8Array.prototype.set.call(g,R,b);else if(c.isBuffer(R))R.copy(g,b);else throw new TypeError('"list" argument must be an Array of Buffers');b+=R.length}return g};function x(o,n){if(c.isBuffer(o))return o.length;if(ArrayBuffer.isView(o)||he(o,ArrayBuffer))return o.byteLength;if(typeof o!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof o);const s=o.length,l=arguments.length>2&&arguments[2]===!0;if(!l&&s===0)return 0;let g=!1;for(;;)switch(n){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return J(o).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s*2;case"hex":return s>>>1;case"base64":return We(o).length;default:if(g)return l?-1:J(o).length;n=(""+n).toLowerCase(),g=!0}}c.byteLength=x;function C(o,n,s){let l=!1;if((n===void 0||n<0)&&(n=0),n>this.length||((s===void 0||s>this.length)&&(s=this.length),s<=0)||(s>>>=0,n>>>=0,s<=n))return"";for(o||(o="utf8");;)switch(o){case"hex":return le(this,n,s);case"utf8":case"utf-8":return Te(this,n,s);case"ascii":return se(this,n,s);case"latin1":case"binary":return ae(this,n,s);case"base64":return _e(this,n,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ve(this,n,s);default:if(l)throw new TypeError("Unknown encoding: "+o);o=(o+"").toLowerCase(),l=!0}}c.prototype._isBuffer=!0;function N(o,n,s){const l=o[n];o[n]=o[s],o[s]=l}c.prototype.swap16=function(){const n=this.length;if(n%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let s=0;s<n;s+=2)N(this,s,s+1);return this},c.prototype.swap32=function(){const n=this.length;if(n%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let s=0;s<n;s+=4)N(this,s,s+3),N(this,s+1,s+2);return this},c.prototype.swap64=function(){const n=this.length;if(n%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let s=0;s<n;s+=8)N(this,s,s+7),N(this,s+1,s+6),N(this,s+2,s+5),N(this,s+3,s+4);return this},c.prototype.toString=function(){const n=this.length;return n===0?"":arguments.length===0?Te(this,0,n):C.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(n){if(!c.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n?!0:c.compare(this,n)===0},c.prototype.inspect=function(){let n="";const s=r.INSPECT_MAX_BYTES;return n=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(n+=" ... "),"<Buffer "+n+">"},i&&(c.prototype[i]=c.prototype.inspect),c.prototype.compare=function(n,s,l,g,b){if(he(n,Uint8Array)&&(n=c.from(n,n.offset,n.byteLength)),!c.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(s===void 0&&(s=0),l===void 0&&(l=n?n.length:0),g===void 0&&(g=0),b===void 0&&(b=this.length),s<0||l>n.length||g<0||b>this.length)throw new RangeError("out of range index");if(g>=b&&s>=l)return 0;if(g>=b)return-1;if(s>=l)return 1;if(s>>>=0,l>>>=0,g>>>=0,b>>>=0,this===n)return 0;let R=b-g,H=l-s;const re=Math.min(R,H),te=this.slice(g,b),ne=n.slice(s,l);for(let Q=0;Q<re;++Q)if(te[Q]!==ne[Q]){R=te[Q],H=ne[Q];break}return R<H?-1:H<R?1:0};function L(o,n,s,l,g){if(o.length===0)return-1;if(typeof s=="string"?(l=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),s=+s,ke(s)&&(s=g?0:o.length-1),s<0&&(s=o.length+s),s>=o.length){if(g)return-1;s=o.length-1}else if(s<0)if(g)s=0;else return-1;if(typeof n=="string"&&(n=c.from(n,l)),c.isBuffer(n))return n.length===0?-1:q(o,n,s,l,g);if(typeof n=="number")return n=n&255,typeof Uint8Array.prototype.indexOf=="function"?g?Uint8Array.prototype.indexOf.call(o,n,s):Uint8Array.prototype.lastIndexOf.call(o,n,s):q(o,[n],s,l,g);throw new TypeError("val must be string, number or Buffer")}function q(o,n,s,l,g){let b=1,R=o.length,H=n.length;if(l!==void 0&&(l=String(l).toLowerCase(),l==="ucs2"||l==="ucs-2"||l==="utf16le"||l==="utf-16le")){if(o.length<2||n.length<2)return-1;b=2,R/=2,H/=2,s/=2}function re(ne,Q){return b===1?ne[Q]:ne.readUInt16BE(Q*b)}let te;if(g){let ne=-1;for(te=s;te<R;te++)if(re(o,te)===re(n,ne===-1?0:te-ne)){if(ne===-1&&(ne=te),te-ne+1===H)return ne*b}else ne!==-1&&(te-=te-ne),ne=-1}else for(s+H>R&&(s=R-H),te=s;te>=0;te--){let ne=!0;for(let Q=0;Q<H;Q++)if(re(o,te+Q)!==re(n,Q)){ne=!1;break}if(ne)return te}return-1}c.prototype.includes=function(n,s,l){return this.indexOf(n,s,l)!==-1},c.prototype.indexOf=function(n,s,l){return L(this,n,s,l,!0)},c.prototype.lastIndexOf=function(n,s,l){return L(this,n,s,l,!1)};function M(o,n,s,l){s=Number(s)||0;const g=o.length-s;l?(l=Number(l),l>g&&(l=g)):l=g;const b=n.length;l>b/2&&(l=b/2);let R;for(R=0;R<l;++R){const H=parseInt(n.substr(R*2,2),16);if(ke(H))return R;o[s+R]=H}return R}function P(o,n,s,l){return Pe(J(n,o.length-s),o,s,l)}function ue(o,n,s,l){return Pe(Ne(n),o,s,l)}function Ae(o,n,s,l){return Pe(We(n),o,s,l)}function Se(o,n,s,l){return Pe(Me(n,o.length-s),o,s,l)}c.prototype.write=function(n,s,l,g){if(s===void 0)g="utf8",l=this.length,s=0;else if(l===void 0&&typeof s=="string")g=s,l=this.length,s=0;else if(isFinite(s))s=s>>>0,isFinite(l)?(l=l>>>0,g===void 0&&(g="utf8")):(g=l,l=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const b=this.length-s;if((l===void 0||l>b)&&(l=b),n.length>0&&(l<0||s<0)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");g||(g="utf8");let R=!1;for(;;)switch(g){case"hex":return M(this,n,s,l);case"utf8":case"utf-8":return P(this,n,s,l);case"ascii":case"latin1":case"binary":return ue(this,n,s,l);case"base64":return Ae(this,n,s,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Se(this,n,s,l);default:if(R)throw new TypeError("Unknown encoding: "+g);g=(""+g).toLowerCase(),R=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function _e(o,n,s){return n===0&&s===o.length?e.fromByteArray(o):e.fromByteArray(o.slice(n,s))}function Te(o,n,s){s=Math.min(o.length,s);const l=[];let g=n;for(;g<s;){const b=o[g];let R=null,H=b>239?4:b>223?3:b>191?2:1;if(g+H<=s){let re,te,ne,Q;switch(H){case 1:b<128&&(R=b);break;case 2:re=o[g+1],(re&192)===128&&(Q=(b&31)<<6|re&63,Q>127&&(R=Q));break;case 3:re=o[g+1],te=o[g+2],(re&192)===128&&(te&192)===128&&(Q=(b&15)<<12|(re&63)<<6|te&63,Q>2047&&(Q<55296||Q>57343)&&(R=Q));break;case 4:re=o[g+1],te=o[g+2],ne=o[g+3],(re&192)===128&&(te&192)===128&&(ne&192)===128&&(Q=(b&15)<<18|(re&63)<<12|(te&63)<<6|ne&63,Q>65535&&Q<1114112&&(R=Q))}}R===null?(R=65533,H=1):R>65535&&(R-=65536,l.push(R>>>10&1023|55296),R=56320|R&1023),l.push(R),g+=H}return ie(l)}const D=4096;function ie(o){const n=o.length;if(n<=D)return String.fromCharCode.apply(String,o);let s="",l=0;for(;l<n;)s+=String.fromCharCode.apply(String,o.slice(l,l+=D));return s}function se(o,n,s){let l="";s=Math.min(o.length,s);for(let g=n;g<s;++g)l+=String.fromCharCode(o[g]&127);return l}function ae(o,n,s){let l="";s=Math.min(o.length,s);for(let g=n;g<s;++g)l+=String.fromCharCode(o[g]);return l}function le(o,n,s){const l=o.length;(!n||n<0)&&(n=0),(!s||s<0||s>l)&&(s=l);let g="";for(let b=n;b<s;++b)g+=He[o[b]];return g}function ve(o,n,s){const l=o.slice(n,s);let g="";for(let b=0;b<l.length-1;b+=2)g+=String.fromCharCode(l[b]+l[b+1]*256);return g}c.prototype.slice=function(n,s){const l=this.length;n=~~n,s=s===void 0?l:~~s,n<0?(n+=l,n<0&&(n=0)):n>l&&(n=l),s<0?(s+=l,s<0&&(s=0)):s>l&&(s=l),s<n&&(s=n);const g=this.subarray(n,s);return Object.setPrototypeOf(g,c.prototype),g};function Z(o,n,s){if(o%1!==0||o<0)throw new RangeError("offset is not uint");if(o+n>s)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(n,s,l){n=n>>>0,s=s>>>0,l||Z(n,s,this.length);let g=this[n],b=1,R=0;for(;++R<s&&(b*=256);)g+=this[n+R]*b;return g},c.prototype.readUintBE=c.prototype.readUIntBE=function(n,s,l){n=n>>>0,s=s>>>0,l||Z(n,s,this.length);let g=this[n+--s],b=1;for(;s>0&&(b*=256);)g+=this[n+--s]*b;return g},c.prototype.readUint8=c.prototype.readUInt8=function(n,s){return n=n>>>0,s||Z(n,1,this.length),this[n]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(n,s){return n=n>>>0,s||Z(n,2,this.length),this[n]|this[n+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(n,s){return n=n>>>0,s||Z(n,2,this.length),this[n]<<8|this[n+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(n,s){return n=n>>>0,s||Z(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+this[n+3]*16777216},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(n,s){return n=n>>>0,s||Z(n,4,this.length),this[n]*16777216+(this[n+1]<<16|this[n+2]<<8|this[n+3])},c.prototype.readBigUInt64LE=de(function(n){n=n>>>0,S(n,"offset");const s=this[n],l=this[n+7];(s===void 0||l===void 0)&&F(n,this.length-8);const g=s+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24,b=this[++n]+this[++n]*2**8+this[++n]*2**16+l*2**24;return BigInt(g)+(BigInt(b)<<BigInt(32))}),c.prototype.readBigUInt64BE=de(function(n){n=n>>>0,S(n,"offset");const s=this[n],l=this[n+7];(s===void 0||l===void 0)&&F(n,this.length-8);const g=s*2**24+this[++n]*2**16+this[++n]*2**8+this[++n],b=this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+l;return(BigInt(g)<<BigInt(32))+BigInt(b)}),c.prototype.readIntLE=function(n,s,l){n=n>>>0,s=s>>>0,l||Z(n,s,this.length);let g=this[n],b=1,R=0;for(;++R<s&&(b*=256);)g+=this[n+R]*b;return b*=128,g>=b&&(g-=Math.pow(2,8*s)),g},c.prototype.readIntBE=function(n,s,l){n=n>>>0,s=s>>>0,l||Z(n,s,this.length);let g=s,b=1,R=this[n+--g];for(;g>0&&(b*=256);)R+=this[n+--g]*b;return b*=128,R>=b&&(R-=Math.pow(2,8*s)),R},c.prototype.readInt8=function(n,s){return n=n>>>0,s||Z(n,1,this.length),this[n]&128?(255-this[n]+1)*-1:this[n]},c.prototype.readInt16LE=function(n,s){n=n>>>0,s||Z(n,2,this.length);const l=this[n]|this[n+1]<<8;return l&32768?l|4294901760:l},c.prototype.readInt16BE=function(n,s){n=n>>>0,s||Z(n,2,this.length);const l=this[n+1]|this[n]<<8;return l&32768?l|4294901760:l},c.prototype.readInt32LE=function(n,s){return n=n>>>0,s||Z(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},c.prototype.readInt32BE=function(n,s){return n=n>>>0,s||Z(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},c.prototype.readBigInt64LE=de(function(n){n=n>>>0,S(n,"offset");const s=this[n],l=this[n+7];(s===void 0||l===void 0)&&F(n,this.length-8);const g=this[n+4]+this[n+5]*2**8+this[n+6]*2**16+(l<<24);return(BigInt(g)<<BigInt(32))+BigInt(s+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24)}),c.prototype.readBigInt64BE=de(function(n){n=n>>>0,S(n,"offset");const s=this[n],l=this[n+7];(s===void 0||l===void 0)&&F(n,this.length-8);const g=(s<<24)+this[++n]*2**16+this[++n]*2**8+this[++n];return(BigInt(g)<<BigInt(32))+BigInt(this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+l)}),c.prototype.readFloatLE=function(n,s){return n=n>>>0,s||Z(n,4,this.length),t.read(this,n,!0,23,4)},c.prototype.readFloatBE=function(n,s){return n=n>>>0,s||Z(n,4,this.length),t.read(this,n,!1,23,4)},c.prototype.readDoubleLE=function(n,s){return n=n>>>0,s||Z(n,8,this.length),t.read(this,n,!0,52,8)},c.prototype.readDoubleBE=function(n,s){return n=n>>>0,s||Z(n,8,this.length),t.read(this,n,!1,52,8)};function ce(o,n,s,l,g,b){if(!c.isBuffer(o))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>g||n<b)throw new RangeError('"value" argument is out of bounds');if(s+l>o.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(n,s,l,g){if(n=+n,s=s>>>0,l=l>>>0,!g){const H=Math.pow(2,8*l)-1;ce(this,n,s,l,H,0)}let b=1,R=0;for(this[s]=n&255;++R<l&&(b*=256);)this[s+R]=n/b&255;return s+l},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(n,s,l,g){if(n=+n,s=s>>>0,l=l>>>0,!g){const H=Math.pow(2,8*l)-1;ce(this,n,s,l,H,0)}let b=l-1,R=1;for(this[s+b]=n&255;--b>=0&&(R*=256);)this[s+b]=n/R&255;return s+l},c.prototype.writeUint8=c.prototype.writeUInt8=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,1,255,0),this[s]=n&255,s+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,2,65535,0),this[s]=n&255,this[s+1]=n>>>8,s+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,2,65535,0),this[s]=n>>>8,this[s+1]=n&255,s+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,4,4294967295,0),this[s+3]=n>>>24,this[s+2]=n>>>16,this[s+1]=n>>>8,this[s]=n&255,s+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,4,4294967295,0),this[s]=n>>>24,this[s+1]=n>>>16,this[s+2]=n>>>8,this[s+3]=n&255,s+4};function Ve(o,n,s,l,g){h(n,l,g,o,s,7);let b=Number(n&BigInt(4294967295));o[s++]=b,b=b>>8,o[s++]=b,b=b>>8,o[s++]=b,b=b>>8,o[s++]=b;let R=Number(n>>BigInt(32)&BigInt(4294967295));return o[s++]=R,R=R>>8,o[s++]=R,R=R>>8,o[s++]=R,R=R>>8,o[s++]=R,s}function Le(o,n,s,l,g){h(n,l,g,o,s,7);let b=Number(n&BigInt(4294967295));o[s+7]=b,b=b>>8,o[s+6]=b,b=b>>8,o[s+5]=b,b=b>>8,o[s+4]=b;let R=Number(n>>BigInt(32)&BigInt(4294967295));return o[s+3]=R,R=R>>8,o[s+2]=R,R=R>>8,o[s+1]=R,R=R>>8,o[s]=R,s+8}c.prototype.writeBigUInt64LE=de(function(n,s=0){return Ve(this,n,s,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=de(function(n,s=0){return Le(this,n,s,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(n,s,l,g){if(n=+n,s=s>>>0,!g){const re=Math.pow(2,8*l-1);ce(this,n,s,l,re-1,-re)}let b=0,R=1,H=0;for(this[s]=n&255;++b<l&&(R*=256);)n<0&&H===0&&this[s+b-1]!==0&&(H=1),this[s+b]=(n/R>>0)-H&255;return s+l},c.prototype.writeIntBE=function(n,s,l,g){if(n=+n,s=s>>>0,!g){const re=Math.pow(2,8*l-1);ce(this,n,s,l,re-1,-re)}let b=l-1,R=1,H=0;for(this[s+b]=n&255;--b>=0&&(R*=256);)n<0&&H===0&&this[s+b+1]!==0&&(H=1),this[s+b]=(n/R>>0)-H&255;return s+l},c.prototype.writeInt8=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,1,127,-128),n<0&&(n=255+n+1),this[s]=n&255,s+1},c.prototype.writeInt16LE=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,2,32767,-32768),this[s]=n&255,this[s+1]=n>>>8,s+2},c.prototype.writeInt16BE=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,2,32767,-32768),this[s]=n>>>8,this[s+1]=n&255,s+2},c.prototype.writeInt32LE=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,4,2147483647,-2147483648),this[s]=n&255,this[s+1]=n>>>8,this[s+2]=n>>>16,this[s+3]=n>>>24,s+4},c.prototype.writeInt32BE=function(n,s,l){return n=+n,s=s>>>0,l||ce(this,n,s,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),this[s]=n>>>24,this[s+1]=n>>>16,this[s+2]=n>>>8,this[s+3]=n&255,s+4},c.prototype.writeBigInt64LE=de(function(n,s=0){return Ve(this,n,s,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=de(function(n,s=0){return Le(this,n,s,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function De(o,n,s,l,g,b){if(s+l>o.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function E(o,n,s,l,g){return n=+n,s=s>>>0,g||De(o,n,s,4),t.write(o,n,s,l,23,4),s+4}c.prototype.writeFloatLE=function(n,s,l){return E(this,n,s,!0,l)},c.prototype.writeFloatBE=function(n,s,l){return E(this,n,s,!1,l)};function V(o,n,s,l,g){return n=+n,s=s>>>0,g||De(o,n,s,8),t.write(o,n,s,l,52,8),s+8}c.prototype.writeDoubleLE=function(n,s,l){return V(this,n,s,!0,l)},c.prototype.writeDoubleBE=function(n,s,l){return V(this,n,s,!1,l)},c.prototype.copy=function(n,s,l,g){if(!c.isBuffer(n))throw new TypeError("argument should be a Buffer");if(l||(l=0),!g&&g!==0&&(g=this.length),s>=n.length&&(s=n.length),s||(s=0),g>0&&g<l&&(g=l),g===l||n.length===0||this.length===0)return 0;if(s<0)throw new RangeError("targetStart out of bounds");if(l<0||l>=this.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("sourceEnd out of bounds");g>this.length&&(g=this.length),n.length-s<g-l&&(g=n.length-s+l);const b=g-l;return this===n&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(s,l,g):Uint8Array.prototype.set.call(n,this.subarray(l,g),s),b},c.prototype.fill=function(n,s,l,g){if(typeof n=="string"){if(typeof s=="string"?(g=s,s=0,l=this.length):typeof l=="string"&&(g=l,l=this.length),g!==void 0&&typeof g!="string")throw new TypeError("encoding must be a string");if(typeof g=="string"&&!c.isEncoding(g))throw new TypeError("Unknown encoding: "+g);if(n.length===1){const R=n.charCodeAt(0);(g==="utf8"&&R<128||g==="latin1")&&(n=R)}}else typeof n=="number"?n=n&255:typeof n=="boolean"&&(n=Number(n));if(s<0||this.length<s||this.length<l)throw new RangeError("Out of range index");if(l<=s)return this;s=s>>>0,l=l===void 0?this.length:l>>>0,n||(n=0);let b;if(typeof n=="number")for(b=s;b<l;++b)this[b]=n;else{const R=c.isBuffer(n)?n:c.from(n,g),H=R.length;if(H===0)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(b=0;b<l-s;++b)this[b+s]=R[b%H]}return this};const B={};function U(o,n,s){B[o]=class extends s{constructor(){super(),Object.defineProperty(this,"message",{value:n.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${o}]`,this.stack,delete this.name}get code(){return o}set code(g){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:g,writable:!0})}toString(){return`${this.name} [${o}]: ${this.message}`}}}U("ERR_BUFFER_OUT_OF_BOUNDS",function(o){return o?`${o} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),U("ERR_INVALID_ARG_TYPE",function(o,n){return`The "${o}" argument must be of type number. Received type ${typeof n}`},TypeError),U("ERR_OUT_OF_RANGE",function(o,n,s){let l=`The value of "${o}" is out of range.`,g=s;return Number.isInteger(s)&&Math.abs(s)>2**32?g=$(String(s)):typeof s=="bigint"&&(g=String(s),(s>BigInt(2)**BigInt(32)||s<-(BigInt(2)**BigInt(32)))&&(g=$(g)),g+="n"),l+=` It must be ${n}. Received ${g}`,l},RangeError);function $(o){let n="",s=o.length;const l=o[0]==="-"?1:0;for(;s>=l+4;s-=3)n=`_${o.slice(s-3,s)}${n}`;return`${o.slice(0,s)}${n}`}function u(o,n,s){S(n,"offset"),(o[n]===void 0||o[n+s]===void 0)&&F(n,o.length-(s+1))}function h(o,n,s,l,g,b){if(o>s||o<n){const R=typeof n=="bigint"?"n":"";let H;throw n===0||n===BigInt(0)?H=`>= 0${R} and < 2${R} ** ${(b+1)*8}${R}`:H=`>= -(2${R} ** ${(b+1)*8-1}${R}) and < 2 ** ${(b+1)*8-1}${R}`,new B.ERR_OUT_OF_RANGE("value",H,o)}u(l,g,b)}function S(o,n){if(typeof o!="number")throw new B.ERR_INVALID_ARG_TYPE(n,"number",o)}function F(o,n,s){throw Math.floor(o)!==o?(S(o,s),new B.ERR_OUT_OF_RANGE("offset","an integer",o)):n<0?new B.ERR_BUFFER_OUT_OF_BOUNDS:new B.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${n}`,o)}const ee=/[^+/0-9A-Za-z-_]/g;function W(o){if(o=o.split("=")[0],o=o.trim().replace(ee,""),o.length<2)return"";for(;o.length%4!==0;)o=o+"=";return o}function J(o,n){n=n||1/0;let s;const l=o.length;let g=null;const b=[];for(let R=0;R<l;++R){if(s=o.charCodeAt(R),s>55295&&s<57344){if(!g){if(s>56319){(n-=3)>-1&&b.push(239,191,189);continue}else if(R+1===l){(n-=3)>-1&&b.push(239,191,189);continue}g=s;continue}if(s<56320){(n-=3)>-1&&b.push(239,191,189),g=s;continue}s=(g-55296<<10|s-56320)+65536}else g&&(n-=3)>-1&&b.push(239,191,189);if(g=null,s<128){if((n-=1)<0)break;b.push(s)}else if(s<2048){if((n-=2)<0)break;b.push(s>>6|192,s&63|128)}else if(s<65536){if((n-=3)<0)break;b.push(s>>12|224,s>>6&63|128,s&63|128)}else if(s<1114112){if((n-=4)<0)break;b.push(s>>18|240,s>>12&63|128,s>>6&63|128,s&63|128)}else throw new Error("Invalid code point")}return b}function Ne(o){const n=[];for(let s=0;s<o.length;++s)n.push(o.charCodeAt(s)&255);return n}function Me(o,n){let s,l,g;const b=[];for(let R=0;R<o.length&&!((n-=2)<0);++R)s=o.charCodeAt(R),l=s>>8,g=s%256,b.push(g),b.push(l);return b}function We(o){return e.toByteArray(W(o))}function Pe(o,n,s,l){let g;for(g=0;g<l&&!(g+s>=n.length||g>=o.length);++g)n[g+s]=o[g];return g}function he(o,n){return o instanceof n||o!=null&&o.constructor!=null&&o.constructor.name!=null&&o.constructor.name===n.name}function ke(o){return o!==o}const He=function(){const o="0123456789abcdef",n=new Array(256);for(let s=0;s<16;++s){const l=s*16;for(let g=0;g<16;++g)n[l+g]=o[s]+o[g]}return n}();function de(o){return typeof BigInt>"u"?Ie:o}function Ie(){throw new Error("BigInt not supported")}})(qe);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(r,e){var t=qe,i=t.Buffer;function a(d,c){for(var m in d)c[m]=d[m]}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?r.exports=t:(a(t,e),e.Buffer=f);function f(d,c,m){return i(d,c,m)}f.prototype=Object.create(i.prototype),a(i,f),f.from=function(d,c,m){if(typeof d=="number")throw new TypeError("Argument must not be a number");return i(d,c,m)},f.alloc=function(d,c,m){if(typeof d!="number")throw new TypeError("Argument must be a number");var _=i(d);return c!==void 0?typeof m=="string"?_.fill(c,m):_.fill(c):_.fill(0),_},f.allocUnsafe=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return i(d)},f.allocUnsafeSlow=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(d)}})(Ot,Ot.exports);var Dr=Ot.exports,gt=65536,$n=4294967295;function Wn(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var Hn=Dr.Buffer,it=xe.crypto||xe.msCrypto;it&&it.getRandomValues?It.exports=Yn:It.exports=Wn;function Yn(r,e){if(r>$n)throw new RangeError("requested too many random bytes");var t=Hn.allocUnsafe(r);if(r>0)if(r>gt)for(var i=0;i<r;i+=gt)it.getRandomValues(t.slice(i,i+gt));else it.getRandomValues(t);return typeof e=="function"?process.nextTick(function(){e(null,t)}):t}var zn=It.exports,Ft={exports:{}};const Kn={},Gn=Object.freeze(Object.defineProperty({__proto__:null,default:Kn},Symbol.toStringTag,{value:"Module"})),st=fn(Gn);var Mr=st.EventEmitter,yt,hr;function Jn(){if(hr)return yt;hr=1;function r(O,T){var k=Object.keys(O);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(O);T&&(y=y.filter(function(v){return Object.getOwnPropertyDescriptor(O,v).enumerable})),k.push.apply(k,y)}return k}function e(O){for(var T=1;T<arguments.length;T++){var k=arguments[T]!=null?arguments[T]:{};T%2?r(Object(k),!0).forEach(function(y){t(O,y,k[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(k)):r(Object(k)).forEach(function(y){Object.defineProperty(O,y,Object.getOwnPropertyDescriptor(k,y))})}return O}function t(O,T,k){return T=d(T),T in O?Object.defineProperty(O,T,{value:k,enumerable:!0,configurable:!0,writable:!0}):O[T]=k,O}function i(O,T){if(!(O instanceof T))throw new TypeError("Cannot call a class as a function")}function a(O,T){for(var k=0;k<T.length;k++){var y=T[k];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(O,d(y.key),y)}}function f(O,T,k){return T&&a(O.prototype,T),Object.defineProperty(O,"prototype",{writable:!1}),O}function d(O){var T=c(O,"string");return typeof T=="symbol"?T:String(T)}function c(O,T){if(typeof O!="object"||O===null)return O;var k=O[Symbol.toPrimitive];if(k!==void 0){var y=k.call(O,T||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(T==="string"?String:Number)(O)}var m=qe,_=m.Buffer,p=st,w=p.inspect,I=w&&w.custom||"inspect";function j(O,T,k){_.prototype.copy.call(O,T,k)}return yt=function(){function O(){i(this,O),this.head=null,this.tail=null,this.length=0}return f(O,[{key:"push",value:function(k){var y={data:k,next:null};this.length>0?this.tail.next=y:this.head=y,this.tail=y,++this.length}},{key:"unshift",value:function(k){var y={data:k,next:this.head};this.length===0&&(this.tail=y),this.head=y,++this.length}},{key:"shift",value:function(){if(this.length!==0){var k=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,k}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(k){if(this.length===0)return"";for(var y=this.head,v=""+y.data;y=y.next;)v+=k+y.data;return v}},{key:"concat",value:function(k){if(this.length===0)return _.alloc(0);for(var y=_.allocUnsafe(k>>>0),v=this.head,x=0;v;)j(v.data,y,x),x+=v.data.length,v=v.next;return y}},{key:"consume",value:function(k,y){var v;return k<this.head.data.length?(v=this.head.data.slice(0,k),this.head.data=this.head.data.slice(k)):k===this.head.data.length?v=this.shift():v=y?this._getString(k):this._getBuffer(k),v}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(k){var y=this.head,v=1,x=y.data;for(k-=x.length;y=y.next;){var C=y.data,N=k>C.length?C.length:k;if(N===C.length?x+=C:x+=C.slice(0,k),k-=N,k===0){N===C.length?(++v,y.next?this.head=y.next:this.head=this.tail=null):(this.head=y,y.data=C.slice(N));break}++v}return this.length-=v,x}},{key:"_getBuffer",value:function(k){var y=_.allocUnsafe(k),v=this.head,x=1;for(v.data.copy(y),k-=v.data.length;v=v.next;){var C=v.data,N=k>C.length?C.length:k;if(C.copy(y,y.length-k,0,N),k-=N,k===0){N===C.length?(++x,v.next?this.head=v.next:this.head=this.tail=null):(this.head=v,v.data=C.slice(N));break}++x}return this.length-=x,y}},{key:I,value:function(k,y){return w(this,e(e({},y),{},{depth:0,customInspect:!1}))}}]),O}(),yt}function Xn(r,e){var t=this,i=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return i||a?(e?e(r):r&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(Lt,this,r)):process.nextTick(Lt,this,r)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,function(f){!e&&f?t._writableState?t._writableState.errorEmitted?process.nextTick(Ze,t):(t._writableState.errorEmitted=!0,process.nextTick(fr,t,f)):process.nextTick(fr,t,f):e?(process.nextTick(Ze,t),e(f)):process.nextTick(Ze,t)}),this)}function fr(r,e){Lt(r,e),Ze(r)}function Ze(r){r._writableState&&!r._writableState.emitClose||r._readableState&&!r._readableState.emitClose||r.emit("close")}function Qn(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Lt(r,e){r.emit("error",e)}function Zn(r,e){var t=r._readableState,i=r._writableState;t&&t.autoDestroy||i&&i.autoDestroy?r.destroy(e):r.emit("error",e)}var Pr={destroy:Xn,undestroy:Qn,errorOrDestroy:Zn},Fe={};function ei(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var jr={};function ye(r,e,t){t||(t=Error);function i(f,d,c){return typeof e=="string"?e:e(f,d,c)}var a=function(f){ei(d,f);function d(c,m,_){return f.call(this,i(c,m,_))||this}return d}(t);a.prototype.name=t.name,a.prototype.code=r,jr[r]=a}function dr(r,e){if(Array.isArray(r)){var t=r.length;return r=r.map(function(i){return String(i)}),t>2?"one of ".concat(e," ").concat(r.slice(0,t-1).join(", "),", or ")+r[t-1]:t===2?"one of ".concat(e," ").concat(r[0]," or ").concat(r[1]):"of ".concat(e," ").concat(r[0])}else return"of ".concat(e," ").concat(String(r))}function ti(r,e,t){return r.substr(0,e.length)===e}function ri(r,e,t){return(t===void 0||t>r.length)&&(t=r.length),r.substring(t-e.length,t)===e}function ni(r,e,t){return typeof t!="number"&&(t=0),t+e.length>r.length?!1:r.indexOf(e,t)!==-1}ye("ERR_INVALID_OPT_VALUE",function(r,e){return'The value "'+e+'" is invalid for option "'+r+'"'},TypeError);ye("ERR_INVALID_ARG_TYPE",function(r,e,t){var i;typeof e=="string"&&ti(e,"not ")?(i="must not be",e=e.replace(/^not /,"")):i="must be";var a;if(ri(r," argument"))a="The ".concat(r," ").concat(i," ").concat(dr(e,"type"));else{var f=ni(r,".")?"property":"argument";a='The "'.concat(r,'" ').concat(f," ").concat(i," ").concat(dr(e,"type"))}return a+=". Received type ".concat(typeof t),a},TypeError);ye("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");ye("ERR_METHOD_NOT_IMPLEMENTED",function(r){return"The "+r+" method is not implemented"});ye("ERR_STREAM_PREMATURE_CLOSE","Premature close");ye("ERR_STREAM_DESTROYED",function(r){return"Cannot call "+r+" after a stream was destroyed"});ye("ERR_MULTIPLE_CALLBACK","Callback called multiple times");ye("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");ye("ERR_STREAM_WRITE_AFTER_END","write after end");ye("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);ye("ERR_UNKNOWN_ENCODING",function(r){return"Unknown encoding: "+r},TypeError);ye("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Fe.codes=jr;var ii=Fe.codes.ERR_INVALID_OPT_VALUE;function si(r,e,t){return r.highWaterMark!=null?r.highWaterMark:e?r[t]:null}function oi(r,e,t,i){var a=si(e,i,t);if(a!=null){if(!(isFinite(a)&&Math.floor(a)===a)||a<0){var f=i?t:"highWaterMark";throw new ii(f,a)}return Math.floor(a)}return r.objectMode?16:16*1024}var Ur={getHighWaterMark:oi},Dt={exports:{}};typeof Object.create=="function"?Dt.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Dt.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}};var Ge=Dt.exports,ai=li;function li(r,e){if(mt("noDeprecation"))return r;var t=!1;function i(){if(!t){if(mt("throwDeprecation"))throw new Error(e);mt("traceDeprecation")?console.trace(e):console.warn(e),t=!0}return r.apply(this,arguments)}return i}function mt(r){try{if(!xe.localStorage)return!1}catch{return!1}var e=xe.localStorage[r];return e==null?!1:String(e).toLowerCase()==="true"}var _t,pr;function qr(){if(pr)return _t;pr=1,_t=M;function r(E){var V=this;this.next=null,this.entry=null,this.finish=function(){De(V,E)}}var e;M.WritableState=L;var t={deprecate:ai},i=Mr,a=qe.Buffer,f=(typeof xe<"u"?xe:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function d(E){return a.from(E)}function c(E){return a.isBuffer(E)||E instanceof f}var m=Pr,_=Ur,p=_.getHighWaterMark,w=Fe.codes,I=w.ERR_INVALID_ARG_TYPE,j=w.ERR_METHOD_NOT_IMPLEMENTED,O=w.ERR_MULTIPLE_CALLBACK,T=w.ERR_STREAM_CANNOT_PIPE,k=w.ERR_STREAM_DESTROYED,y=w.ERR_STREAM_NULL_VALUES,v=w.ERR_STREAM_WRITE_AFTER_END,x=w.ERR_UNKNOWN_ENCODING,C=m.errorOrDestroy;Ge(M,i);function N(){}function L(E,V,B){e=e||Ue(),E=E||{},typeof B!="boolean"&&(B=V instanceof e),this.objectMode=!!E.objectMode,B&&(this.objectMode=this.objectMode||!!E.writableObjectMode),this.highWaterMark=p(this,E,"writableHighWaterMark",B),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var U=E.decodeStrings===!1;this.decodeStrings=!U,this.defaultEncoding=E.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function($){ie(V,$)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=E.emitClose!==!1,this.autoDestroy=!!E.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}L.prototype.getBuffer=function(){for(var V=this.bufferedRequest,B=[];V;)B.push(V),V=V.next;return B},function(){try{Object.defineProperty(L.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var q;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(q=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(V){return q.call(this,V)?!0:this!==M?!1:V&&V._writableState instanceof L}})):q=function(V){return V instanceof this};function M(E){e=e||Ue();var V=this instanceof e;if(!V&&!q.call(M,this))return new M(E);this._writableState=new L(E,this,V),this.writable=!0,E&&(typeof E.write=="function"&&(this._write=E.write),typeof E.writev=="function"&&(this._writev=E.writev),typeof E.destroy=="function"&&(this._destroy=E.destroy),typeof E.final=="function"&&(this._final=E.final)),i.call(this)}M.prototype.pipe=function(){C(this,new T)};function P(E,V){var B=new v;C(E,B),process.nextTick(V,B)}function ue(E,V,B,U){var $;return B===null?$=new y:typeof B!="string"&&!V.objectMode&&($=new I("chunk",["string","Buffer"],B)),$?(C(E,$),process.nextTick(U,$),!1):!0}M.prototype.write=function(E,V,B){var U=this._writableState,$=!1,u=!U.objectMode&&c(E);return u&&!a.isBuffer(E)&&(E=d(E)),typeof V=="function"&&(B=V,V=null),u?V="buffer":V||(V=U.defaultEncoding),typeof B!="function"&&(B=N),U.ending?P(this,B):(u||ue(this,U,E,B))&&(U.pendingcb++,$=Se(this,U,u,E,V,B)),$},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){var E=this._writableState;E.corked&&(E.corked--,!E.writing&&!E.corked&&!E.bufferProcessing&&E.bufferedRequest&&le(this,E))},M.prototype.setDefaultEncoding=function(V){if(typeof V=="string"&&(V=V.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((V+"").toLowerCase())>-1))throw new x(V);return this._writableState.defaultEncoding=V,this},Object.defineProperty(M.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Ae(E,V,B){return!E.objectMode&&E.decodeStrings!==!1&&typeof V=="string"&&(V=a.from(V,B)),V}Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Se(E,V,B,U,$,u){if(!B){var h=Ae(V,U,$);U!==h&&(B=!0,$="buffer",U=h)}var S=V.objectMode?1:U.length;V.length+=S;var F=V.length<V.highWaterMark;if(F||(V.needDrain=!0),V.writing||V.corked){var ee=V.lastBufferedRequest;V.lastBufferedRequest={chunk:U,encoding:$,isBuf:B,callback:u,next:null},ee?ee.next=V.lastBufferedRequest:V.bufferedRequest=V.lastBufferedRequest,V.bufferedRequestCount+=1}else _e(E,V,!1,S,U,$,u);return F}function _e(E,V,B,U,$,u,h){V.writelen=U,V.writecb=h,V.writing=!0,V.sync=!0,V.destroyed?V.onwrite(new k("write")):B?E._writev($,V.onwrite):E._write($,u,V.onwrite),V.sync=!1}function Te(E,V,B,U,$){--V.pendingcb,B?(process.nextTick($,U),process.nextTick(Ve,E,V),E._writableState.errorEmitted=!0,C(E,U)):($(U),E._writableState.errorEmitted=!0,C(E,U),Ve(E,V))}function D(E){E.writing=!1,E.writecb=null,E.length-=E.writelen,E.writelen=0}function ie(E,V){var B=E._writableState,U=B.sync,$=B.writecb;if(typeof $!="function")throw new O;if(D(B),V)Te(E,B,U,V,$);else{var u=ve(B)||E.destroyed;!u&&!B.corked&&!B.bufferProcessing&&B.bufferedRequest&&le(E,B),U?process.nextTick(se,E,B,u,$):se(E,B,u,$)}}function se(E,V,B,U){B||ae(E,V),V.pendingcb--,U(),Ve(E,V)}function ae(E,V){V.length===0&&V.needDrain&&(V.needDrain=!1,E.emit("drain"))}function le(E,V){V.bufferProcessing=!0;var B=V.bufferedRequest;if(E._writev&&B&&B.next){var U=V.bufferedRequestCount,$=new Array(U),u=V.corkedRequestsFree;u.entry=B;for(var h=0,S=!0;B;)$[h]=B,B.isBuf||(S=!1),B=B.next,h+=1;$.allBuffers=S,_e(E,V,!0,V.length,$,"",u.finish),V.pendingcb++,V.lastBufferedRequest=null,u.next?(V.corkedRequestsFree=u.next,u.next=null):V.corkedRequestsFree=new r(V),V.bufferedRequestCount=0}else{for(;B;){var F=B.chunk,ee=B.encoding,W=B.callback,J=V.objectMode?1:F.length;if(_e(E,V,!1,J,F,ee,W),B=B.next,V.bufferedRequestCount--,V.writing)break}B===null&&(V.lastBufferedRequest=null)}V.bufferedRequest=B,V.bufferProcessing=!1}M.prototype._write=function(E,V,B){B(new j("_write()"))},M.prototype._writev=null,M.prototype.end=function(E,V,B){var U=this._writableState;return typeof E=="function"?(B=E,E=null,V=null):typeof V=="function"&&(B=V,V=null),E!=null&&this.write(E,V),U.corked&&(U.corked=1,this.uncork()),U.ending||Le(this,U,B),this},Object.defineProperty(M.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ve(E){return E.ending&&E.length===0&&E.bufferedRequest===null&&!E.finished&&!E.writing}function Z(E,V){E._final(function(B){V.pendingcb--,B&&C(E,B),V.prefinished=!0,E.emit("prefinish"),Ve(E,V)})}function ce(E,V){!V.prefinished&&!V.finalCalled&&(typeof E._final=="function"&&!V.destroyed?(V.pendingcb++,V.finalCalled=!0,process.nextTick(Z,E,V)):(V.prefinished=!0,E.emit("prefinish")))}function Ve(E,V){var B=ve(V);if(B&&(ce(E,V),V.pendingcb===0&&(V.finished=!0,E.emit("finish"),V.autoDestroy))){var U=E._readableState;(!U||U.autoDestroy&&U.endEmitted)&&E.destroy()}return B}function Le(E,V,B){V.ending=!0,Ve(E,V),B&&(V.finished?process.nextTick(B):E.once("finish",B)),V.ended=!0,E.writable=!1}function De(E,V,B){var U=E.entry;for(E.entry=null;U;){var $=U.callback;V.pendingcb--,$(B),U=U.next}V.corkedRequestsFree.next=E}return Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(V){this._writableState&&(this._writableState.destroyed=V)}}),M.prototype.destroy=m.destroy,M.prototype._undestroy=m.undestroy,M.prototype._destroy=function(E,V){V(E)},_t}var Vt,gr;function Ue(){if(gr)return Vt;gr=1;var r=Object.keys||function(_){var p=[];for(var w in _)p.push(w);return p};Vt=d;var e=Wr(),t=qr();Ge(d,e);for(var i=r(t.prototype),a=0;a<i.length;a++){var f=i[a];d.prototype[f]||(d.prototype[f]=t.prototype[f])}function d(_){if(!(this instanceof d))return new d(_);e.call(this,_),t.call(this,_),this.allowHalfOpen=!0,_&&(_.readable===!1&&(this.readable=!1),_.writable===!1&&(this.writable=!1),_.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",c)))}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(d.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function c(){this._writableState.ended||process.nextTick(m,this)}function m(_){_.end()}return Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(p){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=p,this._writableState.destroyed=p)}}),Vt}var wt={},yr;function mr(){if(yr)return wt;yr=1;var r=Dr.Buffer,e=r.isEncoding||function(y){switch(y=""+y,y&&y.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(y){if(!y)return"utf8";for(var v;;)switch(y){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return y;default:if(v)return;y=(""+y).toLowerCase(),v=!0}}function i(y){var v=t(y);if(typeof v!="string"&&(r.isEncoding===e||!e(y)))throw new Error("Unknown encoding: "+y);return v||y}wt.StringDecoder=a;function a(y){this.encoding=i(y);var v;switch(this.encoding){case"utf16le":this.text=w,this.end=I,v=4;break;case"utf8":this.fillLast=m,v=4;break;case"base64":this.text=j,this.end=O,v=3;break;default:this.write=T,this.end=k;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(v)}a.prototype.write=function(y){if(y.length===0)return"";var v,x;if(this.lastNeed){if(v=this.fillLast(y),v===void 0)return"";x=this.lastNeed,this.lastNeed=0}else x=0;return x<y.length?v?v+this.text(y,x):this.text(y,x):v||""},a.prototype.end=p,a.prototype.text=_,a.prototype.fillLast=function(y){if(this.lastNeed<=y.length)return y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,y.length),this.lastNeed-=y.length};function f(y){return y<=127?0:y>>5===6?2:y>>4===14?3:y>>3===30?4:y>>6===2?-1:-2}function d(y,v,x){var C=v.length-1;if(C<x)return 0;var N=f(v[C]);return N>=0?(N>0&&(y.lastNeed=N-1),N):--C<x||N===-2?0:(N=f(v[C]),N>=0?(N>0&&(y.lastNeed=N-2),N):--C<x||N===-2?0:(N=f(v[C]),N>=0?(N>0&&(N===2?N=0:y.lastNeed=N-3),N):0))}function c(y,v,x){if((v[0]&192)!==128)return y.lastNeed=0,"";if(y.lastNeed>1&&v.length>1){if((v[1]&192)!==128)return y.lastNeed=1,"";if(y.lastNeed>2&&v.length>2&&(v[2]&192)!==128)return y.lastNeed=2,""}}function m(y){var v=this.lastTotal-this.lastNeed,x=c(this,y);if(x!==void 0)return x;if(this.lastNeed<=y.length)return y.copy(this.lastChar,v,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);y.copy(this.lastChar,v,0,y.length),this.lastNeed-=y.length}function _(y,v){var x=d(this,y,v);if(!this.lastNeed)return y.toString("utf8",v);this.lastTotal=x;var C=y.length-(x-this.lastNeed);return y.copy(this.lastChar,0,C),y.toString("utf8",v,C)}function p(y){var v=y&&y.length?this.write(y):"";return this.lastNeed?v+"":v}function w(y,v){if((y.length-v)%2===0){var x=y.toString("utf16le",v);if(x){var C=x.charCodeAt(x.length-1);if(C>=55296&&C<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=y[y.length-2],this.lastChar[1]=y[y.length-1],x.slice(0,-1)}return x}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=y[y.length-1],y.toString("utf16le",v,y.length-1)}function I(y){var v=y&&y.length?this.write(y):"";if(this.lastNeed){var x=this.lastTotal-this.lastNeed;return v+this.lastChar.toString("utf16le",0,x)}return v}function j(y,v){var x=(y.length-v)%3;return x===0?y.toString("base64",v):(this.lastNeed=3-x,this.lastTotal=3,x===1?this.lastChar[0]=y[y.length-1]:(this.lastChar[0]=y[y.length-2],this.lastChar[1]=y[y.length-1]),y.toString("base64",v,y.length-x))}function O(y){var v=y&&y.length?this.write(y):"";return this.lastNeed?v+this.lastChar.toString("base64",0,3-this.lastNeed):v}function T(y){return y.toString(this.encoding)}function k(y){return y&&y.length?this.write(y):""}return wt}var _r=Fe.codes.ERR_STREAM_PREMATURE_CLOSE;function ci(r){var e=!1;return function(){if(!e){e=!0;for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];r.apply(this,i)}}}function ui(){}function hi(r){return r.setHeader&&typeof r.abort=="function"}function $r(r,e,t){if(typeof e=="function")return $r(r,null,e);e||(e={}),t=ci(t||ui);var i=e.readable||e.readable!==!1&&r.readable,a=e.writable||e.writable!==!1&&r.writable,f=function(){r.writable||c()},d=r._writableState&&r._writableState.finished,c=function(){a=!1,d=!0,i||t.call(r)},m=r._readableState&&r._readableState.endEmitted,_=function(){i=!1,m=!0,a||t.call(r)},p=function(O){t.call(r,O)},w=function(){var O;if(i&&!m)return(!r._readableState||!r._readableState.ended)&&(O=new _r),t.call(r,O);if(a&&!d)return(!r._writableState||!r._writableState.ended)&&(O=new _r),t.call(r,O)},I=function(){r.req.on("finish",c)};return hi(r)?(r.on("complete",c),r.on("abort",w),r.req?I():r.on("request",I)):a&&!r._writableState&&(r.on("end",f),r.on("close",f)),r.on("end",_),r.on("finish",c),e.error!==!1&&r.on("error",p),r.on("close",w),function(){r.removeListener("complete",c),r.removeListener("abort",w),r.removeListener("request",I),r.req&&r.req.removeListener("finish",c),r.removeListener("end",f),r.removeListener("close",f),r.removeListener("finish",c),r.removeListener("end",_),r.removeListener("error",p),r.removeListener("close",w)}}var Yt=$r,bt,Vr;function fi(){if(Vr)return bt;Vr=1;var r;function e(x,C,N){return C=t(C),C in x?Object.defineProperty(x,C,{value:N,enumerable:!0,configurable:!0,writable:!0}):x[C]=N,x}function t(x){var C=i(x,"string");return typeof C=="symbol"?C:String(C)}function i(x,C){if(typeof x!="object"||x===null)return x;var N=x[Symbol.toPrimitive];if(N!==void 0){var L=N.call(x,C||"default");if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(C==="string"?String:Number)(x)}var a=Yt,f=Symbol("lastResolve"),d=Symbol("lastReject"),c=Symbol("error"),m=Symbol("ended"),_=Symbol("lastPromise"),p=Symbol("handlePromise"),w=Symbol("stream");function I(x,C){return{value:x,done:C}}function j(x){var C=x[f];if(C!==null){var N=x[w].read();N!==null&&(x[_]=null,x[f]=null,x[d]=null,C(I(N,!1)))}}function O(x){process.nextTick(j,x)}function T(x,C){return function(N,L){x.then(function(){if(C[m]){N(I(void 0,!0));return}C[p](N,L)},L)}}var k=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((r={get stream(){return this[w]},next:function(){var C=this,N=this[c];if(N!==null)return Promise.reject(N);if(this[m])return Promise.resolve(I(void 0,!0));if(this[w].destroyed)return new Promise(function(P,ue){process.nextTick(function(){C[c]?ue(C[c]):P(I(void 0,!0))})});var L=this[_],q;if(L)q=new Promise(T(L,this));else{var M=this[w].read();if(M!==null)return Promise.resolve(I(M,!1));q=new Promise(this[p])}return this[_]=q,q}},e(r,Symbol.asyncIterator,function(){return this}),e(r,"return",function(){var C=this;return new Promise(function(N,L){C[w].destroy(null,function(q){if(q){L(q);return}N(I(void 0,!0))})})}),r),k),v=function(C){var N,L=Object.create(y,(N={},e(N,w,{value:C,writable:!0}),e(N,f,{value:null,writable:!0}),e(N,d,{value:null,writable:!0}),e(N,c,{value:null,writable:!0}),e(N,m,{value:C._readableState.endEmitted,writable:!0}),e(N,p,{value:function(M,P){var ue=L[w].read();ue?(L[_]=null,L[f]=null,L[d]=null,M(I(ue,!1))):(L[f]=M,L[d]=P)},writable:!0}),N));return L[_]=null,a(C,function(q){if(q&&q.code!=="ERR_STREAM_PREMATURE_CLOSE"){var M=L[d];M!==null&&(L[_]=null,L[f]=null,L[d]=null,M(q)),L[c]=q;return}var P=L[f];P!==null&&(L[_]=null,L[f]=null,L[d]=null,P(I(void 0,!0))),L[m]=!0}),C.on("readable",O.bind(null,L)),L};return bt=v,bt}var Et,wr;function di(){return wr||(wr=1,Et=function(){throw new Error("Readable.from is not available in the browser")}),Et}var At,br;function Wr(){if(br)return At;br=1,At=P;var r;P.ReadableState=M,st.EventEmitter;var e=function(h,S){return h.listeners(S).length},t=Mr,i=qe.Buffer,a=(typeof xe<"u"?xe:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function f(u){return i.from(u)}function d(u){return i.isBuffer(u)||u instanceof a}var c=st,m;c&&c.debuglog?m=c.debuglog("stream"):m=function(){};var _=Jn(),p=Pr,w=Ur,I=w.getHighWaterMark,j=Fe.codes,O=j.ERR_INVALID_ARG_TYPE,T=j.ERR_STREAM_PUSH_AFTER_EOF,k=j.ERR_METHOD_NOT_IMPLEMENTED,y=j.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,v,x,C;Ge(P,t);var N=p.errorOrDestroy,L=["error","close","destroy","pause","resume"];function q(u,h,S){if(typeof u.prependListener=="function")return u.prependListener(h,S);!u._events||!u._events[h]?u.on(h,S):Array.isArray(u._events[h])?u._events[h].unshift(S):u._events[h]=[S,u._events[h]]}function M(u,h,S){r=r||Ue(),u=u||{},typeof S!="boolean"&&(S=h instanceof r),this.objectMode=!!u.objectMode,S&&(this.objectMode=this.objectMode||!!u.readableObjectMode),this.highWaterMark=I(this,u,"readableHighWaterMark",S),this.buffer=new _,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=u.emitClose!==!1,this.autoDestroy=!!u.autoDestroy,this.destroyed=!1,this.defaultEncoding=u.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,u.encoding&&(v||(v=mr().StringDecoder),this.decoder=new v(u.encoding),this.encoding=u.encoding)}function P(u){if(r=r||Ue(),!(this instanceof P))return new P(u);var h=this instanceof r;this._readableState=new M(u,this,h),this.readable=!0,u&&(typeof u.read=="function"&&(this._read=u.read),typeof u.destroy=="function"&&(this._destroy=u.destroy)),t.call(this)}Object.defineProperty(P.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(h){this._readableState&&(this._readableState.destroyed=h)}}),P.prototype.destroy=p.destroy,P.prototype._undestroy=p.undestroy,P.prototype._destroy=function(u,h){h(u)},P.prototype.push=function(u,h){var S=this._readableState,F;return S.objectMode?F=!0:typeof u=="string"&&(h=h||S.defaultEncoding,h!==S.encoding&&(u=i.from(u,h),h=""),F=!0),ue(this,u,h,!1,F)},P.prototype.unshift=function(u){return ue(this,u,null,!0,!1)};function ue(u,h,S,F,ee){m("readableAddChunk",h);var W=u._readableState;if(h===null)W.reading=!1,ie(u,W);else{var J;if(ee||(J=Se(W,h)),J)N(u,J);else if(W.objectMode||h&&h.length>0)if(typeof h!="string"&&!W.objectMode&&Object.getPrototypeOf(h)!==i.prototype&&(h=f(h)),F)W.endEmitted?N(u,new y):Ae(u,W,h,!0);else if(W.ended)N(u,new T);else{if(W.destroyed)return!1;W.reading=!1,W.decoder&&!S?(h=W.decoder.write(h),W.objectMode||h.length!==0?Ae(u,W,h,!1):le(u,W)):Ae(u,W,h,!1)}else F||(W.reading=!1,le(u,W))}return!W.ended&&(W.length<W.highWaterMark||W.length===0)}function Ae(u,h,S,F){h.flowing&&h.length===0&&!h.sync?(h.awaitDrain=0,u.emit("data",S)):(h.length+=h.objectMode?1:S.length,F?h.buffer.unshift(S):h.buffer.push(S),h.needReadable&&se(u)),le(u,h)}function Se(u,h){var S;return!d(h)&&typeof h!="string"&&h!==void 0&&!u.objectMode&&(S=new O("chunk",["string","Buffer","Uint8Array"],h)),S}P.prototype.isPaused=function(){return this._readableState.flowing===!1},P.prototype.setEncoding=function(u){v||(v=mr().StringDecoder);var h=new v(u);this._readableState.decoder=h,this._readableState.encoding=this._readableState.decoder.encoding;for(var S=this._readableState.buffer.head,F="";S!==null;)F+=h.write(S.data),S=S.next;return this._readableState.buffer.clear(),F!==""&&this._readableState.buffer.push(F),this._readableState.length=F.length,this};var _e=1073741824;function Te(u){return u>=_e?u=_e:(u--,u|=u>>>1,u|=u>>>2,u|=u>>>4,u|=u>>>8,u|=u>>>16,u++),u}function D(u,h){return u<=0||h.length===0&&h.ended?0:h.objectMode?1:u!==u?h.flowing&&h.length?h.buffer.head.data.length:h.length:(u>h.highWaterMark&&(h.highWaterMark=Te(u)),u<=h.length?u:h.ended?h.length:(h.needReadable=!0,0))}P.prototype.read=function(u){m("read",u),u=parseInt(u,10);var h=this._readableState,S=u;if(u!==0&&(h.emittedReadable=!1),u===0&&h.needReadable&&((h.highWaterMark!==0?h.length>=h.highWaterMark:h.length>0)||h.ended))return m("read: emitReadable",h.length,h.ended),h.length===0&&h.ended?B(this):se(this),null;if(u=D(u,h),u===0&&h.ended)return h.length===0&&B(this),null;var F=h.needReadable;m("need readable",F),(h.length===0||h.length-u<h.highWaterMark)&&(F=!0,m("length less than watermark",F)),h.ended||h.reading?(F=!1,m("reading or ended",F)):F&&(m("do read"),h.reading=!0,h.sync=!0,h.length===0&&(h.needReadable=!0),this._read(h.highWaterMark),h.sync=!1,h.reading||(u=D(S,h)));var ee;return u>0?ee=V(u,h):ee=null,ee===null?(h.needReadable=h.length<=h.highWaterMark,u=0):(h.length-=u,h.awaitDrain=0),h.length===0&&(h.ended||(h.needReadable=!0),S!==u&&h.ended&&B(this)),ee!==null&&this.emit("data",ee),ee};function ie(u,h){if(m("onEofChunk"),!h.ended){if(h.decoder){var S=h.decoder.end();S&&S.length&&(h.buffer.push(S),h.length+=h.objectMode?1:S.length)}h.ended=!0,h.sync?se(u):(h.needReadable=!1,h.emittedReadable||(h.emittedReadable=!0,ae(u)))}}function se(u){var h=u._readableState;m("emitReadable",h.needReadable,h.emittedReadable),h.needReadable=!1,h.emittedReadable||(m("emitReadable",h.flowing),h.emittedReadable=!0,process.nextTick(ae,u))}function ae(u){var h=u._readableState;m("emitReadable_",h.destroyed,h.length,h.ended),!h.destroyed&&(h.length||h.ended)&&(u.emit("readable"),h.emittedReadable=!1),h.needReadable=!h.flowing&&!h.ended&&h.length<=h.highWaterMark,E(u)}function le(u,h){h.readingMore||(h.readingMore=!0,process.nextTick(ve,u,h))}function ve(u,h){for(;!h.reading&&!h.ended&&(h.length<h.highWaterMark||h.flowing&&h.length===0);){var S=h.length;if(m("maybeReadMore read 0"),u.read(0),S===h.length)break}h.readingMore=!1}P.prototype._read=function(u){N(this,new k("_read()"))},P.prototype.pipe=function(u,h){var S=this,F=this._readableState;switch(F.pipesCount){case 0:F.pipes=u;break;case 1:F.pipes=[F.pipes,u];break;default:F.pipes.push(u);break}F.pipesCount+=1,m("pipe count=%d opts=%j",F.pipesCount,h);var ee=(!h||h.end!==!1)&&u!==process.stdout&&u!==process.stderr,W=ee?Ne:Ie;F.endEmitted?process.nextTick(W):S.once("end",W),u.on("unpipe",J);function J(o,n){m("onunpipe"),o===S&&n&&n.hasUnpiped===!1&&(n.hasUnpiped=!0,Pe())}function Ne(){m("onend"),u.end()}var Me=Z(S);u.on("drain",Me);var We=!1;function Pe(){m("cleanup"),u.removeListener("close",He),u.removeListener("finish",de),u.removeListener("drain",Me),u.removeListener("error",ke),u.removeListener("unpipe",J),S.removeListener("end",Ne),S.removeListener("end",Ie),S.removeListener("data",he),We=!0,F.awaitDrain&&(!u._writableState||u._writableState.needDrain)&&Me()}S.on("data",he);function he(o){m("ondata");var n=u.write(o);m("dest.write",n),n===!1&&((F.pipesCount===1&&F.pipes===u||F.pipesCount>1&&$(F.pipes,u)!==-1)&&!We&&(m("false write response, pause",F.awaitDrain),F.awaitDrain++),S.pause())}function ke(o){m("onerror",o),Ie(),u.removeListener("error",ke),e(u,"error")===0&&N(u,o)}q(u,"error",ke);function He(){u.removeListener("finish",de),Ie()}u.once("close",He);function de(){m("onfinish"),u.removeListener("close",He),Ie()}u.once("finish",de);function Ie(){m("unpipe"),S.unpipe(u)}return u.emit("pipe",S),F.flowing||(m("pipe resume"),S.resume()),u};function Z(u){return function(){var S=u._readableState;m("pipeOnDrain",S.awaitDrain),S.awaitDrain&&S.awaitDrain--,S.awaitDrain===0&&e(u,"data")&&(S.flowing=!0,E(u))}}P.prototype.unpipe=function(u){var h=this._readableState,S={hasUnpiped:!1};if(h.pipesCount===0)return this;if(h.pipesCount===1)return u&&u!==h.pipes?this:(u||(u=h.pipes),h.pipes=null,h.pipesCount=0,h.flowing=!1,u&&u.emit("unpipe",this,S),this);if(!u){var F=h.pipes,ee=h.pipesCount;h.pipes=null,h.pipesCount=0,h.flowing=!1;for(var W=0;W<ee;W++)F[W].emit("unpipe",this,{hasUnpiped:!1});return this}var J=$(h.pipes,u);return J===-1?this:(h.pipes.splice(J,1),h.pipesCount-=1,h.pipesCount===1&&(h.pipes=h.pipes[0]),u.emit("unpipe",this,S),this)},P.prototype.on=function(u,h){var S=t.prototype.on.call(this,u,h),F=this._readableState;return u==="data"?(F.readableListening=this.listenerCount("readable")>0,F.flowing!==!1&&this.resume()):u==="readable"&&!F.endEmitted&&!F.readableListening&&(F.readableListening=F.needReadable=!0,F.flowing=!1,F.emittedReadable=!1,m("on readable",F.length,F.reading),F.length?se(this):F.reading||process.nextTick(Ve,this)),S},P.prototype.addListener=P.prototype.on,P.prototype.removeListener=function(u,h){var S=t.prototype.removeListener.call(this,u,h);return u==="readable"&&process.nextTick(ce,this),S},P.prototype.removeAllListeners=function(u){var h=t.prototype.removeAllListeners.apply(this,arguments);return(u==="readable"||u===void 0)&&process.nextTick(ce,this),h};function ce(u){var h=u._readableState;h.readableListening=u.listenerCount("readable")>0,h.resumeScheduled&&!h.paused?h.flowing=!0:u.listenerCount("data")>0&&u.resume()}function Ve(u){m("readable nexttick read 0"),u.read(0)}P.prototype.resume=function(){var u=this._readableState;return u.flowing||(m("resume"),u.flowing=!u.readableListening,Le(this,u)),u.paused=!1,this};function Le(u,h){h.resumeScheduled||(h.resumeScheduled=!0,process.nextTick(De,u,h))}function De(u,h){m("resume",h.reading),h.reading||u.read(0),h.resumeScheduled=!1,u.emit("resume"),E(u),h.flowing&&!h.reading&&u.read(0)}P.prototype.pause=function(){return m("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(m("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function E(u){var h=u._readableState;for(m("flow",h.flowing);h.flowing&&u.read()!==null;);}P.prototype.wrap=function(u){var h=this,S=this._readableState,F=!1;u.on("end",function(){if(m("wrapped end"),S.decoder&&!S.ended){var J=S.decoder.end();J&&J.length&&h.push(J)}h.push(null)}),u.on("data",function(J){if(m("wrapped data"),S.decoder&&(J=S.decoder.write(J)),!(S.objectMode&&J==null)&&!(!S.objectMode&&(!J||!J.length))){var Ne=h.push(J);Ne||(F=!0,u.pause())}});for(var ee in u)this[ee]===void 0&&typeof u[ee]=="function"&&(this[ee]=function(Ne){return function(){return u[Ne].apply(u,arguments)}}(ee));for(var W=0;W<L.length;W++)u.on(L[W],this.emit.bind(this,L[W]));return this._read=function(J){m("wrapped _read",J),F&&(F=!1,u.resume())},this},typeof Symbol=="function"&&(P.prototype[Symbol.asyncIterator]=function(){return x===void 0&&(x=fi()),x(this)}),Object.defineProperty(P.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(P.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(P.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(h){this._readableState&&(this._readableState.flowing=h)}}),P._fromList=V,Object.defineProperty(P.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function V(u,h){if(h.length===0)return null;var S;return h.objectMode?S=h.buffer.shift():!u||u>=h.length?(h.decoder?S=h.buffer.join(""):h.buffer.length===1?S=h.buffer.first():S=h.buffer.concat(h.length),h.buffer.clear()):S=h.buffer.consume(u,h.decoder),S}function B(u){var h=u._readableState;m("endReadable",h.endEmitted),h.endEmitted||(h.ended=!0,process.nextTick(U,h,u))}function U(u,h){if(m("endReadableNT",u.endEmitted,u.length),!u.endEmitted&&u.length===0&&(u.endEmitted=!0,h.readable=!1,h.emit("end"),u.autoDestroy)){var S=h._writableState;(!S||S.autoDestroy&&S.finished)&&h.destroy()}}typeof Symbol=="function"&&(P.from=function(u,h){return C===void 0&&(C=di()),C(P,u,h)});function $(u,h){for(var S=0,F=u.length;S<F;S++)if(u[S]===h)return S;return-1}return At}var Hr=Ce,at=Fe.codes,pi=at.ERR_METHOD_NOT_IMPLEMENTED,gi=at.ERR_MULTIPLE_CALLBACK,yi=at.ERR_TRANSFORM_ALREADY_TRANSFORMING,mi=at.ERR_TRANSFORM_WITH_LENGTH_0,lt=Ue();Ge(Ce,lt);function _i(r,e){var t=this._transformState;t.transforming=!1;var i=t.writecb;if(i===null)return this.emit("error",new gi);t.writechunk=null,t.writecb=null,e!=null&&this.push(e),i(r);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function Ce(r){if(!(this instanceof Ce))return new Ce(r);lt.call(this,r),this._transformState={afterTransform:_i.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.on("prefinish",Vi)}function Vi(){var r=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,t){Er(r,e,t)}):Er(this,null,null)}Ce.prototype.push=function(r,e){return this._transformState.needTransform=!1,lt.prototype.push.call(this,r,e)};Ce.prototype._transform=function(r,e,t){t(new pi("_transform()"))};Ce.prototype._write=function(r,e,t){var i=this._transformState;if(i.writecb=t,i.writechunk=r,i.writeencoding=e,!i.transforming){var a=this._readableState;(i.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}};Ce.prototype._read=function(r){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Ce.prototype._destroy=function(r,e){lt.prototype._destroy.call(this,r,function(t){e(t)})};function Er(r,e,t){if(e)return r.emit("error",e);if(t!=null&&r.push(t),r._writableState.length)throw new mi;if(r._transformState.transforming)throw new yi;return r.push(null)}var wi=Ke,Yr=Hr;Ge(Ke,Yr);function Ke(r){if(!(this instanceof Ke))return new Ke(r);Yr.call(this,r)}Ke.prototype._transform=function(r,e,t){t(null,r)};var vt;function bi(r){var e=!1;return function(){e||(e=!0,r.apply(void 0,arguments))}}var zr=Fe.codes,Ei=zr.ERR_MISSING_ARGS,Ai=zr.ERR_STREAM_DESTROYED;function Ar(r){if(r)throw r}function vi(r){return r.setHeader&&typeof r.abort=="function"}function Ri(r,e,t,i){i=bi(i);var a=!1;r.on("close",function(){a=!0}),vt===void 0&&(vt=Yt),vt(r,{readable:e,writable:t},function(d){if(d)return i(d);a=!0,i()});var f=!1;return function(d){if(!a&&!f){if(f=!0,vi(r))return r.abort();if(typeof r.destroy=="function")return r.destroy();i(d||new Ai("pipe"))}}}function vr(r){r()}function xi(r,e){return r.pipe(e)}function Ci(r){return!r.length||typeof r[r.length-1]!="function"?Ar:r.pop()}function Si(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];var i=Ci(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new Ei("streams");var a,f=e.map(function(d,c){var m=c<e.length-1,_=c>0;return Ri(d,m,_,function(p){a||(a=p),p&&f.forEach(vr),!m&&(f.forEach(vr),i(a))})});return e.reduce(xi)}var Ti=Si;(function(r,e){e=r.exports=Wr(),e.Stream=e,e.Readable=e,e.Writable=qr(),e.Duplex=Ue(),e.Transform=Hr,e.PassThrough=wi,e.finished=Yt,e.pipeline=Ti})(Ft,Ft.exports);var Ni=Ft.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Rr;var Bi=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:xe):r=>(Rr||(Rr=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0));function xr(r,e){for(const t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function ki(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return xr(r,t)}catch{t.message=r.message,t.stack=r.stack;const a=function(){};return a.prototype=Object.create(Object.getPrototypeOf(r)),xr(new a,t)}}var Ii=ki;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Oi=In("simple-peer"),Kr=On,Cr=zn,Fi=Ni,Rt=Bi,z=Ii,{Buffer:Li}=qe,xt=64*1024,Di=5*1e3,Mi=5*1e3;function Sr(r){return r.replace(/a=ice-options:trickle\s\n/g,"")}function Pi(r){console.warn(r)}class Oe extends Fi.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=Cr(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Cr(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Oe.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Oe.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||Di,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Kr(),!this._wrtc)throw z(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){this.destroy(z(t,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(t=>{this.destroy(z(t,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw z(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(t=>{this.destroy(z(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(z(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(i=>{!t.address||t.address.endsWith(".local")?Pi("Ignoring unsupported ICE candidate."):this.destroy(z(i,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw z(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw z(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(i){this.destroy(z(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw z(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw z(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(e)||new Map;let a=i.get(t);if(!a)a=this._pc.addTrack(e,t),i.set(t,a),this._senderMap.set(e,i),this._needsNegotiation();else throw a.removed?z(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):z(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,i){if(this.destroying)return;if(this.destroyed)throw z(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const a=this._senderMap.get(e),f=a?a.get(i):null;if(!f)throw z(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,a),f.replaceTrack!=null?f.replaceTrack(t):this.destroy(z(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw z(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(e),a=i?i.get(t):null;if(!a)throw z(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{a.removed=!0,this._pc.removeTrack(a)}catch(f){f.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(a):this.destroy(z(f,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw z(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,Rt(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw z(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),Rt(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}))}_setupData(e){if(!e.channel)return this.destroy(z(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=xt),this.channelName=this._channel.label,this._channel.onmessage=i=>{this._onChannelMessage(i)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=i=>{const a=i.error instanceof Error?i.error:new Error(`Datachannel error: ${i.message} ${i.filename}:${i.lineno}:${i.colno}`);this.destroy(z(a,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},Mi)}_read(){}_write(e,t,i){if(this.destroyed)return i(z(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(a){return this.destroy(z(a,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>xt?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=e,this._cb=i}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Sr(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const f=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:f.type,sdp:f.sdp})},i=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},a=f=>{this.destroy(z(f,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(i).catch(a)}).catch(e=>{this.destroy(z(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Sr(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const f=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:f.type,sdp:f.sdp}),this.initiator||this._requestMissingTransceivers()},i=()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},a=f=>{this.destroy(z(f,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(i).catch(a)}).catch(e=>{this.destroy(z(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(z(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(z(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(z(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=i=>(Object.prototype.toString.call(i.values)==="[object Array]"&&i.values.forEach(a=>{Object.assign(i,a)}),i);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(i=>{const a=[];i.forEach(f=>{a.push(t(f))}),e(null,a)},i=>e(i)):this._pc.getStats.length>0?this._pc.getStats(i=>{if(this.destroyed)return;const a=[];i.result().forEach(f=>{const d={};f.names().forEach(c=>{d[c]=f.stat(c)}),d.id=f.id,d.type=f.type,d.timestamp=f.timestamp,a.push(t(d))}),e(null,a)},i=>e(i)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((t,i)=>{if(this.destroyed)return;t&&(i=[]);const a={},f={},d={};let c=!1;i.forEach(_=>{(_.type==="remotecandidate"||_.type==="remote-candidate")&&(a[_.id]=_),(_.type==="localcandidate"||_.type==="local-candidate")&&(f[_.id]=_),(_.type==="candidatepair"||_.type==="candidate-pair")&&(d[_.id]=_)});const m=_=>{c=!0;let p=f[_.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof _.googLocalAddress=="string"&&(p=_.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let w=a[_.remoteCandidateId];w&&(w.ip||w.address)?(this.remoteAddress=w.ip||w.address,this.remotePort=Number(w.port)):w&&w.ipAddress?(this.remoteAddress=w.ipAddress,this.remotePort=Number(w.portNumber)):typeof _.googRemoteAddress=="string"&&(w=_.googRemoteAddress.split(":"),this.remoteAddress=w[0],this.remotePort=Number(w[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(i.forEach(_=>{_.type==="transport"&&_.selectedCandidatePairId&&m(d[_.selectedCandidatePairId]),(_.type==="googCandidatePair"&&_.googActiveConnection==="true"||(_.type==="candidatepair"||_.type==="candidate-pair")&&_.selected)&&m(_)}),!c&&(!Object.keys(d).length||Object.keys(f).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.destroy(z(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const _=this._cb;this._cb=null,_(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>xt||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=Li.from(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),!this._remoteStreams.some(i=>i.id===t.id)&&(this._remoteStreams.push(t),Rt(()=>{this._debug("on stream"),this.emit("stream",t)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Oi.apply(null,e)}}Oe.WEBRTC_SUPPORT=!!Kr();Oe.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Oe.channelConfig={};var ji=Oe;const Je=dn(ji),Ee=Object.create(null);Ee.open="0";Ee.close="1";Ee.ping="2";Ee.pong="3";Ee.message="4";Ee.upgrade="5";Ee.noop="6";const et=Object.create(null);Object.keys(Ee).forEach(r=>{et[Ee[r]]=r});const Mt={type:"error",data:"parser error"},Gr=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Jr=typeof ArrayBuffer=="function",Xr=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,zt=({type:r,data:e},t,i)=>Gr&&e instanceof Blob?t?i(e):Tr(e,i):Jr&&(e instanceof ArrayBuffer||Xr(e))?t?i(e):Tr(new Blob([e]),i):i(Ee[r]+(e||"")),Tr=(r,e)=>{const t=new FileReader;return t.onload=function(){const i=t.result.split(",")[1];e("b"+(i||""))},t.readAsDataURL(r)};function Nr(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let Ct;function Ui(r,e){if(Gr&&r.data instanceof Blob)return r.data.arrayBuffer().then(Nr).then(e);if(Jr&&(r.data instanceof ArrayBuffer||Xr(r.data)))return e(Nr(r.data));zt(r,!1,t=>{Ct||(Ct=new TextEncoder),e(Ct.encode(t))})}const Br="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ze=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<Br.length;r++)ze[Br.charCodeAt(r)]=r;const qi=r=>{let e=r.length*.75,t=r.length,i,a=0,f,d,c,m;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const _=new ArrayBuffer(e),p=new Uint8Array(_);for(i=0;i<t;i+=4)f=ze[r.charCodeAt(i)],d=ze[r.charCodeAt(i+1)],c=ze[r.charCodeAt(i+2)],m=ze[r.charCodeAt(i+3)],p[a++]=f<<2|d>>4,p[a++]=(d&15)<<4|c>>2,p[a++]=(c&3)<<6|m&63;return _},$i=typeof ArrayBuffer=="function",Kt=(r,e)=>{if(typeof r!="string")return{type:"message",data:Qr(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Wi(r.substring(1),e)}:et[t]?r.length>1?{type:et[t],data:r.substring(1)}:{type:et[t]}:Mt},Wi=(r,e)=>{if($i){const t=qi(r);return Qr(t,e)}else return{base64:!0,data:r}},Qr=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Zr="",Hi=(r,e)=>{const t=r.length,i=new Array(t);let a=0;r.forEach((f,d)=>{zt(f,!1,c=>{i[d]=c,++a===t&&e(i.join(Zr))})})},Yi=(r,e)=>{const t=r.split(Zr),i=[];for(let a=0;a<t.length;a++){const f=Kt(t[a],e);if(i.push(f),f.type==="error")break}return i};function zi(){return new TransformStream({transform(r,e){Ui(r,t=>{const i=t.length;let a;if(i<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,i);else if(i<65536){a=new Uint8Array(3);const f=new DataView(a.buffer);f.setUint8(0,126),f.setUint16(1,i)}else{a=new Uint8Array(9);const f=new DataView(a.buffer);f.setUint8(0,127),f.setBigUint64(1,BigInt(i))}r.data&&typeof r.data!="string"&&(a[0]|=128),e.enqueue(a),e.enqueue(t)})}})}let St;function Xe(r){return r.reduce((e,t)=>e+t.length,0)}function Qe(r,e){if(r[0].length===e)return r.shift();const t=new Uint8Array(e);let i=0;for(let a=0;a<e;a++)t[a]=r[0][i++],i===r[0].length&&(r.shift(),i=0);return r.length&&i<r[0].length&&(r[0]=r[0].slice(i)),t}function Ki(r,e){St||(St=new TextDecoder);const t=[];let i=0,a=-1,f=!1;return new TransformStream({transform(d,c){for(t.push(d);;){if(i===0){if(Xe(t)<1)break;const m=Qe(t,1);f=(m[0]&128)===128,a=m[0]&127,a<126?i=3:a===126?i=1:i=2}else if(i===1){if(Xe(t)<2)break;const m=Qe(t,2);a=new DataView(m.buffer,m.byteOffset,m.length).getUint16(0),i=3}else if(i===2){if(Xe(t)<8)break;const m=Qe(t,8),_=new DataView(m.buffer,m.byteOffset,m.length),p=_.getUint32(0);if(p>Math.pow(2,21)-1){c.enqueue(Mt);break}a=p*Math.pow(2,32)+_.getUint32(4),i=3}else{if(Xe(t)<a)break;const m=Qe(t,a);c.enqueue(Kt(f?m:St.decode(m),e)),i=0}if(a===0||a>r){c.enqueue(Mt);break}}}})}const en=4;function oe(r){if(r)return Gi(r)}function Gi(r){for(var e in oe.prototype)r[e]=oe.prototype[e];return r}oe.prototype.on=oe.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};oe.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};oe.prototype.off=oe.prototype.removeListener=oe.prototype.removeAllListeners=oe.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var i,a=0;a<t.length;a++)if(i=t[a],i===e||i.fn===e){t.splice(a,1);break}return t.length===0&&delete this._callbacks["$"+r],this};oe.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t){t=t.slice(0);for(var i=0,a=t.length;i<a;++i)t[i].apply(this,e)}return this};oe.prototype.emitReserved=oe.prototype.emit;oe.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};oe.prototype.hasListeners=function(r){return!!this.listeners(r).length};const ct=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),ge=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Ji="arraybuffer";function tn(r,...e){return e.reduce((t,i)=>(r.hasOwnProperty(i)&&(t[i]=r[i]),t),{})}const Xi=ge.setTimeout,Qi=ge.clearTimeout;function ut(r,e){e.useNativeTimers?(r.setTimeoutFn=Xi.bind(ge),r.clearTimeoutFn=Qi.bind(ge)):(r.setTimeoutFn=ge.setTimeout.bind(ge),r.clearTimeoutFn=ge.clearTimeout.bind(ge))}const Zi=1.33;function es(r){return typeof r=="string"?ts(r):Math.ceil((r.byteLength||r.size)*Zi)}function ts(r){let e=0,t=0;for(let i=0,a=r.length;i<a;i++)e=r.charCodeAt(i),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(i++,t+=4);return t}function rn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function rs(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function ns(r){let e={},t=r.split("&");for(let i=0,a=t.length;i<a;i++){let f=t[i].split("=");e[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return e}class is extends Error{constructor(e,t,i){super(e),this.description=t,this.context=i,this.type="TransportError"}}class Gt extends oe{constructor(e){super(),this.writable=!1,ut(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,i){return super.emitReserved("error",new is(e,t,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Kt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=rs(e);return t.length?"?"+t:""}}class ss extends Gt{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||t()})),this.writable||(i++,this.once("drain",function(){--i||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};Yi(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Hi(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=rn()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let nn=!1;try{nn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const os=nn;function as(){}class ls extends ss{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let i=location.port;i||(i=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,t){const i=this.request({method:"POST",data:e});i.on("success",t),i.on("error",(a,f)=>{this.onError("xhr post error",a,f)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,i)=>{this.onError("xhr poll error",t,i)}),this.pollXhr=e}}class be extends oe{constructor(e,t,i){super(),this.createRequest=e,ut(this,i),this._opts=i,this._method=i.method||"GET",this._uri=t,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;const t=tn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(t);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let a in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(a)&&i.setRequestHeader(a,this._opts.extraHeaders[a])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var a;i.readyState===3&&((a=this._opts.cookieJar)===null||a===void 0||a.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(a){this.setTimeoutFn(()=>{this._onError(a)},0);return}typeof document<"u"&&(this._index=be.requestsCount++,be.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=as,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete be.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}be.requestsCount=0;be.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",kr);else if(typeof addEventListener=="function"){const r="onpagehide"in ge?"pagehide":"unload";addEventListener(r,kr,!1)}}function kr(){for(let r in be.requests)be.requests.hasOwnProperty(r)&&be.requests[r].abort()}const cs=function(){const r=sn({xdomain:!1});return r&&r.responseType!==null}();class us extends ls{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=cs&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new be(sn,this.uri(),e)}}function sn(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||os))return new XMLHttpRequest}catch{}if(!e)try{return new ge[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const on=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class hs extends Gt{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,i=on?{}:tn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,i)}catch(a){return this.emitReserved("error",a)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const i=e[t],a=t===e.length-1;zt(i,this.supportsBinary,f=>{try{this.doWrite(i,f)}catch{}a&&ct(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=rn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Tt=ge.WebSocket||ge.MozWebSocket;class fs extends hs{createSocket(e,t,i){return on?new Tt(e,t,i):t?new Tt(e,t):new Tt(e)}doWrite(e,t){this.ws.send(t)}}class ds extends Gt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=Ki(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=e.readable.pipeThrough(t).getReader(),a=zi();a.readable.pipeTo(e.writable),this._writer=a.writable.getWriter();const f=()=>{i.read().then(({done:c,value:m})=>{c||(this.onPacket(m),f())}).catch(c=>{})};f();const d={type:"open"};this.query.sid&&(d.data=`{"sid":"${this.query.sid}"}`),this._writer.write(d).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const i=e[t],a=t===e.length-1;this._writer.write(i).then(()=>{a&&ct(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const ps={websocket:fs,webtransport:ds,polling:us},gs=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ys=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Pt(r){if(r.length>8e3)throw"URI too long";const e=r,t=r.indexOf("["),i=r.indexOf("]");t!=-1&&i!=-1&&(r=r.substring(0,t)+r.substring(t,i).replace(/:/g,";")+r.substring(i,r.length));let a=gs.exec(r||""),f={},d=14;for(;d--;)f[ys[d]]=a[d]||"";return t!=-1&&i!=-1&&(f.source=e,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=!0),f.pathNames=ms(f,f.path),f.queryKey=_s(f,f.query),f}function ms(r,e){const t=/\/{2,9}/g,i=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&i.splice(0,1),e.slice(-1)=="/"&&i.splice(i.length-1,1),i}function _s(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,a,f){a&&(t[a]=f)}),t}const jt=typeof addEventListener=="function"&&typeof removeEventListener=="function",tt=[];jt&&addEventListener("offline",()=>{tt.forEach(r=>r())},!1);class Be extends oe{constructor(e,t){if(super(),this.binaryType=Ji,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const i=Pt(e);t.hostname=i.host,t.secure=i.protocol==="https"||i.protocol==="wss",t.port=i.port,i.query&&(t.query=i.query)}else t.host&&(t.hostname=Pt(t.host).host);ut(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(i=>{const a=i.prototype.name;this.transports.push(a),this._transportsByName[a]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=ns(this.opts.query)),jt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},tt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=en,t.transport=e,this.id&&(t.sid=this.id);const i=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Be.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Be.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let i=0;i<this.writeBuffer.length;i++){const a=this.writeBuffer[i].data;if(a&&(t+=es(a)),i>0&&t>this._maxPayload)return this.writeBuffer.slice(0,i);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,ct(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,i){return this._sendPacket("message",e,t,i),this}send(e,t,i){return this._sendPacket("message",e,t,i),this}_sendPacket(e,t,i,a){if(typeof t=="function"&&(a=t,t=void 0),typeof i=="function"&&(a=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const f={type:e,data:t,options:i};this.emitReserved("packetCreate",f),this.writeBuffer.push(f),a&&this.once("flush",a),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},i=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(Be.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),jt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=tt.indexOf(this._offlineEventListener);i!==-1&&tt.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Be.protocol=en;class Vs extends Be{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),i=!1;Be.priorWebsocketSuccess=!1;const a=()=>{i||(t.send([{type:"ping",data:"probe"}]),t.once("packet",w=>{if(!i)if(w.type==="pong"&&w.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Be.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(p(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const I=new Error("probe error");I.transport=t.name,this.emitReserved("upgradeError",I)}}))};function f(){i||(i=!0,p(),t.close(),t=null)}const d=w=>{const I=new Error("probe error: "+w);I.transport=t.name,f(),this.emitReserved("upgradeError",I)};function c(){d("transport closed")}function m(){d("socket closed")}function _(w){t&&w.name!==t.name&&f()}const p=()=>{t.removeListener("open",a),t.removeListener("error",d),t.removeListener("close",c),this.off("close",m),this.off("upgrading",_)};t.once("open",a),t.once("error",d),t.once("close",c),this.once("close",m),this.once("upgrading",_),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{i||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&t.push(e[i]);return t}}let ws=class extends Vs{constructor(e,t={}){const i=typeof e=="object"?e:t;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(a=>ps[a]).filter(a=>!!a)),super(e,i)}};function bs(r,e="",t){let i=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),i=Pt(r)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const f=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+f+":"+i.port+e,i.href=i.protocol+"://"+f+(t&&t.port===i.port?"":":"+i.port),i}const Es=typeof ArrayBuffer=="function",As=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,an=Object.prototype.toString,vs=typeof Blob=="function"||typeof Blob<"u"&&an.call(Blob)==="[object BlobConstructor]",Rs=typeof File=="function"||typeof File<"u"&&an.call(File)==="[object FileConstructor]";function Jt(r){return Es&&(r instanceof ArrayBuffer||As(r))||vs&&r instanceof Blob||Rs&&r instanceof File}function rt(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,i=r.length;t<i;t++)if(rt(r[t]))return!0;return!1}if(Jt(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return rt(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&rt(r[t]))return!0;return!1}function xs(r){const e=[],t=r.data,i=r;return i.data=Ut(t,e),i.attachments=e.length,{packet:i,buffers:e}}function Ut(r,e){if(!r)return r;if(Jt(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let i=0;i<r.length;i++)t[i]=Ut(r[i],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=Ut(r[i],e));return t}return r}function Cs(r,e){return r.data=qt(r.data,e),delete r.attachments,r}function qt(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=qt(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=qt(r[t],e));return r}const Ss=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ts=5;var K;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(K||(K={}));class Ns{constructor(e){this.replacer=e}encode(e){return(e.type===K.EVENT||e.type===K.ACK)&&rt(e)?this.encodeAsBinary({type:e.type===K.EVENT?K.BINARY_EVENT:K.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===K.BINARY_EVENT||e.type===K.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=xs(e),i=this.encodeAsString(t.packet),a=t.buffers;return a.unshift(i),a}}function Ir(r){return Object.prototype.toString.call(r)==="[object Object]"}class Xt extends oe{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const i=t.type===K.BINARY_EVENT;i||t.type===K.BINARY_ACK?(t.type=i?K.EVENT:K.ACK,this.reconstructor=new Bs(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Jt(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const i={type:Number(e.charAt(0))};if(K[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===K.BINARY_EVENT||i.type===K.BINARY_ACK){const f=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const d=e.substring(f,t);if(d!=Number(d)||e.charAt(t)!=="-")throw new Error("Illegal attachments");i.attachments=Number(d)}if(e.charAt(t+1)==="/"){const f=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););i.nsp=e.substring(f,t)}else i.nsp="/";const a=e.charAt(t+1);if(a!==""&&Number(a)==a){const f=t+1;for(;++t;){const d=e.charAt(t);if(d==null||Number(d)!=d){--t;break}if(t===e.length)break}i.id=Number(e.substring(f,t+1))}if(e.charAt(++t)){const f=this.tryParse(e.substr(t));if(Xt.isPayloadValid(i.type,f))i.data=f;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case K.CONNECT:return Ir(t);case K.DISCONNECT:return t===void 0;case K.CONNECT_ERROR:return typeof t=="string"||Ir(t);case K.EVENT:case K.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Ss.indexOf(t[0])===-1);case K.ACK:case K.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Bs{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Cs(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ks=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Xt,Encoder:Ns,get PacketType(){return K},protocol:Ts},Symbol.toStringTag,{value:"Module"}));function me(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const Is=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ln extends oe{constructor(e,t,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[me(e,"open",this.onopen.bind(this)),me(e,"packet",this.onpacket.bind(this)),me(e,"error",this.onerror.bind(this)),me(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var i,a,f;if(Is.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const d={type:K.EVENT,data:t};if(d.options={},d.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const p=this.ids++,w=t.pop();this._registerAckCallback(p,w),d.id=p}const c=(a=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||a===void 0?void 0:a.writable,m=this.connected&&!(!((f=this.io.engine)===null||f===void 0)&&f._hasPingExpired());return this.flags.volatile&&!c||(m?(this.notifyOutgoingListeners(d),this.packet(d)):this.sendBuffer.push(d)),this.flags={},this}_registerAckCallback(e,t){var i;const a=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(a===void 0){this.acks[e]=t;return}const f=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===e&&this.sendBuffer.splice(c,1);t.call(this,new Error("operation has timed out"))},a),d=(...c)=>{this.io.clearTimeoutFn(f),t.apply(this,c)};d.withError=!0,this.acks[e]=d}emitWithAck(e,...t){return new Promise((i,a)=>{const f=(d,c)=>d?a(d):i(c);f.withError=!0,t.push(f),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((a,...f)=>i!==this._queue[0]?void 0:(a!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(a)):(this._queue.shift(),t&&t(null,...f)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:K.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(i=>String(i.id)===e)){const i=this.acks[e];delete this.acks[e],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case K.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case K.EVENT:case K.BINARY_EVENT:this.onevent(e);break;case K.ACK:case K.BINARY_ACK:this.onack(e);break;case K.DISCONNECT:this.ondisconnect();break;case K.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const i of t)i.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let i=!1;return function(...a){i||(i=!0,t.packet({type:K.ACK,id:e,data:a}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:K.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const i of t)i.apply(this,e.data)}}}function $e(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}$e.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};$e.prototype.reset=function(){this.attempts=0};$e.prototype.setMin=function(r){this.ms=r};$e.prototype.setMax=function(r){this.max=r};$e.prototype.setJitter=function(r){this.jitter=r};class $t extends oe{constructor(e,t){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,ut(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((i=t.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new $e({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const a=t.parser||ks;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ws(this.uri,this.opts);const t=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const a=me(t,"open",function(){i.onopen(),e&&e()}),f=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},d=me(t,"error",f);if(this._timeout!==!1){const c=this._timeout,m=this.setTimeoutFn(()=>{a(),f(new Error("timeout")),t.close()},c);this.opts.autoUnref&&m.unref(),this.subs.push(()=>{this.clearTimeoutFn(m)})}return this.subs.push(a),this.subs.push(d),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(me(e,"ping",this.onping.bind(this)),me(e,"data",this.ondata.bind(this)),me(e,"error",this.onerror.bind(this)),me(e,"close",this.onclose.bind(this)),me(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){ct(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new ln(this,e,t),this.nsps[e]=i),i}_destroy(e){const t=Object.keys(this.nsps);for(const i of t)if(this.nsps[i].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let i=0;i<t.length;i++)this.engine.write(t[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(a=>{a?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",a)):e.onreconnect()}))},t);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ye={};function nt(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=bs(r,e.path||"/socket.io"),i=t.source,a=t.id,f=t.path,d=Ye[a]&&f in Ye[a].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||d;let m;return c?m=new $t(i,e):(Ye[a]||(Ye[a]=new $t(i,e)),m=Ye[a]),t.query&&!e.query&&(e.query=t.queryKey),m.socket(t.path,e)}Object.assign(nt,{Manager:$t,Socket:ln,io:nt,connect:nt});const Or={isInCall:!1,isCallInitiator:!1,isVideo:!1,callWith:null},cn=X.createContext(null),Qt=()=>{const r=X.useContext(cn);if(!r)throw new Error("useVideoCall must be used within a VideoCallProvider");return r},Nt=!1,Os=r=>({log:(e,...t)=>console.log(`[${r}] ${e}`,...t),error:(e,...t)=>console.error(`[${r}] ${e}`,...t),warn:(e,...t)=>console.warn(`[${r}] ${e}`,...t),info:(e,...t)=>console.info(`[${r}] ${e}`,...t)}),G=Os("VideoCall"),Fs=({children:r})=>{const[e,t]=X.useState(Or),[i,a]=X.useState(null),[f,d]=X.useState(null),[c,m]=X.useState(null),_=X.useRef(null),p=X.useRef(null),w=X.useRef(!1),I=X.useRef(0),O=(()=>{try{const x=localStorage.getItem("user");return x?JSON.parse(x):null}catch(x){return console.error("Erreur lors de la rcupration de l'utilisateur:",x),null}})();X.useEffect(()=>{const x="https://riziky-boutic-server.onrender.com";G.log("Connecting to socket server:",x);try{p.current=nt(x,{reconnectionAttempts:5,reconnectionDelay:1e3,timeout:2e4,transports:["websocket","polling"],auth:{token:(O==null?void 0:O.token)||""}}),p.current.on("connect_error",C=>{G.error("Socket connection error:",C),I.current+=1,!w.current&&I.current<3&&(Y.error("Erreur de connexion au serveur de chat"),w.current=!0)}),p.current.on("connect",()=>{G.log("Socket connected successfully"),w.current=!1,I.current=0,O&&O.id&&(p.current.emit("authenticate",O),G.log("User authenticated with socket:",O.id))}),p.current.on("callIncoming",C=>{G.log("Incoming call from:",C),m(C)}),p.current.on("callAccepted",async C=>{if(G.log("Call accepted, received signal"),_.current&&C)try{_.current.signal(C)}catch(N){G.error("Error signaling peer after call accepted:",N),v()}else G.error("Cannot process call acceptance: peer or signal is missing"),v()}),p.current.on("callRejected",()=>{Y.error("L'appel a t refus"),v()}),p.current.on("callEnded",()=>{Y.info("L'appel a pris fin"),v()}),p.current.on("peerSignal",C=>{if(G.log("Received peer signal:",C),_.current&&C)try{_.current.signal(C)}catch(N){G.error("Error processing peer signal:",N)}else G.error("Cannot process peer signal: peer or signal is missing")}),p.current.on("sendSignalRequest",C=>{G.log("Received signal request from:",C.to),_.current&&_.current._localSignal?p.current.emit("sendSignalResponse",{to:C.to,signal:_.current._localSignal}):G.error("Cannot respond to signal request: local signal is missing")}),p.current.on("callFailed",C=>{C.reason==="user-offline"?Y.error("L'utilisateur n'est pas en ligne"):Y.error("L'appel a chou"),v()})}catch(C){G.error("Failed to initialize socket connection:",C),w.current||(Y.error("Impossible de se connecter au serveur de chat"),w.current=!0)}return()=>{p.current&&p.current.disconnect(),v()}},[]);const T=async(x,C)=>{try{if(G.log(`Initiating ${C?"video":"audio"} call to user ${x}`),!x)throw new Error("ID utilisateur invalide");if(!p.current||!p.current.connected){Y.error("Non connect au serveur. Veuillez rafrachir la page et ressayer.");return}const N={video:C?{width:640,height:480}:!1,audio:!0};let L;try{L=await navigator.mediaDevices.getUserMedia(N),a(L)}catch(q){G.error("Error getting user media:",q);let M="Erreur d'accs  la camra ou au microphone";q.name==="NotAllowedError"?M="Permissions refuses pour la camra ou le microphone":q.name==="NotFoundError"?M="Aucun priphrique audio/vido dtect":q.name==="NotReadableError"&&(M="Priphrique audio/vido dj utilis par une autre application"),Y.error(M);return}try{if(typeof Je!="function")throw new Error("La bibliothque simple-peer n'est pas correctement initialise");const q={initiator:!0,trickle:!1,stream:L,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"}]}},M=new Je(q);M.on("signal",P=>{G.log("Generated signal for peer, sending to remote user"),M._localSignal=P,p.current&&p.current.connected?p.current.emit("callUser",{userToCall:x,signal:P,isVideo:C}):(Y.error("Serveur de chat non connect"),v())}),M.on("stream",P=>{G.log("Received remote stream"),d(P)}),M.on("error",P=>{G.error("Peer connection error:",P),v(),Y.error("Erreur de connexion")}),M.on("close",()=>{G.log("Peer connection closed"),v()}),_.current=M,t({isInCall:!0,isCallInitiator:!0,isVideo:C,callWith:x}),Y.success("Appel en cours...")}catch(q){G.error("Error creating peer connection:",q),L.getTracks().forEach(M=>M.stop()),a(null),Y.error("Erreur de connexion peer-to-peer")}}catch(N){G.error("Failed to initiate call:",N),N.name==="NotAllowedError"?Y.error("Accs au microphone ou  la camra refus. Veuillez vrifier les permissions de votre navigateur."):N.name==="NotFoundError"?Y.error("Microphone ou camra introuvable. Veuillez vrifier que votre matriel est connect."):Y.error("Impossible de dmarrer l'appel. "+N.message)}},k=async()=>{if(!c){Y.error("Aucun appel  accepter");return}try{if(G.log(`Accepting ${c.isVideo?"video":"audio"} call from ${c.from}`),!p.current||!p.current.connected){Y.error("Non connect au serveur. Veuillez rafrachir la page et ressayer."),m(null);return}const x={video:c.isVideo?{width:640,height:480}:!1,audio:!0};let C;try{C=await navigator.mediaDevices.getUserMedia(x),a(C)}catch(N){G.error("Error getting user media:",N);let L="Erreur d'accs  la camra ou au microphone";N.name==="NotAllowedError"?L="Permissions refuses pour la camra ou le microphone":N.name==="NotFoundError"&&(L="Aucun priphrique audio/vido dtect"),Y.error(L),m(null);return}try{if(typeof Je!="function")throw new Error("La bibliothque simple-peer n'est pas correctement initialise");const N={initiator:!1,trickle:!1,stream:C,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"}]}},L=new Je(N);if(L.on("signal",q=>{G.log("Generated accept signal, sending to caller"),L._localSignal=q,p.current&&p.current.connected&&c?p.current.emit("acceptCall",{to:c.from,signal:q}):(Y.error("Serveur de chat non connect"),v())}),L.on("stream",q=>{G.log("Received remote stream from caller"),d(q)}),L.on("error",q=>{G.error("Peer connection error:",q),v(),Y.error("Erreur de connexion")}),L.on("close",()=>{G.log("Peer connection closed"),v()}),_.current=L,c.signal)L.signal(c.signal);else if(p.current&&p.current.connected)p.current.emit("getCallerSignal",{from:c.from});else throw new Error("Socket not connected");t({isInCall:!0,isCallInitiator:!1,isVideo:c.isVideo,callWith:c.from}),m(null),Y.success("Appel en cours...")}catch(N){G.error("Error creating peer connection:",N),C.getTracks().forEach(L=>L.stop()),a(null),m(null),Y.error("Erreur de connexion peer-to-peer")}}catch(x){G.error("Failed to accept call:",x),x.name==="NotAllowedError"?Y.error("Accs au microphone ou  la camra refus. Veuillez vrifier les permissions de votre navigateur."):x.name==="NotFoundError"?Y.error("Microphone ou camra introuvable. Veuillez vrifier que votre matriel est connect."):x.message==="Permissions required"?Y.error("Permissions de microphone ou camra requises pour rpondre  l'appel."):x.message==="Socket not connected"?Y.error("La connexion au serveur est perdue. Impossible de rpondre  l'appel."):Y.error("Impossible de rpondre  l'appel. "+x.message),m(null)}},y=()=>{G.log("Rejecting call"),c&&p.current&&p.current.connected&&p.current.emit("rejectCall",{to:c.from}),m(null)},v=()=>{if(G.log("Ending call"),e.isInCall&&e.callWith&&p.current&&p.current.connected&&p.current.emit("endCall",{to:e.callWith}),_.current){try{_.current.destroy()}catch(x){G.error("Error destroying peer:",x)}_.current=null}if(i)try{i.getTracks().forEach(x=>{x.stop()})}catch(x){G.error("Error stopping local tracks:",x)}a(null),d(null),t(Or)};return A.jsx(cn.Provider,{value:{callState:e,localStream:i,remoteStream:f,incomingCall:c,initiateCall:T,acceptCall:k,rejectCall:y,endCall:v},children:r})},Ls=(r=[200,100,200])=>navigator.vibrate?(navigator.vibrate(r),!0):!1,Ds=()=>{const{incomingCall:r,acceptCall:e,rejectCall:t}=Qt(),i=X.useRef(null),[a,f]=X.useState(!1);X.useEffect(()=>{i.current&&(i.current.pause(),i.current=null);try{const m="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCYXNlNjQgZW5jb2RlZCBhdWRpbyBmb3IgcmluZ3RvbmUAAFRDT04AAAAHAAADaVR1bmVzAE1UQ09NAAAAGwAAA2VuY29kZXIAUHJvIFRvb2xzIDEwLjYuNgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxAADwAABpAAAACAAADSAAAAETEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",_=new Audio(m);_.loop=!0,_.preload="auto",_.addEventListener("play",()=>{console.log("Ringtone started playing"),f(!0)}),_.addEventListener("pause",()=>{console.log("Ringtone paused"),f(!1)}),_.addEventListener("error",p=>{d()}),_.load(),i.current=_}catch(m){console.error("Could not create audio element:",m),d()}return()=>{i.current&&(i.current.pause(),i.current.src="",i.current=null)}},[]),X.useEffect(()=>{r&&i.current?(console.log("Playing ringtone for incoming call from:",r.name),i.current.play().catch(m=>{console.error("Could not play ringtone:",m),d()})):i.current&&(i.current.pause(),i.current.currentTime=0)},[r]);const d=()=>{navigator.vibrate&&Ls(),"Notification"in window&&Notification.permission!=="denied"&&Notification.requestPermission().then(m=>{m==="granted"&&r&&new Notification("Appel entrant de "+((r==null?void 0:r.name)||"inconnu"),{icon:"/favicon.ico"})}),r&&Y.info(`Appel entrant de ${r.name}`)},c=async()=>{try{console.log("Accepting call from:",r==null?void 0:r.name),await e()}catch(m){console.error("Error accepting call:",m),Y.error("Impossible d'accepter l'appel. Vrifiez vos permissions de microphone et camra.")}};return r?A.jsxs("div",{className:"fixed top-4 right-4 bg-white shadow-lg rounded-lg p-4 border z-50 w-80 animate-in fade-in slide-in-from-top-5 duration-300",role:"alertdialog","aria-label":"Appel entrant",children:[A.jsxs("div",{className:"flex items-center mb-4",children:[A.jsx("div",{className:"w-12 h-12 bg-red-800 text-white rounded-full flex items-center justify-center mr-4",children:A.jsx(wn,{className:"h-6 w-6"})}),A.jsxs("div",{children:[A.jsx("h3",{className:"font-medium",children:r.name}),A.jsx("p",{className:"text-sm text-muted-foreground",children:r.isVideo?"Appel vido entrant":"Appel audio entrant"})]}),r.isVideo?A.jsx(Wt,{className:"ml-auto h-5 w-5"}):A.jsx(Bt,{className:"ml-auto h-5 w-5"})]}),A.jsxs("div",{className:"flex space-x-2 justify-center",children:[A.jsxs(fe,{onClick:t,className:"bg-red-600 hover:bg-red-700 text-white",size:"sm",children:[A.jsx(Fr,{className:"h-4 w-4 mr-2"}),"Refuser"]}),A.jsxs(fe,{onClick:c,className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:[A.jsx(Bt,{className:"h-4 w-4 mr-2"}),"Rpondre"]})]})]}):null},Ms=()=>{const{callState:r,localStream:e,remoteStream:t,endCall:i}=Qt(),a=X.useRef(null),f=X.useRef(null),[d,c]=X.useState(!0),[m,_]=X.useState(!0),[p,w]=X.useState(!0);X.useEffect(()=>{if(console.log("Call interface - localStream:",!!e,"remoteStream:",!!t),a.current&&e)try{a.current.srcObject=e}catch(T){console.error("Error setting local video source:",T)}if(f.current&&t)try{f.current.srcObject=t}catch(T){console.error("Error setting remote video source:",T)}},[e,t]);const I=()=>{if(e){const T=e.getAudioTracks();T.length>0&&T.forEach(k=>{k.enabled=!k.enabled,c(k.enabled)})}},j=()=>{if(e&&r.isVideo){const T=e.getVideoTracks();T.length>0&&T.forEach(k=>{k.enabled=!k.enabled,_(k.enabled)})}},O=()=>{try{i(),w(!1),Y.success("Appel termin")}catch(T){console.error("Error ending call:",T),Y.error("Erreur lors de la fermeture de l'appel"),w(!1)}};return X.useEffect(()=>()=>{try{i()}catch(T){console.error("Error during cleanup:",T)}},[i]),r.isInCall?A.jsx(Rn,{open:p,onOpenChange:T=>{T||O(),w(T)},children:A.jsxs(xn,{className:"p-0 max-w-full w-full h-full max-h-screen sm:max-w-full sm:rounded-none",onInteractOutside:T=>T.preventDefault(),children:[A.jsx(Cn,{className:"sr-only",children:"Appel en cours"}),A.jsxs(Sn,{className:"sr-only",children:["Interface d'appel ",r.isVideo?"vido":"audio"," avec contrles"]}),A.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex flex-col",children:[A.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[r.isVideo&&(t?A.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,className:"max-h-full max-w-full"}):A.jsx("div",{className:"flex items-center justify-center h-full w-full",children:A.jsx("div",{className:"w-32 h-32 bg-red-800 text-white rounded-full flex items-center justify-center",children:A.jsx("span",{className:"text-4xl font-bold",children:"?"})})})),!r.isVideo&&A.jsxs("div",{className:"flex flex-col items-center justify-center",children:[A.jsx("div",{className:"w-32 h-32 bg-red-800 text-white rounded-full flex items-center justify-center mb-4",children:A.jsx("span",{className:"text-4xl font-bold",children:"?"})}),A.jsx("h2",{className:"text-2xl text-white font-medium",children:"Appel en cours..."}),A.jsx("p",{className:"text-white opacity-75",children:"Audio uniquement"})]}),r.isVideo&&e&&A.jsx("div",{className:"absolute bottom-4 right-4 w-48 h-auto border-2 border-white rounded-lg overflow-hidden shadow-lg",children:A.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})})]}),A.jsxs("div",{className:"bg-gray-900 p-4 flex justify-center space-x-4",children:[A.jsx(fe,{onClick:I,className:d?"bg-gray-700":"bg-red-600",size:"icon",children:d?A.jsx(En,{className:"h-5 w-5"}):A.jsx(An,{className:"h-5 w-5"})}),A.jsx(fe,{onClick:O,className:"bg-red-600 hover:bg-red-700 rounded-full h-14 w-14",children:A.jsx(Fr,{className:"h-6 w-6"})}),r.isVideo&&A.jsx(fe,{onClick:j,className:m?"bg-gray-700":"bg-red-600",size:"icon",children:m?A.jsx(Wt,{className:"h-5 w-5"}):A.jsx(vn,{className:"h-5 w-5"})})]})]})]})}):null},Ps=()=>{const{user:r}=un(),[e,t]=X.useState(null),[i,a]=X.useState(""),[f,d]=X.useState(null),[c,m]=X.useState(""),_=X.useRef(null),p=hn(),{initiateCall:w,callState:I}=Qt(),{data:j=[],isLoading:O}=ht({queryKey:["admins"],queryFn:async()=>{try{return((await Re.getAdmins()).data||[]).filter(ie=>ie.id!==(r==null?void 0:r.id))}catch(D){throw console.error("Erreur lors du chargement des administrateurs:",D),D}},enabled:!!r}),{data:T,isLoading:k}=ht({queryKey:["conversation",e==null?void 0:e.id],queryFn:async()=>{if(!e)return{messages:[]};try{return(await Re.getConversation(e.id)).data||{messages:[]}}catch(D){return console.error("Erreur lors du chargement de la conversation:",D),{messages:[]}}},enabled:!!e&&!!r,refetchInterval:5e3});ht({queryKey:["adminStatus"],queryFn:async()=>{if(!j.length)return{};await Re.setOnline();const D=j.map(async ae=>{try{const le=await Re.getStatus(ae.id);return{id:ae.id,...le.data}}catch{return{id:ae.id,isOnline:!1}}}),se=(await Promise.all(D)).reduce((ae,le)=>(ae[le.id]=le,ae),{});return p.setQueryData(["admins"],ae=>(ae||[]).map(le=>{var ve,Z;return{...le,isOnline:((ve=se[le.id])==null?void 0:ve.isOnline)||!1,lastSeen:(Z=se[le.id])==null?void 0:Z.lastSeen}})),se},enabled:!!j.length&&!!r,refetchInterval:15e3});const y=ft({mutationFn:async D=>{if(!e)throw new Error("Aucun administrateur slectionn");return Re.sendMessage(e.id,D)},onSuccess:()=>{a(""),p.invalidateQueries({queryKey:["conversation",e==null?void 0:e.id]})},onError:D=>{console.error("Erreur lors de l'envoi du message:",D),Y.error("L'envoi du message a chou. Veuillez ressayer.")}}),v=ft({mutationFn:async({messageId:D,content:ie})=>{if(!e)throw new Error("Aucun administrateur slectionn");const se=C();return Re.editMessage(D,ie,se)},onSuccess:()=>{d(null),m(""),p.invalidateQueries({queryKey:["conversation",e==null?void 0:e.id]}),Y.success("Message modifi avec succs")},onError:D=>{console.error("Erreur lors de la modification du message:",D),Y.error("La modification du message a chou")}}),x=ft({mutationFn:async D=>{if(!e)throw new Error("Aucun administrateur slectionn");const ie=C();return Re.deleteMessage(D,ie)},onSuccess:()=>{p.invalidateQueries({queryKey:["conversation",e==null?void 0:e.id]}),Y.success("Message supprim")},onError:D=>{console.error("Erreur lors de la suppression du message:",D),Y.error("La suppression du message a chou")}}),C=()=>!r||!e?"":r.id<e.id?`${r.id}-${e.id}`:`${e.id}-${r.id}`;X.useEffect(()=>(r&&Re.setOnline(),()=>{r&&Re.setOffline()}),[r]),X.useEffect(()=>{_.current&&_.current.scrollIntoView({behavior:"smooth"})},[T==null?void 0:T.messages]);const N=()=>{!i.trim()||!e||y.mutate(i)},L=()=>{!c.trim()||!f||v.mutate({messageId:f,content:c})},q=D=>{d(D.id),m(D.content)},M=D=>{confirm("tes-vous sr de vouloir supprimer ce message ?")&&x.mutate(D)},P=()=>{!e||!e.isOnline||w(e.id,!1)},ue=()=>{!e||!e.isOnline||w(e.id,!0)},Ae=D=>new Date(D).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),Se=D=>{if(!D)return"inconnu";const ie=new Date(D),se=Math.floor((new Date().getTime()-ie.getTime())/6e4);if(se<1)return" l'instant";if(se<60)return`il y a ${se} min`;const ae=Math.floor(se/60);return ae<24?`il y a ${ae}h`:`il y a ${Math.floor(ae/24)}j`},_e=D=>{a(ie=>ie+D.native)},Te=D=>{m(ie=>ie+D.native)};return I.isInCall?A.jsx(Ms,{}):A.jsxs(A.Fragment,{children:[A.jsx(Ds,{}),A.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Chat entre administrateurs"}),A.jsxs("div",{className:"grid md:grid-cols-4 gap-6 h-[70vh]",children:[A.jsxs(Zt,{className:"md:col-span-1 flex flex-col",children:[A.jsx("div",{className:"p-4 border-b",children:A.jsx("h2",{className:"font-semibold",children:"Administrateurs"})}),A.jsx(nr,{className:"flex-1",children:O?A.jsx("div",{className:"p-4 text-center",children:"Chargement des administrateurs..."}):j.length===0?A.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"Aucun autre administrateur"}):j.map(D=>A.jsxs("div",{children:[A.jsxs("button",{className:`w-full p-3 flex items-center hover:bg-gray-100 ${(e==null?void 0:e.id)===D.id?"bg-gray-100":""}`,onClick:()=>t(D),children:[A.jsxs("div",{className:"relative mr-3",children:[A.jsx("div",{className:"w-10 h-10 bg-red-800 text-white rounded-full flex items-center justify-center",children:D.nom.charAt(0)}),A.jsx("div",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full ${D.isOnline?"bg-green-500":"bg-gray-400"}`})]}),A.jsxs("div",{className:"text-left",children:[A.jsx("p",{className:"font-medium",children:D.nom}),A.jsx("p",{className:"text-xs text-muted-foreground",children:D.isOnline?"En ligne":`Dernier accs ${Se(D.lastSeen)}`})]})]}),A.jsx(gn,{})]},`admin-${D.id}-${D.email}`))})]}),A.jsx(Zt,{className:"md:col-span-3 flex flex-col",children:e?A.jsxs(A.Fragment,{children:[A.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[A.jsxs("div",{className:"flex items-center space-x-3",children:[A.jsxs("div",{className:"relative",children:[A.jsx("div",{className:"w-10 h-10 bg-red-800 text-white rounded-full flex items-center justify-center",children:e.nom.charAt(0)}),A.jsx("div",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full ${e.isOnline?"bg-green-500":"bg-red-500"}`})]}),A.jsxs("div",{children:[A.jsx("h2",{className:"font-semibold",children:e.nom}),A.jsx("p",{className:"text-xs text-muted-foreground",children:e.isOnline?"En ligne":`Dernier accs ${Se(e.lastSeen)}`})]})]}),e.isOnline&&A.jsxs("div",{className:"flex items-center space-x-2",children:[A.jsx(fe,{variant:"outline",size:"icon",onClick:P,className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:A.jsx(Bt,{className:"h-4 w-4"})}),A.jsx(fe,{variant:"outline",size:"icon",onClick:ue,className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:A.jsx(Wt,{className:"h-4 w-4"})})]})]}),A.jsx(nr,{className:"flex-1 p-4",children:k?A.jsx("div",{className:"text-center p-4",children:"Chargement de la conversation..."}):(T==null?void 0:T.messages.length)===0?A.jsx("div",{className:"text-center p-4 text-muted-foreground",children:"Aucun message. Dmarrez la conversation !"}):A.jsxs("div",{className:"space-y-4",children:[T==null?void 0:T.messages.map(D=>A.jsx("div",{className:`flex ${D.senderId===(r==null?void 0:r.id)?"justify-end":"justify-start"}`,children:f===D.id?A.jsx("div",{className:"w-full max-w-[80%] bg-gray-50 p-3 rounded-lg",children:A.jsxs("div",{className:"flex",children:[A.jsx(er,{value:c,onChange:ie=>m(ie.target.value),className:"flex-1 mr-2"}),A.jsxs(ir,{children:[A.jsx(sr,{asChild:!0,children:A.jsx(fe,{variant:"outline",size:"icon",children:A.jsx(lr,{className:"h-4 w-4"})})}),A.jsx(or,{className:"w-full p-0",side:"top",children:A.jsx(tr,{data:rr,onEmojiSelect:Te,theme:"light"})})]}),A.jsx(fe,{onClick:L,className:"ml-2 bg-red-800 hover:bg-red-700",disabled:v.isPending,children:"Enregistrer"}),A.jsx(fe,{variant:"ghost",onClick:()=>d(null),className:"ml-2",children:"Annuler"})]})}):A.jsxs("div",{className:`max-w-[70%] p-3 rounded-lg relative group ${D.senderId===(r==null?void 0:r.id)?"bg-green-600 text-white":"bg-red-800 text-white"}`,children:[D.senderId===(r==null?void 0:r.id)&&!D.isAutoReply&&A.jsxs(yn,{children:[A.jsx(mn,{asChild:!0,children:A.jsx(fe,{variant:"ghost",size:"icon",className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 h-6 w-6 text-white",children:A.jsx(cr,{className:"h-4 w-4"})})}),A.jsxs(_n,{children:[A.jsxs(ar,{onClick:()=>q(D),children:[A.jsx(cr,{className:"mr-2 h-4 w-4"})," Modifier"]}),A.jsx(Vn,{}),A.jsxs(ar,{onClick:()=>M(D.id),className:"text-red-600",children:[A.jsx(Tn,{className:"mr-2 h-4 w-4"})," Supprimer"]})]})]}),A.jsx("p",{children:D.content}),A.jsxs("div",{className:"flex items-center justify-between mt-1",children:[A.jsx("p",{className:"text-xs opacity-80",children:Ae(D.timestamp)}),D.isEdited&&A.jsx("p",{className:"text-xs opacity-80 ml-2",children:"(modifi)"})]})]})},D.id)),A.jsx("div",{ref:_})]})}),A.jsx("div",{className:"p-4 border-t",children:A.jsxs("form",{onSubmit:D=>{D.preventDefault(),N()},className:"flex space-x-2",children:[A.jsxs("div",{className:"relative flex-1",children:[A.jsx(er,{value:i,onChange:D=>a(D.target.value),placeholder:"crivez votre message...",className:"pr-10",disabled:y.isPending}),A.jsxs(ir,{children:[A.jsx(sr,{asChild:!0,children:A.jsx(fe,{variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full",children:A.jsx(lr,{className:"h-4 w-4"})})}),A.jsx(or,{className:"w-full p-0",side:"top",children:A.jsx(tr,{data:rr,onEmojiSelect:_e,theme:"light"})})]})]}),A.jsx(fe,{type:"submit",className:"bg-red-800 hover:bg-red-700",disabled:y.isPending,children:A.jsx(bn,{className:"h-4 w-4"})})]})})]}):A.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Slectionnez un administrateur pour commencer  discuter"})})]})]})},lo=()=>A.jsx(pn,{children:A.jsx(Fs,{children:A.jsx(Ps,{})})});export{lo as default};
