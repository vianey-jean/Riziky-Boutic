import{j as e,G as c,I as u,B as g,o as O,s as b,d as R,i as $,y as K,C as G,k as Z,l as B,m as H,c as J,F as _,n as E,q as F,r as k,t as L,w as z,E as U,v as M,P as Q,a2 as W,J as l,z as A,Z as q,K as X,h as Y}from"./index-Dc-BS1W2.js";import{r as d}from"./emoji-mart-DRerY-OB.js";import{L as D}from"./Layout-TSHxcvNT.js";import{T as ee,a as se,b as T,c as V}from"./tabs-B2Ic9XCE.js";import{S as re,a as ae,b as oe,c as te,d as I}from"./select-B3i9CjeT.js";import{C as N}from"./checkbox-e3XHLN_v.js";import"./badge-taJbTjbb.js";import"./popover-CGZmNc4e.js";import"./index-DrCm3EO8.js";import"./Combination-DuTqoeZY.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./index-BkNWx6m2.js";import"./index-DE01g13U.js";import"./index--K3sZeIh.js";import"./user-DUzEMHwr.js";import"./index-FHuIi1st.js";import"./categoriesAPI-DvU_otkD.js";import"./pubLayoutAPI-DfYluJku.js";import"./arrow-up-BRrXiPPU.js";import"./database-BKbjrLJf.js";import"./circle-plus-gGTkOUJD.js";import"./clock-U9VSJiyP.js";import"./play-C68uu85c.js";import"./house-Qr62Kw0A.js";import"./shield-x-BsKCYJAg.js";import"./video-CY1c3mCS.js";import"./plus-DTTTuzsk.js";import"./search-DlKIh_Ll.js";import"./square-pen-D72gPhkm.js";import"./trash-2-DHce8VXy.js";import"./triangle-alert-Btc8UJ8c.js";import"./scroll-area-BfHT7kH_.js";import"./useMutation-CApHjpg4.js";import"./index-DqWbzM0E.js";const ne=({profileData:s,loading:n,handleProfileChange:o,handleGenreChange:f,handleProfileSubmit:i})=>e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"nom",children:"Nom"}),e.jsx(u,{id:"nom",name:"nom",value:s.nom||"",onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"prenom",children:"Prénom"}),e.jsx(u,{id:"prenom",name:"prenom",value:s.prenom||"",onChange:o})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"telephone",children:"Téléphone"}),e.jsx(u,{id:"telephone",name:"telephone",value:s.telephone||"",onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"genre",children:"Genre"}),e.jsxs(re,{value:s.genre||"",onValueChange:f,children:[e.jsx(ae,{children:e.jsx(oe,{placeholder:"Sélectionnez votre genre"})}),e.jsxs(te,{children:[e.jsx(I,{value:"homme",children:"Homme"}),e.jsx(I,{value:"femme",children:"Femme"}),e.jsx(I,{value:"autre",children:"Autre"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"adresse",children:"Adresse"}),e.jsx(u,{id:"adresse",name:"adresse",value:s.adresse||"",onChange:o})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"ville",children:"Ville"}),e.jsx(u,{id:"ville",name:"ville",value:s.ville||"",onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"codePostal",children:"Code Postal"}),e.jsx(u,{id:"codePostal",name:"codePostal",value:s.codePostal||"",onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"pays",children:"Pays"}),e.jsx(u,{id:"pays",name:"pays",value:s.pays||"",onChange:o})]})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:n,children:"Enregistrer les modifications"})]}),ie=O({currentPassword:b().min(1,"Mot de passe actuel requis"),newPassword:b().min(8,"Le mot de passe doit contenir au moins 8 caractères").refine(s=>/[A-Z]/.test(s),"Le mot de passe doit contenir au moins une majuscule").refine(s=>/[a-z]/.test(s),"Le mot de passe doit contenir au moins une minuscule").refine(s=>/[0-9]/.test(s),"Le mot de passe doit contenir au moins un chiffre").refine(s=>/[^A-Za-z0-9]/.test(s),"Le mot de passe doit contenir au moins un caractère spécial"),confirmPassword:b().min(1,"Confirmation du mot de passe requise")}).refine(s=>s.newPassword===s.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]}).refine(s=>s.newPassword!==s.currentPassword,{message:"Le nouveau mot de passe doit être différent de l'ancien",path:["newPassword"]}),ce=({loading:s,onPasswordChange:n}={})=>{const{user:o,updatePassword:f}=R(),[i,p]=d.useState(!1),[m,a]=d.useState(!1),[t,C]=d.useState(!1),[S,w]=d.useState(!1),P=s||S,j=$({resolver:K(ie),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),h=async r=>{var x,v;if(!o){l.error("Vous devez être connecté");return}w(!0);try{if(!(await A.verifyPassword(o.id,r.currentPassword)).data.valid){l.error("Mot de passe actuel incorrect",{style:{backgroundColor:"red",color:"white"}}),w(!1);return}n?await n(r.currentPassword,r.newPassword):await f(r.currentPassword,r.newPassword),j.reset(),l.success("Mot de passe mis à jour avec succès",{style:{backgroundColor:"green",color:"white"}})}catch(y){console.error("Erreur lors de la mise à jour du mot de passe:",y),l.error(((v=(x=y.response)==null?void 0:x.data)==null?void 0:v.message)||"Erreur lors de la mise à jour du mot de passe",{style:{backgroundColor:"red",color:"white"}})}finally{w(!1)}};return e.jsxs(G,{children:[e.jsxs(Z,{children:[e.jsx(B,{children:"Sécurité"}),e.jsx(H,{children:"Modifiez votre mot de passe"})]}),e.jsx(J,{children:e.jsx(_,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(h),className:"space-y-6",children:[e.jsx(E,{control:j.control,name:"currentPassword",render:({field:r})=>e.jsxs(F,{children:[e.jsx(k,{children:"Mot de passe actuel"}),e.jsx(L,{children:e.jsxs("div",{className:"relative",children:[e.jsx(u,{type:i?"text":"password",placeholder:"Entrez votre mot de passe actuel",...r}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>p(!i),children:i?e.jsx(z,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})})]})}),e.jsx(M,{})]})}),e.jsx(E,{control:j.control,name:"newPassword",render:({field:r})=>e.jsxs(F,{children:[e.jsx(k,{children:"Nouveau mot de passe"}),e.jsx(L,{children:e.jsxs("div",{className:"relative",children:[e.jsx(u,{type:m?"text":"password",placeholder:"Entrez votre nouveau mot de passe",...r}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>a(!m),children:m?e.jsx(z,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})})]})}),e.jsx(Q,{password:r.value}),e.jsx(W,{children:"Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule, un chiffre et un caractère spécial."}),e.jsx(M,{})]})}),e.jsx(E,{control:j.control,name:"confirmPassword",render:({field:r})=>e.jsxs(F,{children:[e.jsx(k,{children:"Confirmer le mot de passe"}),e.jsx(L,{children:e.jsxs("div",{className:"relative",children:[e.jsx(u,{type:t?"text":"password",placeholder:"Confirmez votre nouveau mot de passe",...r}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>C(!t),children:t?e.jsx(z,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})})]})}),e.jsx(M,{})]})}),e.jsx(g,{type:"submit",className:"w-full",disabled:P,children:P?"Mise à jour...":"Mettre à jour le mot de passe"})]})})})]})},le=()=>{const{user:s}=R(),[n,o]=d.useState({emailNotifications:!0,marketingEmails:!1,productUpdates:!0,orderStatusUpdates:!0}),[f,i]=d.useState(!1);d.useEffect(()=>{(async()=>{if(s!=null&&s.id)try{i(!0);const t=await q.get(`/users/${s.id}/preferences`);t.data&&o(t.data)}catch(t){console.error("Erreur lors du chargement des préférences:",t)}finally{i(!1)}})()},[s]);const p=a=>{o(t=>({...t,[a]:!t[a]}))},m=async()=>{if(!(s!=null&&s.id)){l.error("Vous devez être connecté pour enregistrer vos préférences");return}i(!0);try{await q.post(`/users/${s.id}/preferences`,n),l.success("Préférences enregistrées avec succès")}catch(a){console.error("Erreur lors de l'enregistrement des préférences:",a),l.error("Une erreur est survenue lors de l'enregistrement des préférences")}finally{i(!1)}};return e.jsxs(G,{children:[e.jsxs(Z,{children:[e.jsx(B,{children:"Préférences"}),e.jsx(H,{children:"Gérez vos préférences et notifications"})]}),e.jsx(J,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"emailNotifications",checked:n.emailNotifications,onCheckedChange:()=>p("emailNotifications")}),e.jsx(c,{htmlFor:"emailNotifications",children:"Recevoir des notifications par email"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"marketingEmails",checked:n.marketingEmails,onCheckedChange:()=>p("marketingEmails")}),e.jsx(c,{htmlFor:"marketingEmails",children:"Recevoir des emails marketing"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"productUpdates",checked:n.productUpdates,onCheckedChange:()=>p("productUpdates")}),e.jsx(c,{htmlFor:"productUpdates",children:"Mises à jour des produits"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"orderStatusUpdates",checked:n.orderStatusUpdates,onCheckedChange:()=>p("orderStatusUpdates")}),e.jsx(c,{htmlFor:"orderStatusUpdates",children:"Mises à jour du statut des commandes"})]}),e.jsx(g,{onClick:m,className:"mt-4",disabled:f,children:f?"Enregistrement...":"Enregistrer les préférences"})]})})]})},Oe=()=>{const{user:s,isAuthenticated:n,loading:o}=R(),{orders:f,fetchOrders:i}=X();d.useState("info");const[p,m]=d.useState(!1),[a,t]=d.useState({nom:(s==null?void 0:s.nom)||"",prenom:(s==null?void 0:s.prenom)||"",adresse:(s==null?void 0:s.adresse)||"",ville:(s==null?void 0:s.ville)||"",codePostal:(s==null?void 0:s.codePostal)||"",pays:(s==null?void 0:s.pays)||"",telephone:(s==null?void 0:s.telephone)||"",genre:(s==null?void 0:s.genre)||"autre"}),C=Y();d.useEffect(()=>{!o&&!n&&C("/login"),s&&(t({nom:s.nom||"",prenom:s.prenom||"",adresse:s.adresse||"",ville:s.ville||"",codePostal:s.codePostal||"",pays:s.pays||"",telephone:s.telephone||"",genre:s.genre||"autre"}),i())},[n,o,s]);const S=h=>{const{name:r,value:x}=h.target;if(r==="genre"){const v=x;t(y=>({...y,[r]:v}))}else t(v=>({...v,[r]:x}))},w=h=>{const r=h;t(x=>({...x,genre:r}))},P=async h=>{if(h.preventDefault(),!!s){m(!0);try{const r={nom:a.nom,prenom:a.prenom,adresse:a.adresse,ville:a.ville,codePostal:a.codePostal,pays:a.pays,telephone:a.telephone,genre:a.genre};await A.updateProfile(s.id,r),l.success("Profil mis à jour avec succès")}catch(r){console.error("Erreur lors de la mise à jour du profil:",r),l.error("Erreur lors de la mise à jour du profil")}finally{m(!1)}}},j=async(h,r)=>{m(!0);try{if(!s)throw new Error("Utilisateur non connecté");return await A.updatePassword(s.id,h,r),l.success("Mot de passe mis à jour avec succès"),!0}catch(x){return console.error("Erreur lors de la mise à jour du mot de passe:",x),l.error("Erreur lors de la mise à jour du mot de passe"),!1}finally{m(!1)}};return e.jsx(D,{children:e.jsx("div",{className:"container px-4 py-8",children:e.jsxs("div",{className:"max-w-[900px] mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Mon Compte"}),e.jsx("div",{className:"grid gap-6 md:grid-cols-[250px_1fr]",children:e.jsx("div",{className:"md:col-span-2",children:e.jsxs(ee,{defaultValue:"informations",children:[e.jsxs(se,{className:"grid w-full grid-cols-3",children:[e.jsx(T,{value:"informations",children:"Informations personnelles"}),e.jsx(T,{value:"security",children:"Sécurité"}),e.jsx(T,{value:"preferences",children:"Préférences"})]}),e.jsx(V,{value:"informations",className:"mt-6",children:e.jsx(G,{children:e.jsx(ne,{profileData:a,loading:p,handleProfileChange:S,handleGenreChange:w,handleProfileSubmit:P})})}),e.jsx(V,{value:"security",className:"mt-6",children:e.jsx(ce,{loading:p,onPasswordChange:j})}),e.jsx(V,{value:"preferences",className:"mt-6",children:e.jsx(le,{})})]})})})]})})})};export{Oe as default};
