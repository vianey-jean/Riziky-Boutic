import{d as K,_ as F,j as e,B as a,L as R,I as V,J as c}from"./index-Dc-BS1W2.js";import{r as o,$ as f,d as N}from"./emoji-mart-DRerY-OB.js";import{L as y}from"./Layout-TSHxcvNT.js";import{T as B}from"./textarea-C2Rhkt_I.js";import{a as J,u as v}from"./useMutation-CApHjpg4.js";import{c as l,P as b,a as w,b as C,D as O,d as U,e as _,f as S,g as G}from"./popover-CGZmNc4e.js";import{U as H,S as M,a as W}from"./user-DUzEMHwr.js";import{S as E}from"./square-pen-D72gPhkm.js";import{T as X}from"./trash-2-DHce8VXy.js";import"./badge-taJbTjbb.js";import"./index-FHuIi1st.js";import"./index-DrCm3EO8.js";import"./Combination-DuTqoeZY.js";import"./index-DE01g13U.js";import"./index-CE35kS-Q.js";import"./index-C_ZzNLza.js";import"./index-BkNWx6m2.js";import"./select-B3i9CjeT.js";import"./index-DqWbzM0E.js";import"./categoriesAPI-DvU_otkD.js";import"./pubLayoutAPI-DfYluJku.js";import"./arrow-up-BRrXiPPU.js";import"./database-BKbjrLJf.js";import"./circle-plus-gGTkOUJD.js";import"./clock-U9VSJiyP.js";import"./play-C68uu85c.js";import"./house-Qr62Kw0A.js";import"./shield-x-BsKCYJAg.js";import"./video-CY1c3mCS.js";import"./plus-DTTTuzsk.js";import"./search-DlKIh_Ll.js";import"./triangle-alert-Btc8UJ8c.js";import"./scroll-area-BfHT7kH_.js";import"./index--K3sZeIh.js";const De=()=>{const{user:r}=K(),[m,n]=o.useState(""),[z,u]=o.useState(null),[h,d]=o.useState(""),x=o.useRef(null),p=F(),{data:i,isLoading:I}=J({queryKey:["serviceChat"],queryFn:async()=>{try{return(await l.getServiceChat()).data||{messages:[]}}catch(s){return console.error("Erreur lors du chargement du chat:",s),c.error("Erreur lors du chargement du chat. Veuillez réessayer."),{messages:[]}}},enabled:!!r,refetchInterval:5e3}),T=v({mutationFn:async s=>l.sendServiceMessage(s),onSuccess:()=>{n(""),p.invalidateQueries({queryKey:["serviceChat"]})},onError:s=>{console.error("Erreur lors de l'envoi du message:",s),c.error("L'envoi du message a échoué. Veuillez réessayer.")}}),j=v({mutationFn:async({messageId:s,content:t,conversationId:A})=>l.editMessage(s,t,A),onSuccess:()=>{u(null),d(""),p.invalidateQueries({queryKey:["serviceChat"]})},onError:s=>{console.error("Erreur lors de la modification du message:",s),c.error("La modification du message a échoué.")}}),k=v({mutationFn:async({messageId:s,conversationId:t})=>l.deleteMessage(s,t),onSuccess:()=>{p.invalidateQueries({queryKey:["serviceChat"]}),c.success("Message supprimé avec succès")},onError:s=>{console.error("Erreur lors de la suppression du message:",s),c.error("La suppression du message a échoué.")}});o.useEffect(()=>(r&&l.setOnline(),()=>{r&&l.setOffline()}),[r]),o.useEffect(()=>{x.current&&x.current.scrollIntoView({behavior:"smooth"})},[i==null?void 0:i.messages]);const g=()=>{m.trim()&&T.mutate(m)},D=s=>{if(!h.trim()||!i)return;const t=`client-${r==null?void 0:r.id}-service`;j.mutate({messageId:s,content:h,conversationId:t})},L=s=>{u(s.id),d(s.content)},q=s=>{if(!i||!confirm("Êtes-vous sûr de vouloir supprimer ce message ?"))return;const t=`client-${r==null?void 0:r.id}-service`;k.mutate({messageId:s,conversationId:t})},P=s=>new Date(s).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),$=s=>{n(t=>t+s.native)},Q=s=>{d(t=>t+s.native)};return r?e.jsx(y,{children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Service Client"}),e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-red-800 w-10 h-10 rounded-full flex items-center justify-center text-white",children:e.jsx(H,{className:"h-5 w-5"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h2",{className:"font-medium",children:"Support Riziky Boutique"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Nous vous répondons du lundi au vendredi de 9h à 18h"})]})]})}),e.jsx("div",{className:"h-96 overflow-y-auto p-4 space-y-4",children:I?e.jsx("div",{className:"text-center p-4",children:"Chargement de la conversation..."}):(i==null?void 0:i.messages.length)===0?e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:"Aucun message. Démarrez la conversation !"}):e.jsxs("div",{className:"space-y-4",children:[i==null?void 0:i.messages.map(s=>e.jsx("div",{className:`flex ${s.senderId===r.id?"justify-end":"justify-start"}`,children:z===s.id?e.jsx("div",{className:"w-full max-w-[80%] bg-gray-50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx(V,{value:h,onChange:t=>d(t.target.value),className:"flex-1 mr-2"}),e.jsxs(b,{children:[e.jsx(w,{asChild:!0,children:e.jsx(a,{variant:"outline",size:"icon",children:e.jsx(M,{className:"h-4 w-4"})})}),e.jsx(C,{className:"w-full p-0",side:"top",children:e.jsx(f,{data:N,onEmojiSelect:Q,theme:"light"})})]}),e.jsx(a,{onClick:()=>D(s.id),className:"ml-2 bg-red-800 hover:bg-red-700",disabled:j.isPending,children:"Enregistrer"}),e.jsx(a,{variant:"ghost",onClick:()=>u(null),className:"ml-2",children:"Annuler"})]})}):e.jsxs("div",{className:`max-w-[80%] rounded-lg px-4 py-2 relative group ${s.isSystemMessage?"bg-gray-200 text-gray-700":s.senderId===r.id?"bg-green-600 text-white":"bg-blue-600 text-white"}`,children:[s.senderId===r.id&&!s.isSystemMessage&&e.jsxs(O,{children:[e.jsx(U,{asChild:!0,children:e.jsx(a,{variant:"ghost",size:"icon",className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 h-6 w-6 text-white",children:e.jsx(E,{className:"h-4 w-4"})})}),e.jsxs(_,{children:[e.jsxs(S,{onClick:()=>L(s),children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Modifier"]}),e.jsx(G,{}),e.jsxs(S,{onClick:()=>q(s.id),className:"text-red-600",children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Supprimer"]})]})]}),e.jsx("p",{children:s.content}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("p",{className:`text-xs ${s.senderId===r.id?"text-green-100":"text-blue-100"}`,children:P(s.timestamp)}),s.isEdited&&e.jsx("p",{className:"text-xs ml-2 opacity-80",children:"(modifié)"})]})]})},s.id)),e.jsx("div",{ref:x})]})}),e.jsx("div",{className:"p-4 border-t",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),g()},className:"flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(B,{value:m,onChange:s=>n(s.target.value),placeholder:"Écrivez votre message...",className:"resize-none pr-10",onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),g())}}),e.jsxs(b,{children:[e.jsx(w,{asChild:!0,children:e.jsx(a,{variant:"ghost",size:"icon",className:"absolute right-2 bottom-2",children:e.jsx(M,{className:"h-4 w-4"})})}),e.jsx(C,{className:"w-full p-0",side:"top",children:e.jsx(f,{data:N,onEmojiSelect:$,theme:"light"})})]})]}),e.jsx(a,{type:"submit",className:"bg-red-800 hover:bg-red-700 self-end h-10",children:e.jsx(W,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Questions fréquentes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(a,{variant:"outline",onClick:()=>n("Comment suivre ma livraison?"),className:"w-full justify-start",children:"Comment suivre ma livraison?"}),e.jsx(a,{variant:"outline",onClick:()=>n("Comment retourner un produit?"),className:"w-full justify-start",children:"Comment retourner un produit?"}),e.jsx(a,{variant:"outline",onClick:()=>n("Quels modes de paiement acceptez-vous?"),className:"w-full justify-start",children:"Quels modes de paiement acceptez-vous?"}),e.jsx(a,{variant:"outline",onClick:()=>n("Avez-vous des réductions régulières?"),className:"w-full justify-start",children:"Avez-vous des réductions régulières?"})]})]})]})}):e.jsx(y,{children:e.jsxs("div",{className:"max-w-3xl mx-auto py-10 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Service Client"}),e.jsx("p",{className:"mb-6",children:"Veuillez vous connecter pour accéder au service client en ligne."}),e.jsx(a,{asChild:!0,className:"bg-red-800 hover:bg-red-700",children:e.jsx(R,{to:"/login",children:"Se connecter"})})]})})};export{De as default};
